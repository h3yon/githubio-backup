I"Ù<p>ìŠ¤í”„ë§ mvc 1í¸ì„ ë“£ê³  ì •ë¦¬í•œ ë‚´ìš©ì…ë‹ˆë‹¤.</p>

<h1 id="1-servletì´í•´í•˜ê¸°">1 Servletì´í•´í•˜ê¸°</h1>

<p>ì„œë¸”ë¦¿ì„ ìë™ ë“±ë¡í•˜ëŠ” ê²½ìš°,
<code class="language-plaintext highlighter-rouge">@ServletComponentScan</code>ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•œë‹¤.</p>

<p>ì˜ˆì œë¥¼ ë³´ë©´ì„œ ì´í•´í•´ë³´ì</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@WebServlet</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"helloServlet"</span><span class="o">,</span> <span class="n">urlPatterns</span> <span class="o">=</span> <span class="s">"/hello"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloServlet</span> <span class="kd">extends</span> <span class="nc">HttpServlet</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">service</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"request = "</span> <span class="o">+</span> <span class="n">request</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"response = "</span> <span class="o">+</span> <span class="n">response</span><span class="o">);</span>

        <span class="nc">String</span> <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"username"</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"username = "</span> <span class="o">+</span> <span class="n">username</span><span class="o">);</span>

        <span class="n">response</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">"text/plain"</span><span class="o">);</span>
        <span class="n">response</span><span class="o">.</span><span class="na">setCharacterEncoding</span><span class="o">(</span><span class="s">"utf-8"</span><span class="o">);</span>
        <span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">write</span><span class="o">(</span><span class="s">"hello "</span> <span class="o">+</span> <span class="n">username</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>ì„œë¸”ë¦¿ì„ ë³´ë©´ ì´ë ‡ê²Œ request, responseë¡œ êµ¬ì„±ë˜ì–´ ìˆìœ¼ë©°,<br />
íŒŒë¼ë¯¸í„°ë¥¼ ì¶”ì¶œí•´ë‚¼ ìˆ˜ ìˆê³ ,<br />
responseì˜ contentType, CharacterEncodingì„ ì„¤ì • ê°€ëŠ¥í•˜ë©°<br />
writeë¡œ ì›í•˜ëŠ” ë‚´ìš©ì„ ë¿Œë ¤ì¤„ ìˆ˜ ìˆë‹¤</p>

<p>urlPatternsë¡œ ì›í•˜ëŠ” urië¥¼ ì„¤ì • ê°€ëŠ¥í•œ ê±¸ ë³¼ ìˆ˜ ìˆë‹¤</p>

<p>ë˜, ì•„ë˜ì²˜ëŸ¼ ì´ë ‡ê²Œ ì›í•˜ëŠ” ì •ë³´ë¥¼ ë½‘ì•„ë‚¼ ìˆ˜ ìˆë‹¤</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"request.getMethod() = "</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="na">getMethod</span><span class="o">());</span> <span class="c1">//GET</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"request.getProtocal() = "</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="na">getProtocol</span><span class="o">());</span> <span class="c1">//HTTP/1.1</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"request.getScheme() = "</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="na">getScheme</span><span class="o">());</span> <span class="c1">//http</span>
<span class="c1">// http://localhost:8080/request-header</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"request.getRequestURL() = "</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURL</span><span class="o">());</span>
<span class="c1">// /request-test</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"request.getRequestURI() = "</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURI</span><span class="o">());</span>
<span class="c1">//username=hi</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"request.getQueryString() = "</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="na">getQueryString</span><span class="o">());</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"request.isSecure() = "</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="na">isSecure</span><span class="o">());</span> <span class="c1">//httpsì‚¬ìš© ìœ ë¬´</span>
</code></pre></div></div>

<p>headerì •ë³´ë¥¼ <strong>ì•„ë˜ì²˜ëŸ¼ iteratorë¡œ ë½‘ì•„ë‚´</strong>ëŠ” ë“± ë‹¤ì–‘í•œ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤!!</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">request</span><span class="o">.</span><span class="na">getHeaderNames</span><span class="o">().</span><span class="na">asIterator</span><span class="o">().</span><span class="na">forEachRemaining</span><span class="o">(</span><span class="n">headerName</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"headerName = "</span> <span class="o">+</span> <span class="n">headerName</span><span class="o">));</span>
</code></pre></div></div>

<h2 id="ìš”ì²­-bodyì˜-json-ë½‘ì•„ì„œ-ê°ì²´ë¡œ-ë§Œë“¤ê¸°">ìš”ì²­ bodyì˜ json ë½‘ì•„ì„œ ê°ì²´ë¡œ ë§Œë“¤ê¸°!</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@WebServlet</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"requestBodyJsonServelt"</span><span class="o">,</span> <span class="n">urlPatterns</span> <span class="o">=</span> <span class="s">"/request-body-json"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RequestBodyJsonServlet</span> <span class="kd">extends</span> <span class="nc">HttpServlet</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">ObjectMapper</span> <span class="n">objectMapper</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectMapper</span><span class="o">();</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">service</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">resp</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">ServletInputStream</span> <span class="n">inputStream</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
        <span class="nc">String</span> <span class="n">messageBody</span> <span class="o">=</span> <span class="nc">StreamUtils</span><span class="o">.</span><span class="na">copyToString</span><span class="o">(</span><span class="n">inputStream</span><span class="o">,</span> <span class="nc">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"messageBody = "</span> <span class="o">+</span> <span class="n">messageBody</span><span class="o">);</span>

        <span class="nc">HelloData</span> <span class="n">helloData</span> <span class="o">=</span> <span class="n">objectMapper</span><span class="o">.</span><span class="na">readValue</span><span class="o">(</span><span class="n">messageBody</span><span class="o">,</span> <span class="nc">HelloData</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"helloData.username = "</span> <span class="o">+</span> <span class="n">helloData</span><span class="o">.</span><span class="na">getUsername</span><span class="o">());</span>
        <span class="n">resp</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">write</span><span class="o">(</span><span class="s">"ok"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>ì´ë ‡ê²Œ ServletInputStreamì„ ë½‘ì•„ë‚¸ í›„,<br />
copyToStringìœ¼ë¡œ bodyë¥¼ ë½‘ì•„ë‚¸ë‹¤.<br />
ObjectMapperë¥¼ ì‚¬ìš©í•´ì„œ json ë‚´ìš©ì„ ê°ì²´ë¡œ ë³€í™˜í•´ì„œ ë³¼ ìˆ˜ ìˆë‹¤</p>

<blockquote>
  <p>ê°•ì˜ ì¤‘, ë™ì‹œì„± ë¬¸ì œ ê³ ë ¤ í•„ìš”í•  ë•Œì—ëŠ” ConcurrentHashMap, AtomicLong ì‚¬ìš© ê³ ë ¤ í•„ìš”</p>
</blockquote>

<p>+resultì— 2ê°œì˜ ì •ë³´ê°€ í¬í•¨ë˜ì–´ìˆëŠ”ì§€ í…ŒìŠ¤íŠ¸í•  ë•Œ</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">assertThat</span><span class="o">(</span><span class="n">result</span><span class="o">).</span><span class="na">contains</span><span class="o">(</span><span class="n">member1</span><span class="o">,</span> <span class="n">member2</span><span class="o">);</span>
</code></pre></div></div>

<h1 id="jsp">JSP?</h1>

<p>jspë¥¼ ë³´ë©´ì„œ ì´í•´í•´ë³´ì</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;%</span><span class="err">@</span> <span class="n">page</span> <span class="kn">import</span><span class="err">="</span><span class="nn">java.util.List</span><span class="s">" %&gt;
&lt;%@ page import="</span><span class="n">hello</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">domain</span><span class="o">.</span><span class="na">member</span><span class="o">.</span><span class="na">MemberRepository</span><span class="s">" %&gt;
&lt;%@ page import="</span><span class="n">hello</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">domain</span><span class="o">.</span><span class="na">member</span><span class="o">.</span><span class="na">Member</span><span class="s">" %&gt;
&lt;%@ page contentType="</span><span class="n">text</span><span class="o">/</span><span class="n">html</span><span class="o">;</span><span class="n">charset</span><span class="o">=</span><span class="no">UTF</span><span class="o">-</span><span class="mi">8</span><span class="s">" language="</span><span class="n">java</span><span class="s">" %&gt;
&lt;%
    MemberRepository memberRepository = MemberRepository.getInstance();
    List&lt;Member&gt; members = memberRepository.findAll();
%&gt;
&lt;table&gt;
    &lt;thead&gt;
    &lt;th&gt;id&lt;/th&gt;
    &lt;th&gt;username&lt;/th&gt;
    &lt;th&gt;age&lt;/th&gt;
    &lt;/thead&gt;
    &lt;tbody&gt;
    &lt;%
        for (Member member : members) {
            out.write("</span>    <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span><span class="s">");
            out.write("</span>      <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="s">" + member.getId() + "</span><span class="o">&lt;/</span><span class="n">td</span> <span class="o">&gt;</span><span class="s">");
            out.write("</span>      <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="s">" + member.getUsername() + "</span><span class="o">&lt;/</span><span class="n">td</span> <span class="o">&gt;</span><span class="s">");
            out.write("</span>      <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="s">" + member.getAge() + "</span><span class="o">&lt;/</span><span class="n">td</span> <span class="o">&gt;</span><span class="s">");
            out.write("</span>    <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span><span class="err">"</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">%&gt;</span>
    <span class="o">&lt;/</span><span class="n">tbody</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">table</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>ì´ë ‡ê²Œ ìœ„ì— ìë°”ì—ì„œ ì‚¬ìš©ë˜ëŠ” ì½”ë“œê°€ ìˆê³ ,<br />
ì•„ë˜ì— html ê´€ë ¨ ì½”ë“œê°€ ìˆë‹¤ <br />
+html, head ì´ëŸ° íƒœê·¸ëŠ” ìƒëµ!</p>

<p>ë”± ë³´ê¸°ë§Œ í•´ë„ jspë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì— ëŒ€í•´ ê³ ë¯¼í•  ê²ƒì´ë€ ê±¸ ì•Œ ìˆ˜ ìˆë‹¤!</p>

<h1 id="mvc">MVC</h1>

<blockquote>
  <p>ê°•ì˜ ë“¤ìœ¼ë©´ì„œ í•˜ë‚˜ ë” ì•Œê²Œ ëœ ê±´, â€œ/WEB-INF/~â€ì— ìˆëŠ” ë¶€ë¶„ì€, ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë·°ë¡œ ì´ë™í•  ë•Œ ì‚¬ìš©í•œë‹¤ëŠ” ê²ƒì´ì—ˆë‹¤</p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//ì„œë¸”ë¦¿ ê´€ë ¨ ì½”ë“œ</span>
<span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"member"</span><span class="o">,</span> <span class="n">member</span><span class="o">);</span>

<span class="nc">String</span> <span class="n">viewPath</span> <span class="o">=</span> <span class="s">"/WEB-INF/views/members.jsp"</span><span class="o">;</span>
<span class="nc">RequestDispatcher</span> <span class="n">dispatcher</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestDispatcher</span><span class="o">(</span><span class="n">viewPath</span><span class="o">);</span>
<span class="n">dispatcher</span><span class="o">.</span><span class="na">forward</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
</code></pre></div></div>

<p>requestDispatcherì— viewPathë¥¼ ë„£ê³ <br />
<code class="language-plaintext highlighter-rouge">dispatcher.forward()</code>ë¡œ í™”ë©´ì„ ë¿Œë ¤ì¤€ë‹¨ ê±¸ ì•Œ ìˆ˜ ìˆë‹¤<br />
-&gt; ì—¬ê¸°ì„œ ì¤‘ë³µì´ ê³„ì† ë°œìƒí•  ìˆ˜ ìˆë‹¤(viewPath, forward ë¶€ë¶„!)
ë˜, setAttributeë¡œ modelì— ë°ì´í„°ë¥¼ ë³´ê´€í•  ìˆ˜ ìˆë‹¤</p>

<p>jspì˜ ê²½ìš° ì•„ë˜ì²˜ëŸ¼ forEachë¡œ membersì— ëŒ€í•´<br />
forEachë¡œ itemì„ ë½‘ì•„ì˜¤ëŠ” ê±¸ ì•Œ ìˆ˜ ìˆë‹¤</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;table&gt;</span>
    <span class="nt">&lt;thead&gt;</span>
    <span class="nt">&lt;th&gt;</span>id<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;</span>username<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;</span>age<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;/thead&gt;</span>
    <span class="nt">&lt;tbody&gt;</span>
    <span class="nt">&lt;c:forEach</span> <span class="na">var=</span><span class="s">"item"</span> <span class="na">items=</span><span class="s">"${members}"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;tr&gt;</span>
            <span class="nt">&lt;td&gt;</span>${item.id}<span class="nt">&lt;/td&gt;</span>
            <span class="nt">&lt;td&gt;</span>${item.username}<span class="nt">&lt;/td&gt;</span>
            <span class="nt">&lt;td&gt;</span>${item.age}<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;/c:forEach&gt;</span>
    <span class="nt">&lt;/tbody&gt;</span>
<span class="nt">&lt;/table&gt;</span>
</code></pre></div></div>

<h1 id="ì¤‘ë³µ-ê°œì„ ì„-ìœ„í•œ-servletv1">ì¤‘ë³µ ê°œì„ ì„ ìœ„í•œ ServletV1</h1>

<p>ServletV1ì—ì„œ uriì— ë§ê²Œ Controllerë¥¼ ë§¤í•‘í•´ì¤€ë‹¤.<br />
HttpServletì„ êµ¬í˜„í•œ ê²ƒì´ë‹¤ë³´ë‹ˆê¹Œ serviceë¡œ processë¥¼ í•´ì¤€ë‹¤.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@WebServlet</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"ServletV1"</span><span class="o">,</span> <span class="n">urlPatterns</span> <span class="o">=</span> <span class="s">"/controller/v1/*"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServletV1</span> <span class="kd">extends</span> <span class="nc">HttpServlet</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">ControllerV1</span><span class="o">&gt;</span> <span class="n">controllerV1Map</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>

    <span class="kd">public</span> <span class="nf">ServletV1</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">controllerV1Map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/controller/v1/members/new-form"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MemberFormControllerV1</span><span class="o">());</span>
        <span class="n">controllerV1Map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/controller/v1/members/save"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MemberSaveControllerV1</span><span class="o">());</span>
        <span class="n">controllerV1Map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/controller/v1/members"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MemberListControllerV1</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">service</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">requestURI</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURI</span><span class="o">();</span>
        <span class="nc">ControllerV1</span> <span class="n">controller</span> <span class="o">=</span> <span class="n">controllerV1Map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">requestURI</span><span class="o">);</span>
        <span class="n">controller</span><span class="o">.</span><span class="na">process</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span> <span class="c1">//ì•„ê¹Œ ê³„ì† ì¤‘ë³µë˜ì—ˆë˜ ë¶€ë¶„(requestDispatcher, forward)</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>ìœ„ì˜ processëŠ” controllerë§ˆë‹¤ êµ¬í˜„í•´ì£¼ëŠ” ë¶€ë¶„ìœ¼ë¡œ,<br />
ì•„ê¹Œ ì¤‘ë³µë˜ì—ˆë˜ ë¶€ë¶„ì„ í¬í•¨í•œë‹¤</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberSaveControllerV1</span> <span class="kd">implements</span> <span class="nc">ControllerV1</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">MemberRepository</span> <span class="n">memberRepository</span> <span class="o">=</span> <span class="nc">MemberRepository</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">process</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="c1">//ë¡œì§ (ìƒëµ)</span>
        <span class="nc">String</span> <span class="n">viewPath</span> <span class="o">=</span> <span class="s">"/WEB-INF/views/save-result.jsp"</span><span class="o">;</span>
        <span class="nc">RequestDispatcher</span> <span class="n">dispatcher</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestDispatcher</span><span class="o">(</span><span class="n">viewPath</span><span class="o">);</span>
        <span class="n">dispatcher</span><span class="o">.</span><span class="na">forward</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>ê·¸ë˜ë„ ì»¨íŠ¸ë¡¤ëŸ¬ë§ˆë‹¤ ë‹¤ ìœ„ì²˜ëŸ¼ ì¤‘ë³µëœ ë¶€ë¶„ì„ ê°€ì ¸ì•¼í•¨ì„ ì•Œ ìˆ˜ ìˆë‹¤</p>

<h1 id="ì¤‘ë³µ-ê°œì„ ì„-ìœ„í•œ-servletv2">ì¤‘ë³µ ê°œì„ ì„ ìœ„í•œ ServletV2</h1>

<p>ê·¸ë˜ì„œ ë·°ë¼ëŠ” í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ê³ ,<br />
ì¤‘ë³µë˜ëŠ” ë¶€ë¶„ì„ renderì— ë‹´ëŠ”ë‹¤</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyView</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">viewPath</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">MyView</span><span class="o">(</span><span class="nc">String</span> <span class="n">viewPath</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">viewPath</span> <span class="o">=</span> <span class="n">viewPath</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">render</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">RequestDispatcher</span> <span class="n">dispatcher</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestDispatcher</span><span class="o">(</span><span class="n">viewPath</span><span class="o">);</span>
        <span class="n">dispatcher</span><span class="o">.</span><span class="na">forward</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>ì„œë¸”ë¦¿ì„ ë³´ë©´ ì•„ê¹Œì™€ ë‹¬ë¼ë³´ì´ì§€ ì•Šì§€ë§Œ,<br />
process ë°‘ì— ë Œë”ê°€ ì¶”ê°€ë¨ì„ ì•Œ ìˆ˜ ìˆë‹¤</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@WebServlet</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"ServletV2"</span><span class="o">,</span> <span class="n">urlPatterns</span> <span class="o">=</span> <span class="s">"/controller/v2/*"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServletV2</span> <span class="kd">extends</span> <span class="nc">HttpServlet</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">ControllerV2</span><span class="o">&gt;</span> <span class="n">controllerV2Map</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>

    <span class="kd">public</span> <span class="nf">ServletV2</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">controllerV2Map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/controller/v2/members/new-form"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MemberFormControllerV2</span><span class="o">());</span>
        <span class="n">controllerV2Map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/controller/v2/members/save"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MemberSaveControllerV2</span><span class="o">());</span>
        <span class="n">controllerV2Map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/controller/v2/members"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MemberListControllerV2</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">service</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">requestURI</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURI</span><span class="o">();</span>

        <span class="nc">ControllerV2</span> <span class="n">controller</span> <span class="o">=</span> <span class="n">controllerV2Map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">requestURI</span><span class="o">);</span>
        <span class="nc">MyView</span> <span class="n">view</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="na">process</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
        <span class="n">view</span><span class="o">.</span><span class="na">render</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>ê·¸ëŸ¼ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ì´ë ‡ê²Œ í•´ë‹¹ ê²½ë¡œë¥¼ ë¦¬í„´í•´ì¤Œì„ ì•Œ ìˆ˜ ìˆë‹¤</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberFormControllerV2</span> <span class="kd">implements</span> <span class="nc">ControllerV2</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">MyView</span> <span class="nf">process</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">MyView</span><span class="o">(</span><span class="s">"/WEB-INF/views/new-form.jsp"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>ê´œì°®ì€ ê²ƒ ê°™ì€ë°,<br />
ì„œë¸”ë¦¿ ì¢…ì†ì„±ì´ ì—¬ì „íˆ ì¡´ì¬í•œë‹¤ëŠ” ë‹¨ì ì´ ìˆë‹¤</p>

<h1 id="ì„œë¸”ë¦¿-ì¢…ì†ì„±-ê°œì„ ì„-ìœ„í•œ-servletv3">ì„œë¸”ë¦¿ ì¢…ì†ì„± ê°œì„ ì„ ìœ„í•œ ServletV3</h1>

<p>ì•„ê¹Œ MyViewì™€ ë‹¬ë¦¬,<br />
viewNameì—ë‹¤ê°€ modelì´ ìˆë‹¤.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Getter</span> <span class="nd">@Setter</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ModelView</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">viewName</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">model</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>

    <span class="kd">public</span> <span class="nf">ModelView</span><span class="o">(</span><span class="nc">String</span> <span class="n">viewName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">viewName</span> <span class="o">=</span> <span class="n">viewName</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>ê·¸ëŸ¼ MyViewì—ë„ model ê´€ë ¨ ì‘ì—…ì„ í•´ì¤€ë‹¤</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">render</span><span class="o">(</span><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">model</span><span class="o">,</span> <span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="n">modelToRequestAttribute</span><span class="o">(</span><span class="n">model</span><span class="o">,</span> <span class="n">request</span><span class="o">);</span>
        <span class="nc">RequestDispatcher</span> <span class="n">dispatcher</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestDispatcher</span><span class="o">(</span><span class="n">viewPath</span><span class="o">);</span>
        <span class="n">dispatcher</span><span class="o">.</span><span class="na">forward</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">modelToRequestAttribute</span><span class="o">(</span><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">model</span><span class="o">,</span> <span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//        model.forEach(request::setAttribute);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">forEach</span><span class="o">((</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">));</span>
    <span class="o">}</span>
</code></pre></div></div>

<p>ê·¸ëŸ¼ ServletV3ì€ ì–´ë–»ê²Œ ë°”ë€”ê¹Œ?</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@WebServlet</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"ServletV3"</span><span class="o">,</span> <span class="n">urlPatterns</span> <span class="o">=</span> <span class="s">"/controller/v3/*"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FrontControllerServletV3</span> <span class="kd">extends</span> <span class="nc">HttpServlet</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">ControllerV3</span><span class="o">&gt;</span> <span class="n">controllerV3Map</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>

    <span class="kd">public</span> <span class="nf">FrontControllerServletV3</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">controllerV3Map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/controller/v3/members/new-form"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MemberFormControllerV3</span><span class="o">());</span>
        <span class="n">controllerV3Map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/controller/v3/members/save"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MemberSaveControllerV3</span><span class="o">());</span>
        <span class="n">controllerV3Map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/controller/v3/members"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MemberListControllerV3</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">service</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">requestURI</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURI</span><span class="o">();</span>
        <span class="nc">ControllerV3</span> <span class="n">controller</span> <span class="o">=</span> <span class="n">controllerV3Map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">requestURI</span><span class="o">);</span>

        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">paramMap</span> <span class="o">=</span> <span class="n">createParamMap</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
        <span class="nc">ModelView</span> <span class="n">mv</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="na">process</span><span class="o">(</span><span class="n">paramMap</span><span class="o">);</span>
        <span class="nc">String</span> <span class="n">viewName</span> <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="na">getViewName</span><span class="o">();</span> <span class="c1">//ë…¼ë¦¬ ì´ë¦„</span>
        <span class="nc">MyView</span> <span class="n">view</span> <span class="o">=</span> <span class="n">viewResolver</span><span class="o">(</span><span class="n">viewName</span><span class="o">);</span>

        <span class="n">view</span><span class="o">.</span><span class="na">render</span><span class="o">(</span><span class="n">mv</span><span class="o">.</span><span class="na">getModel</span><span class="o">(),</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">MyView</span> <span class="nf">viewResolver</span><span class="o">(</span><span class="nc">String</span> <span class="n">viewName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">MyView</span><span class="o">(</span><span class="s">"/WEB-INF/views/"</span> <span class="o">+</span> <span class="n">viewName</span> <span class="o">+</span> <span class="s">".jsp"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="nf">createParamMap</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">paramMap</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="n">request</span><span class="o">.</span><span class="na">getParameterNames</span><span class="o">().</span><span class="na">asIterator</span><span class="o">().</span><span class="na">forEachRemaining</span><span class="o">(</span><span class="n">paramName</span> <span class="o">-&gt;</span> <span class="n">paramMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">paramName</span><span class="o">,</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="n">paramName</span><span class="o">)));</span>
        <span class="k">return</span> <span class="n">paramMap</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>ì•„ë˜ ë¶€ë¶„ì´ ìƒë‹¹íˆ ê¸¸ì–´ì¡Œë‹¤<br />
ë‚´ìš©ì„ ë³´ë©´, paramMapì„ ê°€ì ¸ì˜¤ê³ <br />
processí•œ ë¶€ë¶„ì—ì„œ viewNameì„ ê°€ì ¸ì™€ì„œ ê·¸ ë…¼ë¦¬ ì´ë¦„ì— ëŒ€í•œ
viewë¥¼ ë¦¬í„´í•´ì¤Œì„ ì•Œ ìˆ˜ ìˆë‹¤</p>

<p>ControllerëŠ” ë¬´ìŠ¨ ì¼ì„ í• ê¹Œ?</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberSaveControllerV3</span> <span class="kd">implements</span> <span class="nc">ControllerV3</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">MemberRepository</span> <span class="n">memberRepository</span> <span class="o">=</span> <span class="nc">MemberRepository</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">ModelView</span> <span class="nf">process</span><span class="o">(</span><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">paramMap</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">username</span> <span class="o">=</span> <span class="n">paramMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"username"</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">age</span> <span class="o">=</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">paramMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"age"</span><span class="o">));</span>

        <span class="nc">Member</span> <span class="n">member</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Member</span><span class="o">(</span><span class="n">username</span><span class="o">,</span> <span class="n">age</span><span class="o">);</span>
        <span class="n">memberRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>

        <span class="nc">ModelView</span> <span class="n">modelView</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ModelView</span><span class="o">(</span><span class="s">"save-result"</span><span class="o">);</span>
        <span class="n">modelView</span><span class="o">.</span><span class="na">getModel</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"member"</span><span class="o">,</span> <span class="n">member</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">modelView</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>paramMapì—ì„œ ì›í•˜ëŠ” ì •ë³´ë¥¼ getí•˜ê³  ë¡œì§ ì²˜ë¦¬í•œ í›„ì—,<br />
modelViewì— ì •ë³´ë¥¼ ë„£ì–´ì£¼ê³  ë¦¬í„´í•¨ì„ ì•Œ ìˆ˜ ìˆë‹¤</p>

<p>ì´ê±¸ ì–´ë–»ê²Œ ê°œì„ í•  ìˆ˜ ìˆì„ê¹Œ?</p>

<h1 id="servletv4">ServletV4</h1>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@WebServlet</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"ServletV4"</span><span class="o">,</span> <span class="n">urlPatterns</span> <span class="o">=</span> <span class="s">"/controller/v4/*"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FrontControllerServletV4</span> <span class="kd">extends</span> <span class="nc">HttpServlet</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">ControllerV4</span><span class="o">&gt;</span> <span class="n">controllerV4Map</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>

    <span class="kd">public</span> <span class="nf">FrontControllerServletV4</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">controllerV4Map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/controller/v4/members/new-form"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MemberFormControllerV4</span><span class="o">());</span>
        <span class="n">controllerV4Map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/controller/v4/members/save"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MemberSaveControllerV4</span><span class="o">());</span>
        <span class="n">controllerV4Map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/controller/v4/members"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MemberListControllerV4</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">service</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">requestURI</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURI</span><span class="o">();</span>
        <span class="nc">ControllerV4</span> <span class="n">controller</span> <span class="o">=</span> <span class="n">controllerV4Map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">requestURI</span><span class="o">);</span>

        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">paramMap</span> <span class="o">=</span> <span class="n">createParamMap</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">model</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="nc">String</span> <span class="n">viewName</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="na">process</span><span class="o">(</span><span class="n">paramMap</span><span class="o">,</span> <span class="n">model</span><span class="o">);</span>

        <span class="nc">MyView</span> <span class="n">view</span> <span class="o">=</span> <span class="n">viewResolver</span><span class="o">(</span><span class="n">viewName</span><span class="o">);</span>
        <span class="n">view</span><span class="o">.</span><span class="na">render</span><span class="o">(</span><span class="n">model</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">MyView</span> <span class="nf">viewResolver</span><span class="o">(</span><span class="nc">String</span> <span class="n">viewName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">MyView</span><span class="o">(</span><span class="s">"/WEB-INF/views/"</span> <span class="o">+</span> <span class="n">viewName</span> <span class="o">+</span> <span class="s">".jsp"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="nf">createParamMap</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">paramMap</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="n">request</span><span class="o">.</span><span class="na">getParameterNames</span><span class="o">().</span><span class="na">asIterator</span><span class="o">().</span><span class="na">forEachRemaining</span><span class="o">(</span><span class="n">paramName</span> <span class="o">-&gt;</span> <span class="n">paramMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">paramName</span><span class="o">,</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="n">paramName</span><span class="o">)));</span>
        <span class="k">return</span> <span class="n">paramMap</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

:ET