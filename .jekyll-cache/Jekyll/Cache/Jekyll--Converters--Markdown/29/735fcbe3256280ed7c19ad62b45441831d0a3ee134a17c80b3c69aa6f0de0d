I"×<h3 id="nodejsì˜-orm-sequelize">Node.jsì˜ ORM, sequelize</h3>

<p>ë‹¤ë“¤ ORMì— ëŒ€í•´ì„œ ë“¤ì–´ë´¤ì„ ê²ƒ ê°™ë‹¤.</p>

<h4 id="ormì´ë€">ORMì´ë€?</h4>

<blockquote>
  <p>Object-Relational Mappingìœ¼ë¡œ ê°ì²´ì™€ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì˜ ë°ì´í„°ë¥¼ ë§¤í•‘(ì—°ê²°)ì‹œì¼œì£¼ëŠ” ê²ƒ</p>
</blockquote>

<p>ORMì€ ê°ì²´-ê´€ê³„ ë§¤í•‘ì˜ ì¤„ì„ë§ì´ë‹¤.
ê°ì²´ ê°œë…ì„ êµ¬í˜„í•œ classì™€ RDB(Relational DB)ì—ì„œ ì“°ì´ëŠ” í…Œì´ë¸”ì„ ìë™ìœ¼ë¡œ ë§¤í•‘í•˜ëŠ” ê²ƒì´ë‹¤.</p>

<p>ORM í”„ë ˆì„ì›Œí¬ì˜ ê²½ìš°,</p>

<ol>
  <li>JPA/Hibernate
JPA(Java Persistence API)ëŠ” ìë°”ì˜ ORM ê¸°ìˆ  í‘œì¤€ìœ¼ë¡œ ì¸í„°í˜ì´ìŠ¤ì˜ ëª¨ìŒì´ë‹¤.
ì´ëŸ¬í•œ JPA í‘œì¤€ ëª…ì„¸ë¥¼ êµ¬í˜„í•œ êµ¬í˜„ì²´ê°€ Hibernate</li>
  <li>Sequelize
SequelizeëŠ” Postgres, MySQL, MariaDB, SQLiteë¥¼ ì§€ì›í•˜ëŠ” Promiseì— ê¸°ë°˜í•œ
ë¹„ë™ê¸°ë¡œ ë™ì‘í•˜ëŠ” Node.js ORM</li>
  <li>Django ORM
íŒŒì´ì¬ ê¸°ë°˜ í”„ë ˆì„ì›Œí¬ì¸ Djangoì—ì„œ ìì²´ì ìœ¼ë¡œ ì§€ì›í•˜ëŠ” ORM
ì •ë„ê°€ ìˆë‹¤.</li>
</ol>

<p>Node.jsë¡œì˜ sequelizeë¥¼ í•œë²ˆ ë³´ë©´ ë  ê²ƒ ê°™ë‹¤.</p>

<h4 id="sequelize-ì‹¤ìŠµ">sequelize ì‹¤ìŠµ</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ npm i sequelize mysql2
$ npm i -g sequelize-cli
$ sequelize init
</code></pre></div></div>

<p>&lt;img src=https://user-images.githubusercontent.com/46602874/129175307-0b912a6e-79bd-46ea-b39f-239cf9ad8442.png&gt;</p>

<p>sequelize initì„ í•˜ë©´
ìœ„ ì‚¬ì§„ì²˜ëŸ¼ í•„ìš”í•œ íŒŒì¼ë“¤ê³¼ í´ë”ë“¤ì´ ì•Œì•„ì„œ ì„¤ì¹˜ëœë‹¤.
ì´ˆë¡ìƒ‰ ê¸€ì”¨ì²˜ëŸ¼ ì¶”ê°€ëœ ë¶€ë¶„ì´ í‘œì‹œ ë˜ëŠ”ë°,</p>

<ul>
  <li>config: í™˜ê²½ ì„¤ì • ë¶€ë¶„</li>
  <li>models/index.js: model ì •ì˜ ë° ê´€ê³„ê°€ ì„¤ì •ë˜ëŠ” ë¶€ë¶„</li>
</ul>

<p>ì„¤ëª…ì€ ìœ„ì™€ ê°™ë‹¤.
ê°„ë‹¨í•˜ê²Œ ì½”ë“œë¥¼ í•œë²ˆ ì‚´í´ë³´ê³  ì‹¤ìŠµì„ ì§„í–‰í•´ë³´ì.</p>

<ol>
  <li>models/index.js</li>
</ol>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">fs</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">path</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">Sequelize</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">sequelize</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">basename</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">basename</span><span class="p">(</span><span class="nx">__filename</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">env</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">||</span> <span class="dl">"</span><span class="s2">development</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">/../config/config.json</span><span class="dl">"</span><span class="p">)[</span><span class="nx">env</span><span class="p">];</span>
<span class="kd">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="p">{};</span>

<span class="kd">let</span> <span class="nx">sequelize</span><span class="p">;</span>
</code></pre></div></div>

<p>NODE_ENVê°€ ì„¤ì •ë˜ì–´ ìˆì§€ ì•Šë‹¤ë©´ â€˜developmentâ€™ë¡œ ì§„í–‰ë¨ì„ ì•Œ ìˆ˜ ìˆê³ ,
config.json íŒŒì¼ì˜ í™˜ê²½ì— ë§ê²Œ configë¥¼ ì´ˆê¸°í™”í•´ì£¼ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.</p>

<p>ë°‘ì— ì½”ë“œë¥¼ ë³´ë©´ db ê°ì²´ì— sequelize íŒ¨í‚¤ì§€, ê°ì²´ë¥¼ ë„£ê³  ëª¨ë“ˆë¡œ ì‚¬ìš©í•¨ì„ ì•Œ ìˆ˜ ìˆë‹¤.</p>

<ol>
  <li>
    <p>config/config.json</p>

    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
<span class="dl">"</span><span class="s2">development</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
  <span class="dl">"</span><span class="s2">username</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">root</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">password</span><span class="dl">"</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">database</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">testdb</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">host</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">127.0.0.1</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">dialect</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">mysql</span><span class="dl">"</span>
<span class="p">},</span>
<span class="dl">"</span><span class="s2">test</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
  <span class="dl">"</span><span class="s2">username</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">root</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">password</span><span class="dl">"</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">database</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">testdb</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">host</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">127.0.0.1</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">dialect</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">mysql</span><span class="dl">"</span>
<span class="p">},</span>
<span class="dl">"</span><span class="s2">production</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
  <span class="dl">"</span><span class="s2">username</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">root</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">password</span><span class="dl">"</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">database</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">testdb</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">host</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">127.0.0.1</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">dialect</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">mysql</span><span class="dl">"</span>
<span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>

    <p>ìœ„ì— ë³´ë©´ â€œdatabaseâ€: â€œdatabase_[env]â€ í˜•ì‹ìœ¼ë¡œ ë˜ì–´ ìˆëŠ”ë°,
ìƒì„± ë˜ëŠ” ì‚¬ìš©í•˜ë ¤ëŠ” database ì´ë¦„ì„ ë„£ì–´ì£¼ì.</p>

    <p>ë‚œ â€œdatabaseâ€ ë¶€ë¶„ì€ ëª¨ë‘ â€œtestdbâ€ë¡œ ë„£ì–´ì£¼ì—ˆë‹¤.</p>
  </li>
</ol>
:ET