I"Ã?<h3 id="nodejshttp2-ì ìš©ê³¼-ë°œìƒí•œ-ì—ëŸ¬">[node.js]http2 ì ìš©ê³¼ ë°œìƒí•œ ì—ëŸ¬</h3>

<p>ë¦¬ì•¡íŠ¸ ì›¹í˜ì´ì§€ì— ì ìš©ì‹œí‚¬
ë°±ì—”ë“œ ì„œë²„ë¥¼ êµ¬ë™í•˜ëŠ” ì½”ë“œë¥¼ ì›ë˜ëŠ” ì•„ë˜ì²˜ëŸ¼ ì‘ì„±í•´ë†“ì•˜ì—ˆë‹¤.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="nx">index</span><span class="p">.</span><span class="nx">js</span>
<span class="p">...</span>
<span class="nx">express</span><span class="p">().</span><span class="nx">listen</span><span class="p">(</span><span class="nx">PORT</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">NODE_ENV</span><span class="p">}</span><span class="s2"> - API Server Start At Port </span><span class="p">${</span><span class="nx">PORT</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
</code></pre></div></div>

<p>http2ì˜ ì¥ì ì„ ì•Œê³ ,
í•´ë‹¹ ì½”ë“œë¥¼ http2ë¡œ ë³€ê²½í•´ì£¼ì—ˆë‹¤.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./config/express</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">readFileSync</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">fs</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">http2</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">http2</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">NODE_ENV</span><span class="p">,</span> <span class="nx">PORT</span><span class="p">,</span> <span class="nx">SSL_CERT_PATH</span><span class="p">,</span> <span class="nx">SSL_KEY_PATH</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">allowHTTP1</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">cert</span><span class="p">:</span> <span class="nx">readFileSync</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="nx">SSL_CERT_PATH</span><span class="p">),</span>
  <span class="na">key</span><span class="p">:</span> <span class="nx">readFileSync</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="nx">SSL_KEY_PATH</span><span class="p">),</span>
<span class="p">};</span>

<span class="nx">http2</span><span class="p">.</span><span class="nx">createSecureServer</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">express</span><span class="p">()).</span><span class="nx">listen</span><span class="p">(</span><span class="nx">PORT</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">NODE_ENV</span><span class="p">}</span><span class="s2"> - API Server Start At Port </span><span class="p">${</span><span class="nx">PORT</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<p>certì™€ keyë¥¼ ë°œê¸‰í•˜ëŠ” ë°©ë²•ì€ ê²€ìƒ‰í•˜ë©´ ë‚˜ì˜¨ë‹¤.
ì´ë ‡ê²Œ ì“¸ ì¤„ ì•Œì•˜ìœ¼ë©´ ì •ë¦¬í•´ë†“ì„ ê±¸ ê·¸ë¬ë‹¤ã…ã…
process.envë„ ì˜ ëª¨ë¥´ëŠ” ë¶„ë“¤ì€ dotenvë¥¼ ê²€ìƒ‰í•´ë³´ë©´ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤.</p>

<p>ì´ë ‡ê²Œ êµ¬ì„±í•´ë†“ìœ¼ë©´ ì•„ë˜ì²˜ëŸ¼ postmanì—ì„œëŠ” ê²°ê³¼ê°€ ì˜ ë¿Œë ¤ì§€ëŠ” ê±¸ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>

<p><img src="https://user-images.githubusercontent.com/46602874/130570176-61335751-30dc-498e-bf9b-b51245906841.png" /></p>

<p>ê·¸ëŸ°ë° ì›¹í˜ì´ì§€ë¥¼ ë“¤ì–´ê°€ë³´ë©´ ì•„ë˜ì²˜ëŸ¼ í†µì‹ ì´ ì˜ ë˜ì§€ ì•ŠëŠ” ëª¨ìŠµì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>

<p><img src="https://user-images.githubusercontent.com/46602874/130570474-3a480ef1-f696-4699-b332-267e41f9b711.png" /></p>

<p>ë˜, https://localhost:4000 ìœ¼ë¡œ ì§ì ‘ ë“¤ì–´ê°€ë©´ ì•„ë˜ì²˜ëŸ¼ ì—ëŸ¬ ë©”ì‹œì§€ê°€ ëœ¨ê³ ,
ê°‘ìê¸° ì„œë²„ê°€ êº¼ì§€ëŠ” ê±¸ ì•Œ ìˆ˜ ìˆë‹¤.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">development</span> <span class="o">-</span> <span class="nx">API</span> <span class="nx">Server</span> <span class="nx">Start</span> <span class="nx">At</span> <span class="nx">Port</span> <span class="mi">4000</span>
<span class="nx">_http_incoming</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">120</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">socket</span><span class="p">.</span><span class="nx">readable</span><span class="p">)</span>
                  <span class="o">^</span>

<span class="nx">TypeError</span><span class="p">:</span> <span class="nx">Cannot</span> <span class="nx">read</span> <span class="nx">property</span> <span class="dl">'</span><span class="s1">readable</span><span class="dl">'</span> <span class="k">of</span> <span class="kc">undefined</span>
    <span class="nx">at</span> <span class="nx">IncomingMessage</span><span class="p">.</span><span class="nx">_read</span> <span class="p">(</span><span class="nx">_http_incoming</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">120</span><span class="p">:</span><span class="mi">19</span><span class="p">)</span>
    <span class="nx">at</span> <span class="nx">IncomingMessage</span><span class="p">.</span><span class="nx">Readable</span><span class="p">.</span><span class="nx">read</span> <span class="p">(</span><span class="nx">internal</span><span class="o">/</span><span class="nx">streams</span><span class="o">/</span><span class="nx">readable</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">462</span><span class="p">:</span><span class="mi">10</span><span class="p">)</span>
    <span class="nx">at</span> <span class="nx">resume_</span> <span class="p">(</span><span class="nx">internal</span><span class="o">/</span><span class="nx">streams</span><span class="o">/</span><span class="nx">readable</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">958</span><span class="p">:</span><span class="mi">12</span><span class="p">)</span>
    <span class="nx">at</span> <span class="nx">processTicksAndRejections</span> <span class="p">(</span><span class="nx">internal</span><span class="o">/</span><span class="nx">process</span><span class="o">/</span><span class="nx">task_queues</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">82</span><span class="p">:</span><span class="mi">21</span><span class="p">)</span>
</code></pre></div></div>

<p><a href="https://javascript.plainenglish.io/serving-hello-world-with-http2-and-express-js-4dd0ffe76860">ì—ëŸ¬ í•´ê²° ìœ„í•œ ë§í¬1</a></p>

<p>ìœ„ì˜ ë§í¬ì—ì„œ http2-express-bridgeì— ëŒ€í•œ ì´ì•¼ê¸°ë¥¼ í•´ì£¼ì—ˆê³ ,
configì˜ express.jsì—ì„œ <code class="language-plaintext highlighter-rouge">http2-express-bridge</code>ëª¨ë“ˆì„ ì‚¬ìš©í•˜ì˜€ë‹¤.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">#</span> <span class="nx">config</span><span class="o">/</span><span class="nx">express</span><span class="p">.</span><span class="nx">js</span>

<span class="p">...</span>
<span class="kd">const</span> <span class="nx">http2Express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">http2-express-bridge</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">http2Express</span><span class="p">(</span><span class="nx">express</span><span class="p">);</span>
  <span class="c1">// express();</span>

  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">compression</span><span class="p">());</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>

  <span class="p">...</span>

</code></pre></div></div>

<p>ê·¸ëŸ°ë° ì—ëŸ¬ëŠ” í•´ê²°ë˜ì§€ ì•Šì•˜ê³ 
ì´ë²ˆì—ëŠ” ë˜ ì•„ë˜ì˜ ì—ëŸ¬ê°€ ë‚˜íƒ€ë‚¬ë‹¤.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">index</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">103</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_implicitHeader</span><span class="p">()</span>
             <span class="o">^</span>

<span class="nx">TypeError</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">_implicitHeader</span> <span class="nx">is</span> <span class="nx">not</span> <span class="nx">a</span> <span class="kd">function</span>
    <span class="nx">at</span> <span class="nx">Http2ServerResponse</span><span class="p">.</span><span class="nx">end</span> <span class="p">(</span><span class="sr">/Users/</span><span class="nx">we</span><span class="o">/</span><span class="nx">Documents</span><span class="o">/</span><span class="nx">user</span><span class="o">/</span><span class="nx">git</span><span class="o">-</span><span class="nx">node</span><span class="o">-</span><span class="nx">board</span><span class="o">/</span><span class="nx">server</span><span class="o">/</span><span class="nx">node_modules</span><span class="o">/</span><span class="nx">compression</span><span class="o">/</span><span class="nx">index</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">103</span><span class="p">:</span><span class="mi">14</span><span class="p">)</span>
    <span class="nx">at</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">write</span> <span class="p">(</span><span class="sr">/Users/</span><span class="nx">we</span><span class="o">/</span><span class="nx">Documents</span><span class="o">/</span><span class="nx">user</span><span class="o">/</span><span class="nx">git</span><span class="o">-</span><span class="nx">node</span><span class="o">-</span><span class="nx">board</span><span class="o">/</span><span class="nx">server</span><span class="o">/</span><span class="nx">node_modules</span><span class="o">/</span><span class="nx">finalhandler</span><span class="o">/</span><span class="nx">index</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">297</span><span class="p">:</span><span class="mi">9</span><span class="p">)</span>
    <span class="nx">at</span> <span class="nx">listener</span> <span class="p">(</span><span class="sr">/Users/</span><span class="nx">we</span><span class="o">/</span><span class="nx">Documents</span><span class="o">/</span><span class="nx">user</span><span class="o">/</span><span class="nx">git</span><span class="o">-</span><span class="nx">node</span><span class="o">-</span><span class="nx">board</span><span class="o">/</span><span class="nx">server</span><span class="o">/</span><span class="nx">node_modules</span><span class="o">/</span><span class="nx">on</span><span class="o">-</span><span class="nx">finished</span><span class="o">/</span><span class="nx">index</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">169</span><span class="p">:</span><span class="mi">15</span><span class="p">)</span>
    <span class="nx">at</span> <span class="nx">onFinish</span> <span class="p">(</span><span class="sr">/Users/</span><span class="nx">we</span><span class="o">/</span><span class="nx">Documents</span><span class="o">/</span><span class="nx">user</span><span class="o">/</span><span class="nx">git</span><span class="o">-</span><span class="nx">node</span><span class="o">-</span><span class="nx">board</span><span class="o">/</span><span class="nx">server</span><span class="o">/</span><span class="nx">node_modules</span><span class="o">/</span><span class="nx">on</span><span class="o">-</span><span class="nx">finished</span><span class="o">/</span><span class="nx">index</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">100</span><span class="p">:</span><span class="mi">5</span><span class="p">)</span>
    <span class="nx">at</span> <span class="nx">callback</span> <span class="p">(</span><span class="sr">/Users/</span><span class="nx">we</span><span class="o">/</span><span class="nx">Documents</span><span class="o">/</span><span class="nx">user</span><span class="o">/</span><span class="nx">git</span><span class="o">-</span><span class="nx">node</span><span class="o">-</span><span class="nx">board</span><span class="o">/</span><span class="nx">server</span><span class="o">/</span><span class="nx">node_modules</span><span class="o">/</span><span class="nx">ee</span><span class="o">-</span><span class="nx">first</span><span class="o">/</span><span class="nx">index</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">10</span><span class="p">)</span>
    <span class="nx">at</span> <span class="nx">Http2ServerRequest</span><span class="p">.</span><span class="nx">onevent</span> <span class="p">(</span><span class="sr">/Users/</span><span class="nx">we</span><span class="o">/</span><span class="nx">Documents</span><span class="o">/</span><span class="nx">user</span><span class="o">/</span><span class="nx">git</span><span class="o">-</span><span class="nx">node</span><span class="o">-</span><span class="nx">board</span><span class="o">/</span><span class="nx">server</span><span class="o">/</span><span class="nx">node_modules</span><span class="o">/</span><span class="nx">ee</span><span class="o">-</span><span class="nx">first</span><span class="o">/</span><span class="nx">index</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">93</span><span class="p">:</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div></div>

<p>í•œ 2ì‹œê°„ ë™ì•ˆ ê³„ì† ê²€ìƒ‰í•œ ê²ƒ ê°™ë‹¤â€¦
ì´ ì—ëŸ¬ë¥¼ ê³ ì¹˜ê¸° ìœ„í•´ì„œëŠ”
ì¼ë‹¨ node_modules/compression/index.jsë¡œ ë“¤ì–´ê°„ë‹¤.</p>

<p><a href="https://github.com/expressjs/compression/pull/127/commits/dbf7e73fee65375ae3ee10a75344481e44f63994">ì—ëŸ¬ í•´ê²° ìœ„í•œ ë§í¬2</a></p>

<p>ìœ„ì˜ ë§í¬ì— ë‚˜ì™€ìˆëŠ” ê²ƒì²˜ëŸ¼,
<code class="language-plaintext highlighter-rouge">// 0824 ë³€ê²½</code> ì•„ë˜ ë¶€ë¶„ìœ¼ë¡œ ë°”ê¿”ì¤€ë‹¤.</p>

<p><img src="https://user-images.githubusercontent.com/46602874/130571254-5fa03226-ccb5-4e4b-aa01-348c26d287b6.png" /></p>

<p>ê·¸ëŸ¼ ë°±ì—”ë“œë‹¨ api ë§í¬ë¡œ ë“¤ì–´ê°”ì„ ë•Œ,
ì˜ ë‚˜ì˜¤ëŠ” ëª¨ìŠµì„ ì•Œ ìˆ˜ ìˆë‹¤.</p>

<p><img src="https://user-images.githubusercontent.com/46602874/130571419-529ef2e7-8d89-41de-8511-eb81e7916448.png" /></p>
:ET