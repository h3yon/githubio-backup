<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.2.1">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2022-01-10T00:05:19+09:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">개구리의 깃허브 블로그</title><subtitle>🌿 성장하는 개구리 h3yon 블로그입니다</subtitle><author><name>🐸 SW developer</name></author><entry><title type="html">[Java]자바의 정석 Chapter5-6</title><link href="http://localhost:4000/java/JavaStudy-1-Array/" rel="alternate" type="text/html" title="[Java]자바의 정석 Chapter5-6" /><published>2022-01-04T00:00:00+09:00</published><updated>2022-01-04T00:00:00+09:00</updated><id>http://localhost:4000/java/JavaStudy#1-Array</id><content type="html" xml:base="http://localhost:4000/java/JavaStudy-1-Array/"><![CDATA[<h1 id="자바의-정석-chapter56">자바의 정석 Chapter5,6</h1>

<p>생성일: 2022년 1월 4일 오후 12:46
태그: Array, Java</p>

<h1 id="chapter5-1-배열">Chapter5-1. 배열</h1>

<p><code class="language-plaintext highlighter-rouge">같은 타입</code>의 여러 변수를 하나의 묶음으로 다루는 것</p>

<h2 id="배열의-선언과-생성">배열의 선언과 생성</h2>

<p>배열의 선언</p>

<table>
  <thead>
    <tr>
      <th>선언 방법</th>
      <th>선언 예</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>타입[] 변수이름;</td>
      <td>int[] score;</td>
    </tr>
    <tr>
      <td>String[] name;</td>
      <td> </td>
    </tr>
    <tr>
      <td>타입 변수이름[];</td>
      <td>int score[];</td>
    </tr>
    <tr>
      <td>String name[];</td>
      <td> </td>
    </tr>
  </tbody>
</table>

<p>배열의 선언과 생성</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">타입</span><span class="o">[]</span> <span class="n">변수이름</span><span class="o">;</span>
<span class="n">변수이름</span> <span class="o">=</span> <span class="k">new</span> <span class="n">타입</span><span class="o">[</span><span class="n">길이</span><span class="o">];</span>

<span class="n">ex</span><span class="o">)</span>
<span class="mi">1</span><span class="n">번</span> <span class="n">예시</span>
<span class="kt">int</span><span class="o">[]</span> <span class="n">score</span><span class="o">;</span>
<span class="n">score</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="mi">5</span><span class="o">];</span> <span class="c1">//공간이 마련된다</span>

<span class="mi">2</span><span class="n">번</span> <span class="n">예시</span>
<span class="kt">int</span><span class="o">[]</span> <span class="n">score</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="mi">5</span><span class="o">];</span>
</code></pre></div></div>

<h2 id="배열의-길이와-인덱스">배열의 길이와 인덱스</h2>

<p>배열 관련 퀴즈</p>

<ul>
  <li>배열의 각 저장공간을 뭐라고 할까? <em>배열의 요소</em></li>
  <li>배열의 요소마다 붙여진 일련번호? <em>인덱스</em></li>
  <li>배열 arr = new int[5]라고 가정할 때, arr[5] = 100;이라고 한다면 당연히 잘못된 부분.
컴파일러는 얘가 잘못되었다는 것을 알 수 있을까?
<em>NO! ArrayIndexOutOfBoundsException(<code class="language-plaintext highlighter-rouge">RuntimeException</code>, 실행 시 발생하는 에러) 발생</em></li>
</ul>

<dl>
  <dt>배열의 길이</dt>
  <dd>
    <p>배열 요소의 개수, 즉 값을 저장할 수 있는 공간의 개수이다. <code class="language-plaintext highlighter-rouge">배열이름.length</code>로 배열의 길이를 구할 수 있다. 배열은 한번 선언되고 나면 <code class="language-plaintext highlighter-rouge">길이를 변경할 수 없</code>다. 배열에 저장할 공간이 부족한 경우 더 큰 길이의 새로운 배열을 생성한 후, 기존 배열 값들을 새로운 배열에 복사하면 된다. 배열 길이를 너무 크게 잡으면 메모리 낭비이니까, 기존의 2배 길이로 생성하는 것이 좋다.</p>
  </dd>
</dl>

<p>관련 퀴즈</p>

<ul>
  <li>length() vs length?
<em>length()는 문자열의 길이,
length는 배열의 길이를 구할 때 사용</em></li>
  <li>배열이름.length로 배열의 길이를 알 수 있다. 자바에서는 어떤 것이 모든 배열의 길이를 별도로 관리할까?
<em>JVM</em></li>
</ul>

<h2 id="배열의-초기화">배열의 초기화</h2>

<ol>
  <li>
    <p>각 요소마다 값을 지정해주는 방법</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span><span class="o">[]</span> <span class="n">score</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="mi">3</span><span class="o">];</span>
<span class="kt">int</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="mi">50</span><span class="o">;</span>
<span class="kt">int</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">=</span> <span class="mi">40</span><span class="o">;</span>
<span class="kt">int</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="o">=</span> <span class="mi">30</span><span class="o">;</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>for문 사용</p>

    <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">int</span><span class="p">[]</span> <span class="n">score</span> <span class="o">=</span> <span class="n">new</span> <span class="n">int</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<span class="n">for</span><span class="p">(</span><span class="n">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">score</span><span class="o">.</span><span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
	<span class="n">score</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="mi">50</span><span class="p">;</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>그냥 초기화
선언과 초기화가 따로 이루어질 경우, new int[]는 생략할 수 없다. 메서드 인자로 배열을 넘길 때도 생략 불가능하다.
<code class="language-plaintext highlighter-rouge">java //배열의 생성과 초기화 동시에, 길이를 안 적어주어도 됨 int[] score = new int[]{50, 40, 30}; //new int[]생략 가능 int[] score = {50, 40, 30}; </code></p>
  </li>
</ol>

<p>퀴즈</p>

<ul>
  <li>아래 result1,2는 에러가 발생할까?
    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">add</span><span class="o">(</span><span class="kt">int</span><span class="o">[]</span> <span class="n">arr</span><span class="o">){</span> <span class="cm">/* 생략 */</span><span class="o">}</span>
<span class="kt">int</span> <span class="n">result1</span> <span class="o">=</span> <span class="n">add</span><span class="o">(</span><span class="k">new</span> <span class="kt">int</span><span class="o">[]{</span><span class="mi">50</span><span class="o">,</span> <span class="mi">40</span><span class="o">,</span> <span class="mi">30</span><span class="o">});</span>
<span class="kt">int</span> <span class="n">result2</span> <span class="o">=</span> <span class="n">add</span><span class="o">({</span><span class="mi">50</span><span class="o">,</span> <span class="mi">40</span><span class="o">,</span> <span class="mi">30</span><span class="o">});</span>
</code></pre></div>    </div>
    <p><em>result1은 OK, 2는 에러 → new int[] 생략 불가능. 메서드 인자로 배열을 직접 넘기는 경우, new int[]를 생략할 수 없다.</em></p>
  </li>
</ul>

<h2 id="배열의-출력">배열의 출력</h2>

<p>아래처럼 for문을 사용하거나 Arrays의 toString을 사용한다. 배열을 그냥 출력하면 주소값이 나온다. 하지만 char의 배열이면 배열을 그냥 출력해도 요소가 제대로 나옴을 아래처럼 확인할 수 있다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">arr</span> <span class="o">=</span> <span class="o">{</span><span class="mi">100</span><span class="o">,</span> <span class="mi">95</span><span class="o">,</span> <span class="mi">80</span><span class="o">,</span> <span class="mi">70</span><span class="o">,</span> <span class="mi">60</span><span class="o">};</span>

<span class="c1">//1번 for문 사용 -&gt; 배열의 요소 출력</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">arr</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">arr</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">+</span> <span class="s">" "</span><span class="o">);</span> <span class="c1">//100 95 80 70 60</span>
<span class="o">}</span>

<span class="c1">//2번 toString 사용 -&gt; 배열의 요소 출력</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">arr</span><span class="o">));</span> <span class="c1">//[100, 95, 80, 70, 60]</span>

<span class="c1">//배열의 주소 출력</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">arr</span><span class="o">);</span> <span class="c1">//I@14318bb</span>

<span class="c1">//char배열의 요소 출력</span>
<span class="kt">char</span><span class="o">[]</span> <span class="n">chars</span> <span class="o">=</span> <span class="o">{</span> <span class="sc">'a'</span><span class="o">,</span> <span class="sc">'b'</span><span class="o">,</span> <span class="sc">'c'</span><span class="o">,</span> <span class="sc">'d'</span> <span class="o">};</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">chars</span><span class="o">);</span> <span class="c1">//abcd</span>
</code></pre></div></div>

<h2 id="배열의-복사">배열의 복사</h2>

<p>배열은 한번 생성하면 길이 변경이 불가능하니까 이전 배열 내용을 복사해야 한다고 했다. 방법을 살펴보자</p>

<ol>
  <li>
    <p>for문 사용</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span><span class="o">[]</span> <span class="n">arr</span> <span class="o">=</span> <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">};</span>
<span class="kt">int</span><span class="o">[]</span> <span class="n">tmp</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="mi">5</span><span class="o">];</span>
<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">arr</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
	<span class="n">tmp</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">arr</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
<span class="o">}</span>
<span class="n">arr</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">;</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>arrayCopy() 사용</p>

    <p><img src="/assets/images/javastudy1/Untitled.png" alt="Untitled" /></p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">System</span><span class="o">.</span><span class="na">arraycopy</span><span class="o">(</span><span class="n">arr1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="n">arr2</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">);</span>
              <span class="c1">//arr1[1]에서 arr2[2]으로 3개의 데이터를 복사</span>
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="배열의-활용">배열의 활용</h2>

<ul>
  <li>총합과 평균: 둘중 타입이 다르면 average 구할 때 sum / (float)score.length 한쪽에 얻으려는 타입 사용</li>
  <li>최대값과 최소값: Math.max, Math.min 사용</li>
  <li>셔플</li>
</ul>

<p><img src="/assets/images/javastudy1/Untitled%201.png" alt="Untitled" /></p>

<ul>
  <li>임의의 값으로 배열 채우기
    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">arr</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
	<span class="kt">int</span> <span class="n">tmp</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="nc">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()</span> <span class="o">*</span> <span class="n">code</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
	<span class="n">arr</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">code</span><span class="o">[</span><span class="n">tmp</span><span class="o">];</span>
<span class="o">}</span>
</code></pre></div>    </div>
    <p>etc</p>
  </li>
</ul>

<h1 id="chapter5-2-string-배열">Chapter5-2. String 배열</h1>

<p>String 배열도 다른 배열과 마찬가지로 선언, 초기화됨을 알 수 있다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">String</span><span class="o">[]</span> <span class="n">names</span> <span class="o">=</span> <span class="o">{</span><span class="s">"Kim"</span><span class="o">,</span> <span class="s">"Park"</span><span class="o">,</span> <span class="s">"Yi"</span><span class="o">};</span>

<span class="nc">String</span><span class="o">[]</span> <span class="n">name</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">String</span><span class="o">[</span><span class="mi">2</span><span class="o">];</span>
<span class="n">name</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="s">"Kim"</span><span class="o">;</span> <span class="c1">//원래 new String("Kim")으로 객체를 생성해야 한다.</span>
<span class="n">name</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">=</span> <span class="s">"Park"</span><span class="o">;</span>
</code></pre></div></div>

<h2 id="char-배열과-string-클래스">char 배열과 String 클래스</h2>

<p>문자열은 문자배열인 char배열과 같은 뜻이다. String 클래스는 char 배열에 기능(메서드)을 추가한 것이다. 이 char배열과 String 클래스의 한 가지 중요한 차이는 무엇일까? <em><code class="language-plaintext highlighter-rouge">String 객체(문자열)는 읽을 수만 있고 내용을 변경할 수는 없다는 것이다.</code></em></p>

<p>String의 주요 메서드로는 char <strong>charAt</strong>(int index), int <strong>length</strong>(), String <strong>substring</strong>(int from, int to), boolean <strong>equals</strong>(Object obj), char[] <strong>toCharArray</strong> 등이 있다.</p>

<h3 id="커맨드-라인을-통해-입력-받기">커맨드 라인을 통해 입력 받기</h3>

<p>public static void main(String[] args) → 커맨드라인을 통해 입력 받음. 입력하지 않으면 null이 아니라 크기가 0인 배열이 생성되어 args.length의 값은 0이 된다.</p>

<h1 id="chapter5-3-다차원-배열">Chapter5-3 다차원 배열</h1>

<p><img src="/assets/images/javastudy1/Untitled%202.png" alt="Untitled" /></p>

<p>’[]’만 추가될 뿐 앞이랑 비슷함을 알 수 있다.</p>

<h3 id="가변배열">가변배열</h3>

<p><img src="/assets/images/javastudy1/Untitled%203.png" alt="Untitled" /></p>

<p>오른쪽처럼 각 행마다 다른 길이의 배열을 생성하는 것이 가능하다.</p>

<h3 id="다차원-배열의-활용">다차원 배열의 활용</h3>

<p>→ 패스(꼭 읽기)</p>

<h3 id="array-vs-arraylist-vs-list">Array vs ArrayList vs List</h3>

<p>Array: 배열 크기 변경 불가능 <strong>cache hit</strong> 가능성이 커져서 성능에 큰 도움,</p>

<p>List: 인덱스 장점 버리고 빈틈없는 데이터의 적재. 순서가 있는 데이터의 모임. 순차성을 보장하지 못하기 때문에 special locality 보장이 어렵지 않아서 cash hit이 어렵다(,,,,,)</p>

<p><img src="/assets/images/javastudy1/Untitled%204.png" alt="Untitled" /></p>

<p>ArrayList: 배열 이용해서 리스트 구현한 것. 인덱스 값을 기준으로 <strong>어디든</strong> 한번에 참조 가능하다. 조회 기능에 성능이 뛰어나다. ArrayList Object는 ArrayList의 size를 나타내는 <strong><code class="language-plaintext highlighter-rouge">capacity</code></strong> 인스턴스 변수를 가지고 있다. ArrayList에 요소들이 더해지면 capacity도 자동적으로 늘어난다. 설정한 capacity보다 많은 객체가 들어오면, 배열 크기를 <strong>1.5배</strong> 증가시킨다. ArrayList의 Default 저장용량은 10. <code class="language-plaintext highlighter-rouge">이 자동 resize 때문에 성능을 낮출 것</code>ArrayList는 <code class="language-plaintext highlighter-rouge">primitive data types(int, float, double etc)을 가질 수 없다</code>. 오직 Object만을 가질 수 있다.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>List&lt;Element&gt; elementList = new ArrayList&lt;&gt;();
iterator.forEachRemaining(elementList::add);
</code></pre></div></div>

<p>LinkedList: 양방향 포인터 구조로 데이터의 삽입/삭제가 빈번할 경우 위치 정보만 수정하면 되기 때문에 큐, 양방향 큐 등을 만들기 위한 용도로 쓰인다.</p>

<p><img src="/assets/images/javastudy1/Untitled%205.png" alt="Untitled" /></p>

<p><img src="/assets/images/javastudy1/Untitled%206.png" alt="Untitled" /></p>

<p>array와 arrayList 차이는 위와 같다.</p>

<h1 id="chpater06-oop">Chpater06 OOP</h1>

<p>채버 6을 살펴보자</p>

<h1 id="객체지향언어">객체지향언어</h1>

<p>객체지향 기본 개념: 실제 세계는 사물(객체)로 이루어져 있으며, 발생하는 모든 사건들은 사물간의 상호작용이다. 실제 사물 속성,기능을 분석한 다음 데이터(변수)와 함수로 정의함으로써 많은 시간과 비용을 절약할 수 있었다.</p>

<p>객체지향언어의 주요 특징</p>

<ol>
  <li>코드의 재사용성이 높다.</li>
  <li>코드의 관리가 용이하다.
관계를 이용해서 적은 노력으로 쉽게 코드 변경이 가능하다.</li>
  <li>신뢰성이 높은 프로그래밍을 가능하게 한다.
제어자와 메서드를 이용해서 데이터를 보호하고 올바른 값을 유지하도록 하며, 코드의 중복을 제거하여 코드의 불일치로 인한 오동작을 방지할 수 있다.</li>
</ol>

<h2 id="클래스와-객체">클래스와 객체</h2>

<p><img src="/assets/images/javastudy1/Untitled%207.png" alt="Untitled" /></p>

<p>클래스는 객체를 정의해놓은 것이며, 객체를 생성하는데 사용된다. 객체는 실제로 존재하는 것으로 사물 또는 개념이며, 객체가 갖는 기능과 속성에 따라 용도가 다르다.</p>

<h2 id="객체와-인스턴스">객체와 인스턴스</h2>

<p>클래스로부터 <code class="language-plaintext highlighter-rouge">객체를 만드는 과정</code>을 클래스의 <code class="language-plaintext highlighter-rouge">인스턴스화</code>라고 하며, 클래스로부터 만들어진 <code class="language-plaintext highlighter-rouge">객체</code>를 그 클래스의 <code class="language-plaintext highlighter-rouge">인스턴스</code>라고 한다.</p>

<p>객체의 구성요소</p>

<p>:속성은 변수로, 기능은 메서드</p>

<p>인스턴스 생성과 사용</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//인스턴스화, tv라는 참조변수 사용</span>
<span class="nc">Tv</span> <span class="n">tv</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Tv</span><span class="o">();</span>
<span class="c1">//인스턴스 사용, 멤버변수 channel에 값 저장</span>
<span class="n">tv</span><span class="o">.</span><span class="na">channel</span> <span class="o">=</span> <span class="mi">3</span><span class="o">;</span>
</code></pre></div></div>

<p>인스턴스는 참조변수를 통해서만 다룰 수 있으며, 참조변수의 타입은 인스턴스의 타입과 일치해야 한다. 같은 클래스여도 각 인스턴스의 속성(멤버변수)는 서로 다른 값을 유지할 수 있으며, 메서드의 내용은 모든 인스턴스에 대해 동일하다.</p>

<p>참조변수와 인스턴스의 관계</p>

<p><img src="/assets/images/javastudy1/Untitled%208.png" alt="Untitled" /></p>

<p>이렇듯, 둘 이상의 참조변수가 하나의 인스턴스를 가리키는(참조하는) 것은 가능하다. 하지만 하나의 참조변수로 여러 개의 인스턴스를 가리키는 것은 가능하지 않다</p>

<h2 id="객체-배열">객체 배열</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Tv</span> <span class="n">tv1</span><span class="o">,</span> <span class="n">tv2</span><span class="o">,</span> <span class="n">tv3</span><span class="o">;</span>

<span class="nc">Tv</span><span class="o">[]</span> <span class="n">tvArr</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Tv</span><span class="o">[</span><span class="mi">3</span><span class="o">];</span>
<span class="n">tvArr</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Tv</span><span class="o">();</span>
<span class="n">tvArr</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Tv</span><span class="o">();</span>
<span class="n">tvArr</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Tv</span><span class="o">();</span>

<span class="nc">Tv</span><span class="o">[]</span> <span class="n">tvArr</span> <span class="o">=</span> <span class="o">{</span> <span class="k">new</span> <span class="nc">Tv</span><span class="o">(),</span> <span class="k">new</span> <span class="nc">Tv</span><span class="o">(),</span> <span class="k">new</span> <span class="nc">Tv</span><span class="o">()</span> <span class="o">};</span>
</code></pre></div></div>

<h2 id="클래스의-또-다른-정의">클래스의 또 다른 정의</h2>

<ol>
  <li>
    <p>클래스: 데이터와 함수의 결합</p>

    <p><img src="/assets/images/javastudy1/Untitled%209.png" alt="Untitled" /></p>

    <ul>
      <li>변수: 하나의 데이터 저장 가능한 공간</li>
      <li>배열: 같은 타입 여러 데이터 저장 가능한 공간</li>
      <li>구조체: 타입 상관 없이 관련된 데이터 저장 가능한 공간</li>
      <li>클래스: 데이터와 함수의 결합(구조체 + 함수)</li>
    </ul>
  </li>
  <li>
    <p>클래스: 사용자 정의 타입
서로 관련된 변수들을 묶어서 하나의 타입으로 새로 추가하는 것
<img src="/assets/images/javastudy1/Untitled%2010.png" alt="Untitled" /></p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ex) 아래로 갈수록 시분초, 시분초 각 3개, 시분초 각 n개를 다룸을 알수 O. 오른쪽으로 갈수록 비객체지향적코드 → 객체지향적코드
</code></pre></div>    </div>
  </li>
</ol>

<h1 id="변수와-메서드">변수와 메서드</h1>

<p><img src="/assets/images/javastudy1/Untitled%2011.png" alt="Untitled" /></p>

<p><img src="/assets/images/javastudy1/Untitled%2012.png" alt="Untitled" /></p>

<p>클래스 변수는 인스턴스 변수 앞에 static을 붙이기만 하면 된다. 클래스 변수는 모든 인스턴스가 공통된 저장공간을 공유하게 한다. 인스턴스 생성하지 않아도 언제든 사용 가능하다. 클래스가 메모리에 올라갈 때 생성되어 프로그램이 종료될 때까지 유지된다.</p>

<h2 id="클래스-변수와-인스턴스-변수">클래스 변수와 인스턴스 변수</h2>

<p><img src="/assets/images/javastudy1/Untitled%2013.png" alt="Untitled" /></p>

<p><img src="/assets/images/javastudy1/Untitled%2014.png" alt="Untitled" /></p>

<p>예시를 들어보면, 무늬와 숫자는 인스턴스변수, 폭과 높이는 클래스변수이다. 한 인스턴스 c1에서 폭값을 바꾸면 클래스 변수이기 때문에 다른 인스턴스 c2의 폭값도 바뀐다.(같은 저장공간 참조)</p>

<p><strong>요약</strong>) 인스턴스변수는 인스턴스가 생성될 때마다 생성되므로 인스턴스마다 각기 다른 값을 유지할 수 있지만, 클래스변수는 모든 인스턴스가 하나의 저장공간을 공유하므로 항상 공통된 값을 갖는다.</p>

<p>그래서 클래스 변수가 Method, 인스턴스 변수가 Heap에 있다!</p>

<h2 id="메서드">메서드</h2>

<p>특정 작업을 수행하는 일련의 문장들을 묶은 것. 메서드를 내부가 보이지 않는 블랙박스라고도 한다. 입력과 출력만 알면 되기 때문이다.</p>

<p>메서드를 사용하는 이유</p>

<ol>
  <li>높은 재사용성</li>
  <li>중복된 코드 제거</li>
  <li>프로그램의 구조화(분리)</li>
</ol>

<p>메서드의 선언, 선언부, 구현부, 메서드의 이름, 반환타입, 반환값, return 문, 지역변수 등 메서드의 예시에서 확인할 수 있다.</p>

<p><img src="/assets/images/javastudy1/Untitled%2015.png" alt="Untitled" /></p>

<p>호출은 메서드 이름(인자들)로 사용하고, add(long a, long b)여도 add(1,2) int가 사용될 수 있는 것처럼 자동형변환이 가능한 값을 지정해야 한다.</p>

<h2 id="jvm의-메모리-구조">JVM의 메모리 구조</h2>

<p><img src="/assets/images/javastudy1/Untitled%2016.png" alt="Untitled" /></p>

<ul>
  <li>메서드가 호출되면 수행에 필요한 메모리를 스택에 할당받는다.</li>
  <li>메서드가 수행을 마치면 사용했던 메모리를 반환한다.</li>
  <li>호출스택의 제일 위에 있는 메서드가 현재 실행중인 메서드다.</li>
  <li>아래에 있는 메서드가 바로 위의 메서드를 호출한 메서드다.</li>
</ul>

<h2 id="기본형-매개변수와-참조형-매개변수">기본형 매개변수와 참조형 매개변수</h2>

<p>▶ 기본형(Primitive) 매개변수 – 변수의 값을 읽기만 할 수 있다.(read only)
→ d.x를 인자로 넣어주었을 때 x의 값이 1000으로 변경되지만 x는 스택에서 제거됨</p>

<p><img src="/assets/images/javastudy1/Untitled%2017.png" alt="Untitled" /></p>

<p>▶ 참조형(Reference) 매개변수 – 변수의 값을 읽고 변경할 수 있다.(read &amp; write)
→ d가 넘겨져서 그 주소값으로 x에 접근이 가능. d의 x값 변경 후 d는 스택에서 제거됨</p>

<p><img src="/assets/images/javastudy1/Untitled%2018.png" alt="Untitled" /></p>

<ul>
  <li>
    <p>여기서 퀴즈! 틀린 부분은?
배열을 넣어도 값이 잘 바뀌는 걸 알 수 있다. Data클래스 타입도 참조 변수로 같은 결과를 얻는다. 간단히 처리할 때는 별도의 클래스를 선언하는 것보다 이렇게 배열을 사용할 수 있다</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">ReferenceParamEx2</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span>
  <span class="o">{</span>
		<span class="kt">int</span><span class="o">[]</span> <span class="n">x</span> <span class="o">=</span> <span class="o">{</span><span class="mi">10</span><span class="o">};</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"main() : x = "</span> <span class="o">+</span> <span class="n">x</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span> <span class="c1">//10</span>

		<span class="n">change</span><span class="o">(</span><span class="n">x</span><span class="o">);</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"After change(x)"</span><span class="o">);</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"main() : x = "</span> <span class="o">+</span> <span class="n">x</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span> <span class="c1">//1000</span>
	<span class="o">}</span>

	<span class="kt">void</span> <span class="nf">change</span><span class="o">(</span><span class="kt">int</span><span class="o">[]</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">x</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="o">;</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"change() : x = "</span> <span class="o">+</span> <span class="n">x</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span> <span class="c1">//1000</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div>    </div>

    <p><em>static void change void 앞에 static이 사용되어야 함. static void main에서 사용되기 때문.
(뒤에서 더 자세히 다룰 예정)</em>
실행결과: <a href="https://ideone.com/xUVB0h">https://ideone.com/xUVB0h</a>
<img src="/assets/images/javastudy1/Untitled%2019.png" alt="Untitled" /></p>
  </li>
</ul>

<h2 id="재귀-호출recursive-call">재귀 호출(recursive call)</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">method</span><span class="o">(){</span>
	<span class="n">method</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>: 메서드 내에서 자기자신을 반복적으로 호출하는 것이다. <code class="language-plaintext highlighter-rouge">call by value</code>를 통해 복사된 값을 작업한다. 자기 자신을 호출하기 때문에 <code class="language-plaintext highlighter-rouge">조건문</code>이 없으면 무한루프에 빠진다. → 반복문으로 작성 가능</p>

<p><img src="/assets/images/javastudy1/Untitled%2020.png" alt="Untitled" /></p>

<p>반복문은 같은 문장을 계속 반복하는거지만, 메서드를 호출하는 건 매개변수 복사, 복귀할 주소 저장 등의 과정이 추가로 필요해서 시간이 더 걸린다. <code class="language-plaintext highlighter-rouge">비효율적이지만 간결함</code> 때문에 사용</p>

<ul>
  <li>퀴즈
근데 만약에 factorial(0)이 호출되면 어떻게 될까? 또는 100,000과 같은 큰 수이면 어떻게 될까?
<em>0인 경우 1이 아니니까 else문으로 빠지니까 계속 재귀호출만 일어날 것. 그래서 메서드가 종료되지 않으므로 스택에 계속 데이터가 쌓인다. → <code class="language-plaintext highlighter-rouge">스택 오버플로우 에러</code>가 발생한다. 유효성 검사 필요</em></li>
  <li>아래의 결과가 나오도록 하려면 하는 코드 한줄을 짜보자!
<a href="https://ideone.com/Mtlq0x">https://ideone.com/Mtlq0x</a>
    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">a</span> <span class="o">=</span>    <span class="mi">1</span>
<span class="n">a</span> <span class="o">=</span>   <span class="mi">10</span>
<span class="n">a</span> <span class="o">=</span>  <span class="mi">100</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">1000</span>
</code></pre></div>    </div>
    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
	<span class="c1">//</span>
<span class="o">}</span>
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="클래스-메서드static와-인스턴스-메서드">클래스 메서드(static)와 인스턴스 메서드</h2>

<p>메서드 앞에 static이 붙어있는 건? 클래스 메서드</p>

<p>붙어있지 않은 건? 인스턴스 메서드</p>

<ul>
  <li>클래스 메서드(static)
‘클래스이름.메서드이름’을 통해 호출이 가능하다. 인스턴스변수나 인스턴스메서드와 관련없는 작업을 하며 메서드 내에서 <code class="language-plaintext highlighter-rouge">인스턴스변수를 사용할 수 없</code>다. 아래 예시를 보면 <code class="language-plaintext highlighter-rouge">인스턴스 메서드를 호출할 수 없</code>다는 것이 보인다.</li>
  <li>
    <p>인스턴스 메서드
인스턴스 생성 후, ‘참조변수.메서드이름()’으로 호출한다. 인스턴스변수나 인스턴스메서드와 관련된 작업을 하며, <code class="language-plaintext highlighter-rouge">메서드 내에서 인스턴스 변수를 사용할 수 있</code>다. 아래 예시를 보면 <code class="language-plaintext highlighter-rouge">static, 인스턴스 메서드 모두 호출 가능</code>하다.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>![Untitled](/assets/images/javastudy1/Untitled%2021.png)

![Untitled](/assets/images/javastudy1/Untitled%2022.png)
</code></pre></div>    </div>
  </li>
  <li>멤버 변수 중 모든 인스턴스에 공통으로 사용되는 것에는 static을 붙인다.</li>
  <li>클래스 변수(static 변수)는 인스턴스를 생성하지 않아도 사용할 수 O</li>
  <li>이유? 클래스변수는 클래스가 메모리에 올라갈 때 이미 자동적으로 생성되기 때문</li>
  <li>
    <p>클래스 메서드(static 메서드)는 인스턴스 변수 사용 불가능</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">iv</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>
<span class="kd">static</span> <span class="kt">int</span> <span class="n">cv2</span> <span class="o">=</span> <span class="n">iv</span><span class="o">;</span> <span class="c1">//에러! 인스턴스 변수 사용 불가능!</span>

<span class="kd">static</span> <span class="kt">void</span> <span class="nf">staticMethod1</span><span class="o">(){</span>
	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">iv</span><span class="o">);</span> <span class="c1">//에러! 인스턴스변수 사용 불가능</span>
	<span class="nc">Member</span> <span class="n">m</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Member</span><span class="o">();</span>
	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">iv</span><span class="o">);</span> <span class="c1">//가능. 객체 생성 후 호출했기 때문에</span>
<span class="o">}</span>
</code></pre></div>    </div>

    <ul>
      <li>이유? 인스턴스 변수는 인스턴스가 있어야 사용할 수 있는데 클래스 메서드는 인스턴스 생성 없이 사용할 수 있으므로!</li>
    </ul>
  </li>
  <li>메서드 내에서 인스턴스 변수를 사용하지 않는다면 static 붙이는 걸 고려한다.</li>
  <li>이유? 메서드 호출시간이 짧아진다. 호출되어야 할 메서드를 찾는 과정 때문에 시간이 더 걸릴 수 있다. static을 붙이면 그 시간을 줄일 수 있다.</li>
</ul>

<h2 id="오버로딩">오버로딩</h2>

<p>하나의 클래스에 같은 이름의 메서드를 여러 개 정의하는 것.
overload - vt. 과적하다. 부담을 많이 지우다.</p>

<p>조건</p>

<ul>
  <li>메서드 이름이 같아야 한다.</li>
  <li>매개변수의 개수 또는 타입이 달라야 한다.</li>
  <li><code class="language-plaintext highlighter-rouge">반환타입은 오버로딩을 구현하는데에 아무런 영향을 주지 않</code>는다. 이런 경우 00 is already defined 메시지가 나타나며 오버로딩으로 간주되지 않는다.</li>
</ul>

<p>퀴즈</p>

<ul>
  <li>add(int a, long b), add(long a, int b)는 오버로딩으로 간주될까? <em>O</em></li>
</ul>

<h3 id="오버로딩의-장점">오버로딩의 장점</h3>

<p><img src="/assets/images/javastudy1/Untitled%2023.png" alt="Untitled" /></p>

<p>오버로딩의 예시로는 println메서드가 있다. 그런데 오버로딩 대신 println, printlnBoolean, printlnChar, printDouble, … 이런 식으로 사용한다고 가정해보자. 그럼 메서드를 사용하는 입장에서는 저걸 다 기억해야돼서 부담이 된다. 이 때문에 오버로딩의 경우 기억하기 쉽고 이름도 짧게 할 수 있어서 오류의 가능성을 줄일 수 있다. 그리고, 메서드의 이름을 절약할 수 있다.</p>

<p>퀴즈
”결과: ” + 6L을 println하면 어떻게 될까?</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">3</span><span class="o">);</span> <span class="c1">//6L</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"결과: "</span> <span class="o">+</span> <span class="n">result</span><span class="o">);</span> <span class="c1">//결과: 6</span>
</code></pre></div></div>

<h3 id="가변인자와-오버로딩">가변인자와 오버로딩</h3>

<p>JDK1.5부터 매개변수 인자를 동적으로 지정해줄 수 있게 되었다. 가변인자는 매개변수 중, 제일 마짖막에 선언해야 한다. 안 그러면 컴파일 에러가 발생하는데, 가변인자인지 아닌지를 구분할 방법이 없기 때문에 허용하지 않는다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//가변인자</span>
<span class="kd">public</span> <span class="nc">PrintStream</span> <span class="nf">printf</span><span class="o">(</span><span class="nc">String</span> <span class="n">format</span><span class="o">,</span> <span class="nc">Object</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{...}</span>
<span class="c1">//에러</span>
<span class="kd">public</span> <span class="nc">PrintStream</span> <span class="nf">printf</span><span class="o">(</span><span class="nc">Object</span><span class="o">...</span> <span class="n">args</span><span class="o">,</span> <span class="nc">String</span> <span class="n">format</span><span class="o">)</span> <span class="o">{...}</span> <span class="c1">//ERROR!</span>
</code></pre></div></div>

<p>문자열을 하나로 결합할 때에는 아래처럼 사용할 수 있다. 가변인자는 내부적으로 배열을 이용한다. 가변인자가 선언된 메서드를 호출할 때마다 배열이 새로 생성되기 때문에 꼭 필요한 경우에만 가변인자를 사용하자.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//문자열을 하나로 결합</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">cancatenate</span><span class="o">(</span><span class="s">"a"</span><span class="o">));</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">cancatenate</span><span class="o">(</span><span class="s">"a"</span><span class="o">,</span> <span class="s">"b"</span><span class="o">));</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">cancatenate</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">[]{</span><span class="s">"A"</span><span class="o">,</span> <span class="s">"B"</span><span class="o">}));</span>

<span class="c1">//구분자 사용</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">cancatenate</span><span class="o">(</span><span class="s">"-"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">String</span><span class="o">[]{</span><span class="s">"100"</span><span class="o">,</span> <span class="s">"200"</span><span class="o">,</span> <span class="s">"300"</span><span class="o">}));</span>
<span class="c1">// **여기서 new String[]은 생략 불가능하다 ** "-", "100", "200" 도 컴파일 에러가 발생한다.</span>
<span class="c1">// 오버로딩된 메서드가 구분되지 않아서이다.</span>

<span class="n">그런데</span> <span class="nc">String</span><span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="s">", "</span><span class="o">,</span> <span class="n">arr</span><span class="o">);</span> <span class="n">을</span> <span class="n">사용하는</span> <span class="n">게</span> <span class="n">나을</span> <span class="n">수도</span> <span class="n">있을</span> <span class="n">것</span> <span class="n">같다</span><span class="o">.</span>
</code></pre></div></div>

<h1 id="생성자">생성자</h1>

<p>인스턴스가 생성될 때마다 호출되는 ‘<strong>인스턴스 초기화 메서드</strong>’이다. 인스턴스 변수의 초기화 또는 인스턴스 생성시 수행할 작업에 사용한다.</p>

<ol>
  <li>생성자의 이름은 클래스 이름과 같아야 한다.</li>
  <li>생성자는 리턴값이 없다.</li>
</ol>

<p><img src="/assets/images/javastudy1/Untitled%2024.png" alt="Untitled" /></p>

<p>사실 <code class="language-plaintext highlighter-rouge">모든 클래스</code>에는 <code class="language-plaintext highlighter-rouge">반드시</code> <code class="language-plaintext highlighter-rouge">하나 이상의 생성자</code>가 정의되어 있어야 한다. 클래스에 생성자를 정의하지 않고도 인스턴스를 생성하고 있었던 이유는 ‘<code class="language-plaintext highlighter-rouge">기본 생성자</code>’ 덕분! 컴파일 시에 클래스에 생성자가 하나도 없으면 컴파일 시에 자동으로 기본생성자를 추가하여 컴파일 한다.</p>

<p><img src="/assets/images/javastudy1/Untitled%2025.png" alt="Untitled" /></p>

<p>Data1은 생성자가 없어서 에러가 발생하지 않지만, Data2는 매개변수가 있는 생성자가 있어서 기본 생성자가 없다는 걸 알 수 있다. 그래서 에러가 발생한다 → 컴파일러가 자동적으로 기본 생성자를 추가해주는 경우는, <code class="language-plaintext highlighter-rouge">클래스에 생성자가 하나도 없을 때</code>라는 것</p>

<p><img src="/assets/images/javastudy1/Untitled%2026.png" alt="Untitled" /></p>

<p>생성자를 사용할 때는 위에 사진의 오른쪽처럼 사용하는 것이 더 간결하고 직관적이다.</p>

<h2 id="생성자에서-다른-생성자-호출---this-this">생성자에서 다른 생성자 호출 - this(), this</h2>

<ul>
  <li>this(): 다른 생성자 호출. 같은 클래스의 다른 생성자를 호출할 때 사용한다.
생성자의 이름으로 클래스이름 대신 this를 사용한다. Card(a,b,c)로 하면 에러가 나타난다. <code class="language-plaintext highlighter-rouge">또한</code>, 한 생성자에서 다른 생성자를 호출할 때는 <code class="language-plaintext highlighter-rouge">반드시 첫줄에서만 호출</code>이 <code class="language-plaintext highlighter-rouge">가능</code>하다. 그래서 주석처리한 걸로 하면 에러가 나타난다.
<img src="/assets/images/javastudy1/Untitled%2027.png" alt="Untitled" /></li>
  <li>this: 참조변수 this
인스턴스 자신을 가리키는 참조변수이다. 인스턴스의 주소가 저장되어있다. this를 사용할 수 있는 것은 인스턴스 변수이다. 사실 생성자를 포함한 모든 인스턴스 메서드에는 자신이 관련된 인스턴스를 가리키는 참조변수 ‘this’가 지역변수로 숨겨진 채로 존재한다. (static메서드는 인스턴스와 관련 없는 작업을 하므로 정보가 필요 X)
<img src="/assets/images/javastudy1/Untitled%2028.png" alt="Untitled" /></li>
</ul>

<h3 id="생성자를-이용한-인스턴스의-복사">생성자를 이용한 인스턴스의 복사</h3>

<p>똑같은 속성값을 갖는 독립적인 인스턴스가 하나 더 만들어진다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Car</span><span class="o">(){</span> <span class="k">this</span><span class="o">(</span><span class="s">"white"</span><span class="o">,</span> <span class="s">"auto"</span><span class="o">,</span> <span class="mi">4</span><span class="o">);</span> <span class="o">}</span>

<span class="nc">Car</span> <span class="n">c1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Car</span><span class="o">();</span>
<span class="nc">Car</span> <span class="n">c2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Car</span><span class="o">(</span><span class="n">c1</span><span class="o">);</span>
<span class="n">c1</span><span class="o">.</span><span class="na">color</span> <span class="o">=</span> <span class="s">"red"</span><span class="o">;</span>
<span class="c1">//c2의 color는? "white"</span>
</code></pre></div></div>

<h1 id="변수의-초기화">변수의 초기화</h1>

<p>변수를 선언하고 처음으로 값을 저장하는 것이다. 지역변수는 사용하기 전에 반드시 초기화해야 한다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">x</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">;</span> <span class="c1">//인스턴스 변수 x는 초기화 안해도 자동적으로 기본값 0으로 초기화된다.</span>

<span class="kt">void</span> <span class="nf">method</span><span class="o">(){</span>
	<span class="kt">int</span> <span class="n">i</span><span class="o">;</span>
	<span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">i</span><span class="o">;</span> <span class="c1">//ERROR 지역변수 초기화도 안 하고 사용하니까 에러</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>멤버변수(클래스변수와 인스턴스변수)와 배열의 초기화는 선택적이지만 지역변수의 초기화는 필수적이다.</li>
</ul>

<p><img src="/assets/images/javastudy1/Untitled%2029.png" alt="Untitled" /></p>

<h3 id="멤버-변수의-초기화-방법">멤버 변수의 초기화 방법</h3>

<ol>
  <li>
    <dl>
      <dt>명시적 초기화</dt>
      <dd>변수를 선언과 동시에 초기화하는 것이다. 복잡한 초기화 작업 필요할 때 사용 가능하다.
<code class="language-plaintext highlighter-rouge">java class Car{ int door = 4; //기본형 변수 초기화 Engine e = new Engine(); //참조형 변수 초기화 ... } </code></dd>
    </dl>
  </li>
  <li>
    <p>생성자</p>

    <p><img src="/assets/images/javastudy1/Untitled%2030.png" alt="Untitled" /></p>
  </li>
  <li>
    <p>초기화 블럭</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">InitBlock</span><span class="o">{</span>
	<span class="kd">static</span> <span class="o">{</span> <span class="cm">/* 클래스 초기화 블럭 */</span> <span class="o">}</span>
	<span class="o">{</span> <span class="cm">/* 인스턴스 초기화 블럭 */</span> <span class="o">}</span>
	<span class="o">...</span>
<span class="o">}</span>
</code></pre></div>    </div>

    <p>초기화 블럭 내에는 메서드처럼 조건문, 반복문, 예외처리구문 등을 자유롭게 사용할 수 있다. 명시적 초기화만으로는 부족한 경우 초기화 블럭을 사용한다.</p>

    <ul>
      <li>클래스 초기화 블럭: 클래스 변수의 복잡한 초기화에 사용된다. 클래스가 <code class="language-plaintext highlighter-rouge">메모리에 처음 로딩될 때</code> 한번만 <code class="language-plaintext highlighter-rouge">수행, 초기화</code>된다.</li>
      <li>인스턴스 초기화 블럭: 인스턴스 변수의 복잡한 초기화에 사용된다. <code class="language-plaintext highlighter-rouge">인스턴스를 생성할 때</code>마다 <code class="language-plaintext highlighter-rouge">수행, 초기화</code>된다. <code class="language-plaintext highlighter-rouge">생성자보다 인스턴스 초기화 블럭이 먼저 수행</code>된다.
<img src="/assets/images/javastudy1/Untitled%2031.png" alt="Untitled" />
→ 인스턴스 변수의 초기화: 주로 생성자 사용
→ 인스턴스 초기화 블럭: 모든 생성자에서 공통적으로 수행돼야 하는 코드를 넣는데 사용
멤버변수의 초기화 시점
        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">클래스변수의</span> <span class="nl">초기화순서:</span>  <span class="n">기본값</span> <span class="o">-&gt;</span> <span class="n">명시적초기화</span> <span class="o">-&gt;</span> <span class="n">클래스</span> <span class="n">초기화</span> <span class="n">블럭</span>
<span class="n">인스턴스변수의</span> <span class="nl">초기화순서:</span> <span class="n">기본값</span> <span class="o">-&gt;</span> <span class="n">명시적초기화</span> <span class="o">-&gt;</span> <span class="n">인스턴스</span> <span class="n">초기화</span> <span class="n">블럭</span> <span class="o">-&gt;</span> <span class="n">생성자</span>
</code></pre></div>        </div>
      </li>
    </ul>

    <p>퀴즈</p>

    <ul>
      <li>
        <h2 id="생성자랑-인스턴스-초기화-블럭-중에-뭐가-먼저-수행될까-인스턴스-초기화-블럭">생성자랑 인스턴스 초기화 블럭 중에 뭐가 먼저 수행될까? <em>인스턴스 초기화 블럭</em></h2>
      </li>
    </ul>
  </li>
</ol>

<p>array와 arrayList의 차이점은?</p>

<p>ArrayList와 LinkedList의 차이가 무엇인가요?</p>

<p>Array와 LinkedList의 차이가 무엇인가요?</p>

<p>출처: <a href="https://velog.io/@humblechoi/%EC%9E%90%EB%A3%8C%EA%B5%AC%EC%A1%B0-Array-vs-ArrayList">https://velog.io/@humblechoi/자료구조-Array-vs-ArrayList</a></p>]]></content><author><name>🐸 SW developer</name></author><category term="Java" /><category term="Java" /><summary type="html"><![CDATA[[Java]자바의 정석 Chapter5-6]]></summary></entry><entry><title type="html">테스트코드의 Mock, MockBean, Autowired, Spy 이해하기</title><link href="http://localhost:4000/spring/testcode1/" rel="alternate" type="text/html" title="테스트코드의 Mock, MockBean, Autowired, Spy 이해하기" /><published>2021-12-26T00:00:00+09:00</published><updated>2021-12-26T00:00:00+09:00</updated><id>http://localhost:4000/spring/testcode1</id><content type="html" xml:base="http://localhost:4000/spring/testcode1/"><![CDATA[<h1 id="test-code">Test code</h1>

<p>+mock과 stub의 차이? 행위 검증을 추구한다는 것. mock은 행위검증을 추구하고, stub은 그렇지 않다</p>

<p><strong>1. MockBean, Mock, Autowired</strong></p>

<p><img src="https://user-images.githubusercontent.com/46602874/147401347-8235180e-abac-4ce2-a408-3bbfe4c83144.png" alt="image" /></p>

<p>target(mock)으로 보면 되겠다!
예를 들어서 controller 생성자에 service가 필요하다고 가정하면,
controller(service)이므로 controller에 @InjectMocks, service에 @Mock을 해준다</p>

<p>아래를 보면 알겠지만,</p>

<p>MockBean/SpyBean은 Autowired로 기억됨을 알 수 있다</p>

<p><code class="language-plaintext highlighter-rouge">@MockBean</code>: mock객체를 스프링 컨텍스트에 등록</p>

<p><code class="language-plaintext highlighter-rouge">@Autowired</code>: @MockBean으로 등록한 mock 객체를 주입 받아서 의존성 해결</p>

<p>@MockBean의 의존성 주입 Target을 @InjectMocks로 하려고 하면 실패한다</p>

<p><strong>2. SpyBean</strong></p>

<p><code class="language-plaintext highlighter-rouge">@SpyBean</code>: spy 객체를 스프링 context에 등록</p>

<p><code class="language-plaintext highlighter-rouge">@Autowired</code>: @SpyBean으로 등록한 spy 객체를 주입 받아서 의존성 해결</p>

<p>=&gt; SpyBean</p>

<p>이 인터페이스일 경우에는 해당 인터페이스를 구현하는 <code class="language-plaintext highlighter-rouge">실제 구현체가 스프링 컨텍스트가 등록되어 있어야</code> 함</p>

<p><strong>3. Spy</strong></p>

<p>실제 기능을 그대로 사용하고 싶을 때, @Spy로 spy객체 주입</p>

<p>ex) 예를 들어 orderService의 createOrder는</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">orderRepository.findOrderList()</code>를 하고 그 결과의 size가 0보다 크면 exception을 throw해준다.</li>
  <li>예외가 없다면 order.Repository의 <code class="language-plaintext highlighter-rouge">createOrder</code>를 해준다.</li>
  <li>isNotify가 있다면 notificationClient의 <code class="language-plaintext highlighter-rouge">notifyToMobible</code>을 해준다.</li>
</ul>

<p>이에 대해 테스트하는 코드를 보자</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@ExtendWith</span><span class="o">(</span><span class="nc">MockitoExtension</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderServiceTest</span><span class="o">{</span>
	<span class="nd">@Spy</span>
	<span class="kd">private</span> <span class="nc">OrderRepository</span> <span class="n">orderRepository</span><span class="o">;</span>
	<span class="nd">@Spy</span>
	<span class="kd">private</span> <span class="nc">NotificationnClient</span> <span class="n">notificationClient</span><span class="o">;</span>
	<span class="nd">@InjectMocks</span>
	<span class="kd">private</span> <span class="nc">OrderService</span> <span class="n">orderService</span><span class="o">;</span>

	<span class="nd">@Test</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">createOrderTest</span><span class="o">(){</span>
		<span class="c1">//given</span>
		<span class="nc">Mockto</span><span class="o">.</span><span class="na">doAnswer</span><span class="o">(</span><span class="n">invocation</span> <span class="o">-&gt;</span> <span class="o">{</span>
			<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"createOrderrr"</span><span class="o">);</span>
			<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
		<span class="o">}).</span><span class="na">when</span><span class="o">(</span><span class="n">orderRepository</span><span class="o">).</span><span class="na">createOrder</span><span class="o">();</span>
		<span class="nc">Mockto</span><span class="o">.</span><span class="na">doAnswer</span><span class="o">(</span><span class="n">invocation</span> <span class="o">-&gt;</span> <span class="o">{</span>
			<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"notifyToMobilee"</span><span class="o">);</span>
			<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
		<span class="o">}).</span><span class="na">when</span><span class="o">(</span><span class="n">notificationClient</span><span class="o">).</span><span class="na">notifyToMobile</span><span class="o">();</span>

		<span class="c1">//when</span>
		<span class="n">orderService</span><span class="o">.</span><span class="na">createOrder</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
		<span class="c1">//then</span>
		<span class="nc">Mockito</span><span class="o">.</span><span class="na">verify</span><span class="o">(</span><span class="n">orderRepository</span><span class="o">,</span> <span class="n">times</span><span class="o">(</span><span class="mi">1</span><span class="o">)).</span><span class="na">createOrder</span><span class="o">();</span>
		<span class="nc">Mockito</span><span class="o">.</span><span class="na">verify</span><span class="o">(</span><span class="n">notificationCliennt</span><span class="o">,</span> <span class="n">times</span><span class="o">(</span><span class="mi">1</span><span class="o">)).</span><span class="na">notifyToMobile</span><span class="o">();</span>
	<span class="o">}</span>
</code></pre></div></div>

<p>보면 테스트 코드에 createOrder, notifyToMobile이 호출되면 할 부분은 명시되어 있는데,</p>

<p>findOrderList()는 보이지 않는다. 이러면 에러가 나타나야 하지만,</p>

<p>Spy로 되어 있기 때문에 기존기능을 사용함을 알 수 있다.</p>

<p>Spy는 이처럼 실제 기능을 사용하고 싶을 때 사용한다.</p>

<p>출처
<a href="https://cobbybb.tistory.com/16">https://cobbybb.tistory.com/16</a></p>]]></content><author><name>🐸 SW developer</name></author><category term="Spring" /><category term="테스트코드" /><summary type="html"><![CDATA[Test code]]></summary></entry><entry><title type="html">스프링 mvc 1편 정리</title><link href="http://localhost:4000/spring/springmvc1/" rel="alternate" type="text/html" title="스프링 mvc 1편 정리" /><published>2021-12-23T00:00:00+09:00</published><updated>2021-12-23T00:00:00+09:00</updated><id>http://localhost:4000/spring/springmvc1</id><content type="html" xml:base="http://localhost:4000/spring/springmvc1/"><![CDATA[<p>스프링 mvc 1편을 듣고 정리한 내용입니다.</p>

<h1 id="1-servlet이해하기">1 Servlet이해하기</h1>

<p>서블릿을 자동 등록하는 경우,
<code class="language-plaintext highlighter-rouge">@ServletComponentScan</code>어노테이션을 사용한다.</p>

<p>예제를 보면서 이해해보자</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@WebServlet</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"helloServlet"</span><span class="o">,</span> <span class="n">urlPatterns</span> <span class="o">=</span> <span class="s">"/hello"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloServlet</span> <span class="kd">extends</span> <span class="nc">HttpServlet</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">service</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"request = "</span> <span class="o">+</span> <span class="n">request</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"response = "</span> <span class="o">+</span> <span class="n">response</span><span class="o">);</span>

        <span class="nc">String</span> <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"username"</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"username = "</span> <span class="o">+</span> <span class="n">username</span><span class="o">);</span>

        <span class="n">response</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">"text/plain"</span><span class="o">);</span>
        <span class="n">response</span><span class="o">.</span><span class="na">setCharacterEncoding</span><span class="o">(</span><span class="s">"utf-8"</span><span class="o">);</span>
        <span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">write</span><span class="o">(</span><span class="s">"hello "</span> <span class="o">+</span> <span class="n">username</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>서블릿을 보면 이렇게 request, response로 구성되어 있으며,<br />
파라미터를 추출해낼 수 있고,<br />
response의 contentType, CharacterEncoding을 설정 가능하며<br />
write로 원하는 내용을 뿌려줄 수 있다</p>

<p>urlPatterns로 원하는 uri를 설정 가능한 걸 볼 수 있다</p>

<p>또, 아래처럼 이렇게 원하는 정보를 뽑아낼 수 있다</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"request.getMethod() = "</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="na">getMethod</span><span class="o">());</span> <span class="c1">//GET</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"request.getProtocal() = "</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="na">getProtocol</span><span class="o">());</span> <span class="c1">//HTTP/1.1</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"request.getScheme() = "</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="na">getScheme</span><span class="o">());</span> <span class="c1">//http</span>
<span class="c1">// http://localhost:8080/request-header</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"request.getRequestURL() = "</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURL</span><span class="o">());</span>
<span class="c1">// /request-test</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"request.getRequestURI() = "</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURI</span><span class="o">());</span>
<span class="c1">//username=hi</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"request.getQueryString() = "</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="na">getQueryString</span><span class="o">());</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"request.isSecure() = "</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="na">isSecure</span><span class="o">());</span> <span class="c1">//https사용 유무</span>
</code></pre></div></div>

<p>header정보를 <strong>아래처럼 iterator로 뽑아내</strong>는 등 다양한 정보를 확인할 수 있다!!</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">request</span><span class="o">.</span><span class="na">getHeaderNames</span><span class="o">().</span><span class="na">asIterator</span><span class="o">().</span><span class="na">forEachRemaining</span><span class="o">(</span><span class="n">headerName</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"headerName = "</span> <span class="o">+</span> <span class="n">headerName</span><span class="o">));</span>
</code></pre></div></div>

<h2 id="요청-body의-json-뽑아서-객체로-만들기">요청 body의 json 뽑아서 객체로 만들기!</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@WebServlet</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"requestBodyJsonServelt"</span><span class="o">,</span> <span class="n">urlPatterns</span> <span class="o">=</span> <span class="s">"/request-body-json"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RequestBodyJsonServlet</span> <span class="kd">extends</span> <span class="nc">HttpServlet</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">ObjectMapper</span> <span class="n">objectMapper</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectMapper</span><span class="o">();</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">service</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">resp</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">ServletInputStream</span> <span class="n">inputStream</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
        <span class="nc">String</span> <span class="n">messageBody</span> <span class="o">=</span> <span class="nc">StreamUtils</span><span class="o">.</span><span class="na">copyToString</span><span class="o">(</span><span class="n">inputStream</span><span class="o">,</span> <span class="nc">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"messageBody = "</span> <span class="o">+</span> <span class="n">messageBody</span><span class="o">);</span>

        <span class="nc">HelloData</span> <span class="n">helloData</span> <span class="o">=</span> <span class="n">objectMapper</span><span class="o">.</span><span class="na">readValue</span><span class="o">(</span><span class="n">messageBody</span><span class="o">,</span> <span class="nc">HelloData</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"helloData.username = "</span> <span class="o">+</span> <span class="n">helloData</span><span class="o">.</span><span class="na">getUsername</span><span class="o">());</span>
        <span class="n">resp</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">write</span><span class="o">(</span><span class="s">"ok"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>이렇게 ServletInputStream을 뽑아낸 후,<br />
copyToString으로 body를 뽑아낸다.<br />
ObjectMapper를 사용해서 json 내용을 객체로 변환해서 볼 수 있다</p>

<blockquote>
  <p>강의 중, 동시성 문제 고려 필요할 때에는 ConcurrentHashMap, AtomicLong 사용 고려 필요</p>
</blockquote>

<p>+result에 2개의 정보가 포함되어있는지 테스트할 때</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">assertThat</span><span class="o">(</span><span class="n">result</span><span class="o">).</span><span class="na">contains</span><span class="o">(</span><span class="n">member1</span><span class="o">,</span> <span class="n">member2</span><span class="o">);</span>
</code></pre></div></div>

<h1 id="jsp">JSP?</h1>

<p>jsp를 보면서 이해해보자</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;%</span><span class="err">@</span> <span class="n">page</span> <span class="kn">import</span><span class="err">="</span><span class="nn">java.util.List</span><span class="s">" %&gt;
&lt;%@ page import="</span><span class="n">hello</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">domain</span><span class="o">.</span><span class="na">member</span><span class="o">.</span><span class="na">MemberRepository</span><span class="s">" %&gt;
&lt;%@ page import="</span><span class="n">hello</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">domain</span><span class="o">.</span><span class="na">member</span><span class="o">.</span><span class="na">Member</span><span class="s">" %&gt;
&lt;%@ page contentType="</span><span class="n">text</span><span class="o">/</span><span class="n">html</span><span class="o">;</span><span class="n">charset</span><span class="o">=</span><span class="no">UTF</span><span class="o">-</span><span class="mi">8</span><span class="s">" language="</span><span class="n">java</span><span class="s">" %&gt;
&lt;%
    MemberRepository memberRepository = MemberRepository.getInstance();
    List&lt;Member&gt; members = memberRepository.findAll();
%&gt;
&lt;table&gt;
    &lt;thead&gt;
    &lt;th&gt;id&lt;/th&gt;
    &lt;th&gt;username&lt;/th&gt;
    &lt;th&gt;age&lt;/th&gt;
    &lt;/thead&gt;
    &lt;tbody&gt;
    &lt;%
        for (Member member : members) {
            out.write("</span>    <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span><span class="s">");
            out.write("</span>      <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="s">" + member.getId() + "</span><span class="o">&lt;/</span><span class="n">td</span> <span class="o">&gt;</span><span class="s">");
            out.write("</span>      <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="s">" + member.getUsername() + "</span><span class="o">&lt;/</span><span class="n">td</span> <span class="o">&gt;</span><span class="s">");
            out.write("</span>      <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="s">" + member.getAge() + "</span><span class="o">&lt;/</span><span class="n">td</span> <span class="o">&gt;</span><span class="s">");
            out.write("</span>    <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span><span class="err">"</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">%&gt;</span>
    <span class="o">&lt;/</span><span class="n">tbody</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">table</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>이렇게 위에 자바에서 사용되는 코드가 있고,<br />
아래에 html 관련 코드가 있다 <br />
+html, head 이런 태그는 생략!</p>

<p>딱 보기만 해도 jsp를 사용하는 것에 대해 고민할 것이란 걸 알 수 있다!</p>

<h1 id="mvc">MVC</h1>

<blockquote>
  <p>강의 들으면서 하나 더 알게 된 건, “/WEB-INF/~”에 있는 부분은, 컨트롤러에서 뷰로 이동할 때 사용한다는 것이었다</p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//서블릿 관련 코드</span>
<span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"member"</span><span class="o">,</span> <span class="n">member</span><span class="o">);</span>

<span class="nc">String</span> <span class="n">viewPath</span> <span class="o">=</span> <span class="s">"/WEB-INF/views/members.jsp"</span><span class="o">;</span>
<span class="nc">RequestDispatcher</span> <span class="n">dispatcher</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestDispatcher</span><span class="o">(</span><span class="n">viewPath</span><span class="o">);</span>
<span class="n">dispatcher</span><span class="o">.</span><span class="na">forward</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
</code></pre></div></div>

<p>requestDispatcher에 viewPath를 넣고<br />
<code class="language-plaintext highlighter-rouge">dispatcher.forward()</code>로 화면을 뿌려준단 걸 알 수 있다<br />
-&gt; 여기서 중복이 계속 발생할 수 있다(viewPath, forward 부분!)
또, setAttribute로 model에 데이터를 보관할 수 있다</p>

<p>jsp의 경우 아래처럼 forEach로 members에 대해<br />
forEach로 item을 뽑아오는 걸 알 수 있다</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;table&gt;</span>
    <span class="nt">&lt;thead&gt;</span>
    <span class="nt">&lt;th&gt;</span>id<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;</span>username<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;</span>age<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;/thead&gt;</span>
    <span class="nt">&lt;tbody&gt;</span>
    <span class="nt">&lt;c:forEach</span> <span class="na">var=</span><span class="s">"item"</span> <span class="na">items=</span><span class="s">"${members}"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;tr&gt;</span>
            <span class="nt">&lt;td&gt;</span>${item.id}<span class="nt">&lt;/td&gt;</span>
            <span class="nt">&lt;td&gt;</span>${item.username}<span class="nt">&lt;/td&gt;</span>
            <span class="nt">&lt;td&gt;</span>${item.age}<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;/c:forEach&gt;</span>
    <span class="nt">&lt;/tbody&gt;</span>
<span class="nt">&lt;/table&gt;</span>
</code></pre></div></div>

<h1 id="중복-개선을-위한-servletv1">중복 개선을 위한 ServletV1</h1>

<p>ServletV1에서 uri에 맞게 Controller를 매핑해준다.<br />
HttpServlet을 구현한 것이다보니까 service로 process를 해준다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@WebServlet</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"ServletV1"</span><span class="o">,</span> <span class="n">urlPatterns</span> <span class="o">=</span> <span class="s">"/controller/v1/*"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServletV1</span> <span class="kd">extends</span> <span class="nc">HttpServlet</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">ControllerV1</span><span class="o">&gt;</span> <span class="n">controllerV1Map</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>

    <span class="kd">public</span> <span class="nf">ServletV1</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">controllerV1Map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/controller/v1/members/new-form"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MemberFormControllerV1</span><span class="o">());</span>
        <span class="n">controllerV1Map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/controller/v1/members/save"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MemberSaveControllerV1</span><span class="o">());</span>
        <span class="n">controllerV1Map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/controller/v1/members"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MemberListControllerV1</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">service</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">requestURI</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURI</span><span class="o">();</span>
        <span class="nc">ControllerV1</span> <span class="n">controller</span> <span class="o">=</span> <span class="n">controllerV1Map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">requestURI</span><span class="o">);</span>
        <span class="n">controller</span><span class="o">.</span><span class="na">process</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span> <span class="c1">//아까 계속 중복되었던 부분(requestDispatcher, forward)</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>위의 process는 controller마다 구현해주는 부분으로,<br />
아까 중복되었던 부분을 포함한다</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberSaveControllerV1</span> <span class="kd">implements</span> <span class="nc">ControllerV1</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">MemberRepository</span> <span class="n">memberRepository</span> <span class="o">=</span> <span class="nc">MemberRepository</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">process</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="c1">//로직 (생략)</span>
        <span class="nc">String</span> <span class="n">viewPath</span> <span class="o">=</span> <span class="s">"/WEB-INF/views/save-result.jsp"</span><span class="o">;</span>
        <span class="nc">RequestDispatcher</span> <span class="n">dispatcher</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestDispatcher</span><span class="o">(</span><span class="n">viewPath</span><span class="o">);</span>
        <span class="n">dispatcher</span><span class="o">.</span><span class="na">forward</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>그래도 컨트롤러마다 다 위처럼 중복된 부분을 가져야함을 알 수 있다</p>

<h1 id="중복-개선을-위한-servletv2">중복 개선을 위한 ServletV2</h1>

<p>그래서 뷰라는 클래스를 만들고,<br />
중복되는 부분을 render에 담는다</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyView</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">viewPath</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">MyView</span><span class="o">(</span><span class="nc">String</span> <span class="n">viewPath</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">viewPath</span> <span class="o">=</span> <span class="n">viewPath</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">render</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">RequestDispatcher</span> <span class="n">dispatcher</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestDispatcher</span><span class="o">(</span><span class="n">viewPath</span><span class="o">);</span>
        <span class="n">dispatcher</span><span class="o">.</span><span class="na">forward</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>서블릿을 보면 아까와 달라보이지 않지만,<br />
process 밑에 렌더가 추가됨을 알 수 있다</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@WebServlet</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"ServletV2"</span><span class="o">,</span> <span class="n">urlPatterns</span> <span class="o">=</span> <span class="s">"/controller/v2/*"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServletV2</span> <span class="kd">extends</span> <span class="nc">HttpServlet</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">ControllerV2</span><span class="o">&gt;</span> <span class="n">controllerV2Map</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>

    <span class="kd">public</span> <span class="nf">ServletV2</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">controllerV2Map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/controller/v2/members/new-form"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MemberFormControllerV2</span><span class="o">());</span>
        <span class="n">controllerV2Map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/controller/v2/members/save"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MemberSaveControllerV2</span><span class="o">());</span>
        <span class="n">controllerV2Map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/controller/v2/members"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MemberListControllerV2</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">service</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">requestURI</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURI</span><span class="o">();</span>

        <span class="nc">ControllerV2</span> <span class="n">controller</span> <span class="o">=</span> <span class="n">controllerV2Map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">requestURI</span><span class="o">);</span>
        <span class="nc">MyView</span> <span class="n">view</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="na">process</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
        <span class="n">view</span><span class="o">.</span><span class="na">render</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>그럼 컨트롤러는 이렇게 해당 경로를 리턴해줌을 알 수 있다</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberFormControllerV2</span> <span class="kd">implements</span> <span class="nc">ControllerV2</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">MyView</span> <span class="nf">process</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">MyView</span><span class="o">(</span><span class="s">"/WEB-INF/views/new-form.jsp"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>괜찮은 것 같은데,<br />
서블릿 종속성이 여전히 존재한다는 단점이 있다</p>

<h1 id="서블릿-종속성-개선을-위한-servletv3">서블릿 종속성 개선을 위한 ServletV3</h1>

<p>아까 MyView와 달리,<br />
viewName에다가 model이 있다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Getter</span> <span class="nd">@Setter</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ModelView</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">viewName</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">model</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>

    <span class="kd">public</span> <span class="nf">ModelView</span><span class="o">(</span><span class="nc">String</span> <span class="n">viewName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">viewName</span> <span class="o">=</span> <span class="n">viewName</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>그럼 MyView에도 model 관련 작업을 해준다</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">render</span><span class="o">(</span><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">model</span><span class="o">,</span> <span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="n">modelToRequestAttribute</span><span class="o">(</span><span class="n">model</span><span class="o">,</span> <span class="n">request</span><span class="o">);</span>
        <span class="nc">RequestDispatcher</span> <span class="n">dispatcher</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestDispatcher</span><span class="o">(</span><span class="n">viewPath</span><span class="o">);</span>
        <span class="n">dispatcher</span><span class="o">.</span><span class="na">forward</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">modelToRequestAttribute</span><span class="o">(</span><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">model</span><span class="o">,</span> <span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//        model.forEach(request::setAttribute);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">forEach</span><span class="o">((</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">));</span>
    <span class="o">}</span>
</code></pre></div></div>

<p>그럼 ServletV3은 어떻게 바뀔까?</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@WebServlet</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"ServletV3"</span><span class="o">,</span> <span class="n">urlPatterns</span> <span class="o">=</span> <span class="s">"/controller/v3/*"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FrontControllerServletV3</span> <span class="kd">extends</span> <span class="nc">HttpServlet</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">ControllerV3</span><span class="o">&gt;</span> <span class="n">controllerV3Map</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>

    <span class="kd">public</span> <span class="nf">FrontControllerServletV3</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">controllerV3Map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/controller/v3/members/new-form"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MemberFormControllerV3</span><span class="o">());</span>
        <span class="n">controllerV3Map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/controller/v3/members/save"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MemberSaveControllerV3</span><span class="o">());</span>
        <span class="n">controllerV3Map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/controller/v3/members"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MemberListControllerV3</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">service</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">requestURI</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURI</span><span class="o">();</span>
        <span class="nc">ControllerV3</span> <span class="n">controller</span> <span class="o">=</span> <span class="n">controllerV3Map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">requestURI</span><span class="o">);</span>

        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">paramMap</span> <span class="o">=</span> <span class="n">createParamMap</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
        <span class="nc">ModelView</span> <span class="n">mv</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="na">process</span><span class="o">(</span><span class="n">paramMap</span><span class="o">);</span>
        <span class="nc">String</span> <span class="n">viewName</span> <span class="o">=</span> <span class="n">mv</span><span class="o">.</span><span class="na">getViewName</span><span class="o">();</span> <span class="c1">//논리 이름</span>
        <span class="nc">MyView</span> <span class="n">view</span> <span class="o">=</span> <span class="n">viewResolver</span><span class="o">(</span><span class="n">viewName</span><span class="o">);</span>

        <span class="n">view</span><span class="o">.</span><span class="na">render</span><span class="o">(</span><span class="n">mv</span><span class="o">.</span><span class="na">getModel</span><span class="o">(),</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">MyView</span> <span class="nf">viewResolver</span><span class="o">(</span><span class="nc">String</span> <span class="n">viewName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">MyView</span><span class="o">(</span><span class="s">"/WEB-INF/views/"</span> <span class="o">+</span> <span class="n">viewName</span> <span class="o">+</span> <span class="s">".jsp"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="nf">createParamMap</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">paramMap</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="n">request</span><span class="o">.</span><span class="na">getParameterNames</span><span class="o">().</span><span class="na">asIterator</span><span class="o">().</span><span class="na">forEachRemaining</span><span class="o">(</span><span class="n">paramName</span> <span class="o">-&gt;</span> <span class="n">paramMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">paramName</span><span class="o">,</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="n">paramName</span><span class="o">)));</span>
        <span class="k">return</span> <span class="n">paramMap</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>아래 부분이 상당히 길어졌다<br />
내용을 보면, paramMap을 가져오고<br />
process한 부분에서 viewName을 가져와서 그 논리 이름에 대한
view를 리턴해줌을 알 수 있다</p>

<p>Controller는 무슨 일을 할까?</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberSaveControllerV3</span> <span class="kd">implements</span> <span class="nc">ControllerV3</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">MemberRepository</span> <span class="n">memberRepository</span> <span class="o">=</span> <span class="nc">MemberRepository</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">ModelView</span> <span class="nf">process</span><span class="o">(</span><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">paramMap</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">username</span> <span class="o">=</span> <span class="n">paramMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"username"</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">age</span> <span class="o">=</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">paramMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"age"</span><span class="o">));</span>

        <span class="nc">Member</span> <span class="n">member</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Member</span><span class="o">(</span><span class="n">username</span><span class="o">,</span> <span class="n">age</span><span class="o">);</span>
        <span class="n">memberRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>

        <span class="nc">ModelView</span> <span class="n">modelView</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ModelView</span><span class="o">(</span><span class="s">"save-result"</span><span class="o">);</span>
        <span class="n">modelView</span><span class="o">.</span><span class="na">getModel</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"member"</span><span class="o">,</span> <span class="n">member</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">modelView</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>paramMap에서 원하는 정보를 get하고 로직 처리한 후에,<br />
modelView에 정보를 넣어주고 리턴함을 알 수 있다</p>

<p>이걸 어떻게 개선할 수 있을까?</p>

<h1 id="servletv4">ServletV4</h1>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@WebServlet</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"ServletV4"</span><span class="o">,</span> <span class="n">urlPatterns</span> <span class="o">=</span> <span class="s">"/controller/v4/*"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FrontControllerServletV4</span> <span class="kd">extends</span> <span class="nc">HttpServlet</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">ControllerV4</span><span class="o">&gt;</span> <span class="n">controllerV4Map</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>

    <span class="kd">public</span> <span class="nf">FrontControllerServletV4</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">controllerV4Map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/controller/v4/members/new-form"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MemberFormControllerV4</span><span class="o">());</span>
        <span class="n">controllerV4Map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/controller/v4/members/save"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MemberSaveControllerV4</span><span class="o">());</span>
        <span class="n">controllerV4Map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"/controller/v4/members"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MemberListControllerV4</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">service</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">requestURI</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURI</span><span class="o">();</span>
        <span class="nc">ControllerV4</span> <span class="n">controller</span> <span class="o">=</span> <span class="n">controllerV4Map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">requestURI</span><span class="o">);</span>

        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">paramMap</span> <span class="o">=</span> <span class="n">createParamMap</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">model</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="nc">String</span> <span class="n">viewName</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="na">process</span><span class="o">(</span><span class="n">paramMap</span><span class="o">,</span> <span class="n">model</span><span class="o">);</span>

        <span class="nc">MyView</span> <span class="n">view</span> <span class="o">=</span> <span class="n">viewResolver</span><span class="o">(</span><span class="n">viewName</span><span class="o">);</span>
        <span class="n">view</span><span class="o">.</span><span class="na">render</span><span class="o">(</span><span class="n">model</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">MyView</span> <span class="nf">viewResolver</span><span class="o">(</span><span class="nc">String</span> <span class="n">viewName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">MyView</span><span class="o">(</span><span class="s">"/WEB-INF/views/"</span> <span class="o">+</span> <span class="n">viewName</span> <span class="o">+</span> <span class="s">".jsp"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="nf">createParamMap</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">paramMap</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="n">request</span><span class="o">.</span><span class="na">getParameterNames</span><span class="o">().</span><span class="na">asIterator</span><span class="o">().</span><span class="na">forEachRemaining</span><span class="o">(</span><span class="n">paramName</span> <span class="o">-&gt;</span> <span class="n">paramMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">paramName</span><span class="o">,</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="n">paramName</span><span class="o">)));</span>
        <span class="k">return</span> <span class="n">paramMap</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>]]></content><author><name>🐸 SW developer</name></author><category term="Spring" /><category term="spring" /><summary type="html"><![CDATA[스프링 mvc 1편을 듣고 정리한 내용입니다.]]></summary></entry><entry><title type="html">[토비의 스프링] 정리</title><link href="http://localhost:4000/spring/TIL-ts1/" rel="alternate" type="text/html" title="[토비의 스프링] 정리" /><published>2021-11-01T00:00:00+09:00</published><updated>2021-11-01T00:00:00+09:00</updated><id>http://localhost:4000/spring/TIL-ts1</id><content type="html" xml:base="http://localhost:4000/spring/TIL-ts1/"><![CDATA[<h2 id="토비의-스프링-2차-정리">토비의 스프링 2차 정리</h2>

<h3 id="관심사의-분리">관심사의 분리?</h3>

<p>관심이 같은 것끼리는 하나의 객체 안으로 또는 친한 객체로 모이게 하고 <br />
관심이 다른 것은 가능한 한 따로 덜어져서 서로 영향을 주지 않도록 분리하는 것</p>

<h3 id="템플릿-메소드-패턴">템플릿 메소드 패턴</h3>

<p>슈퍼클래스에 기본적인 로직의 흐름을 만들고  <br />
기능의 일부를 추상 메소드나 오버라이딩이 가능한 protected 메소드 등으로 만든 뒤 <br />
서브 클래스에서 이런 메소드를 필요로 맞게 구현해서 사용</p>

<ul>
  <li>훅메소드? 슈퍼클래스에서 디폴트 기능을 정의해두거나 비워뒀다가 선택적으로 오버라이드할 수 있도록 만들어둔 메소드</li>
</ul>

<h3 id="팩토리-메소드-패턴">팩토리 메소드 패턴</h3>

<p>서브클래스에서 구체적인 오브젝트 생성 방법을 결정하게 하는 것 <br />
이 메소드는 주로 인터페이스 타입으로 오브젝트를 리턴  <br />
즉, 슈퍼클래스의 기본 코드에서 독립시키는 방법</p>

<h3 id="디자인패턴">디자인패턴</h3>

<p>소프트웨어 설계 시 특정 상황에서 자주 만나는 문제를 해결하기 위해 사용할 수 있는 재사용 가능한 솔루션 <br />
의도에 초점을 맞추자!</p>

<h3 id="개방폐쇄원칙">개방폐쇄원칙</h3>

<p>클래스나 모듈은 확장에는 열려 있어야 하고 변경에는 닫혀 있어야 한다.</p>

<h3 id="전략패턴">전략패턴</h3>

<p>디자인 패턴의 꽃. OCP에도 가장 잘 맞고. <br />
변경이 필요한 알고리즘을 인터페이스를 통해 외부로 분리시키고 <br />
구체적인 알고리즘 클래스를 필요에 따라 바꿔서 사용할 수 있게 하는 디자인 패턴. <br />
이를 대체 가능한 전략으로 보기 때문에 패턴 이름이 전략 패턴!</p>

<h2 id="제어의-역전">제어의 역전</h2>

<h3 id="팩토리">팩토리</h3>

<p>분리시킬 기능을 담당할 클래스! <br />
이 클래스의 역할은 객체 생성방법을 결정하고 그렇게 만들어진 오브젝트를 돌려주는 것인데, <br />
이런 일을 하는 오브젝트를 흔히 팩토리 <br />
→ Component 역할을 하는 오브젝트와 어플리케이션의 구조를 결정하는 오브젝트를 분리했다는 데 의미가 있다.</p>

<h3 id="ioc-제어관계-역전">IoC 제어관계 역전</h3>

<p>모든 종류의 작업을 사용하는 쪽에서 제어하는 구조</p>

<h3 id="라이브러리와-프레임워크-차이">라이브러리와 프레임워크 차이</h3>

<p>라이브러리: 어플리케이션 코드는 애플리케이션 흐름을 직접 제어. 동작 중 필요하면 능동적으로 사용 <br />
프레임워크: 어플리케이션 코드가 프레임워크에 의해 사용</p>

<h3 id="빈-애플리케이션-컨텍스트-빈팩토리-등-단어-설명">빈, 애플리케이션 컨텍스트, 빈팩토리 등 단어 설명</h3>

<table>
  <thead>
    <tr>
      <th style="text-align: left">단어</th>
      <th style="text-align: left">설명</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">빈</td>
      <td style="text-align: left">스프링이 IoC 방식으로 관리하는 오브젝트. 스프링이 직접 생성과 제어를 담당하는 오브젝트만을 빈이라고 함</td>
    </tr>
    <tr>
      <td style="text-align: left">빈 팩토리</td>
      <td style="text-align: left">스프링의 IoC를 담당하는 핵심 컨테이너. 빈을 등록하고 생성하고 조회하고 도려주고 등 관리하는 기능 담당. getBean()과 같은 메서드 정의</td>
    </tr>
    <tr>
      <td style="text-align: left">애플리케이션 컨텍스트</td>
      <td style="text-align: left">빈팩토리를 확장한 IoC 컨테이너 빈팩토리의 기본적인 기능 + 스프링이 제공하는 각종 부가 서비스 제공 → BeanFactory 상속</td>
    </tr>
    <tr>
      <td style="text-align: left">설정정보/ 메타정보</td>
      <td style="text-align: left">applicationContext / 빈팩토리가 IoC를 적용하기 위해 사용하는 메타 정보 영어로 Configuration, 구성 정보 내지는 형상 정보라는 의미</td>
    </tr>
    <tr>
      <td style="text-align: left">컨테이너/ IoC 컨테이너</td>
      <td style="text-align: left">IoC 방식으로 빈을 관리한다는 의미에서 applicationContext나 Bean Factory를 컨테이너/IoC 컨테이너라고 함</td>
    </tr>
    <tr>
      <td style="text-align: left">스프링 프레임워크</td>
      <td style="text-align: left">IoC 컨테이너, 애플리케이션 컨텍스트를 포함해서  스프링이 제공하는 모든 기능을 통틀어 말할 때 주로 사용</td>
    </tr>
  </tbody>
</table>

<p>@Configuration: <br />
빈팩토리를 위한 오브젝트 설정을 담당하는 클래스로 인식할 수 있게 함. <br />
ApplicationContext가 활용하는 IoC 설정정보</p>

<p>@Bean:  <br />
오브젝트 만들어주도록, 오브젝트를 생성하고 초기화해서 돌려주는 거니까.<br />
ApplicationContext는 Bean이 붙은 메소드의 이름을 가져와 빈 목록을 만들어둔다.</p>

<h2 id="싱글톤-레지스트리와-오브젝트-스코프">싱글톤 레지스트리와 오브젝트 스코프</h2>

<h3 id="동일성과-동등성">동일성과 동등성</h3>

<p>동일성 비교: 두개의 오브젝트가 완전히 동일한 오브젝트 (==)<br />
동등성 비교: 동일한 정보를 담고 있는 오브젝트 (equals)</p>

<h3 id="애플리케이션-컨텍스트--싱글톤-레지스트리">애플리케이션 컨텍스트 == 싱글톤 레지스트리</h3>

<p>애플리케이션 컨텍스트는 IoC 컨테이너.<br />
동시에 싱글톤을 저장하고 관리하는 싱글톤 레지스트리</p>

<h3 id="싱글톤-패턴--구현-방법">싱글톤 패턴 &amp; 구현 방법</h3>

<p>싱글톤 패턴 = 한 개의 오브젝트만 만들어서 사용</p>

<ul>
  <li>생성자를 private!</li>
  <li>생성된 싱글톤 오브젝트를 저장할 수 있는 자신과 같은 타입의 static 필드 정의</li>
  <li>스태틱 팩토리 메서드인 <strong>getInstance()</strong>를 만들고 이 메소드가 최초로 호출되는 시점에서 한번만 오브젝트가 만들어지게 한다.
생성된 오브젝트는 스태틱 필드에 저장된다. 또는 스태틱 필드의 초기값으로 오브젝트를 미리 만들어둘 수도 있다.</li>
</ul>

<h3 id="싱글톤--안티패턴-이유">싱글톤 == 안티패턴 이유?</h3>

<ul>
  <li>private 생성자를 가지고 있어서 상속할 수 없다.
객체지향의 장점인 <strong>상속</strong>과 이를 이용한 <strong>다형성</strong>을 적용할 수 없다.</li>
  <li>싱글톤은 테스트하기가 어렵다.
만들어지는 방식이 제한적이어서 mock 오브젝트 등으로 대체하기 어렵다.
싱글톤은 초기화 과정에서 생성자 등을 통해 사용할 오브젝트를 다이내믹하게 주입하기도 힘들어서 직접 오브젝트를 만들어 사용할 수밖에 없다.
테스트용 오브젝트로 대체하기 힘들다.</li>
  <li><strong>서버환경에서는 싱글톤이 하나만 만들어지는 것을 보장하지 못한다.</strong>
클래스 로더를 어떻게 구성하고 있느냐에 따라서 하나 이상의 오브젝트가 만들어질 수 있다.</li>
  <li>싱글톤의 사용은 전역 상태를 만들 수 있기 때문에 바람직하지 못하다.
<strong>static 메서드를 이용</strong>해서 언제든지 싱글톤에 쉽게 접근할 수 있기 때문에 <strong>자연스럽게 전역상태로 사용되기 쉽다</strong>.
아무 객체나 자유롭게 접근하고 수정하고 공유할 수 있는 전역 상태를 갖는 것은 객체 지향 프로그래밍에서는 권장되지 않는 프로그래밍 모델</li>
</ul>

<h3 id="싱글톤-레지스트리">싱글톤 레지스트리</h3>

<p>기본적인 싱글톤 패턴의 구현방식은 여러 개의 단점이 있어서, <br />
<strong>직접 싱글톤 형태의 오브젝트를 만들고 관리하는 기능</strong>을 제공하는 것</p>

<p><strong>싱글톤 레지스트리의 장점</strong>은 스태틱 메서드와 private 생성자를 사용해야 하는 클래스가 아니라<br />
평범한 자바 클래스를 싱글톤으로 활용하게 해준다는 점이다.</p>

<p><strong>싱글톤 레지스트리 덕분에</strong>, 싱글톤 방식으로 사용될 애플리케이션 클래스라도 <strong>public 생성자</strong>를 만들 수 있다.<br />
싱글톤으로 사용돼야 하는 환경이 아니라면, 간단히 오브젝트를 생성할 수 있다.<br />
→ 테스트 환경에서 오브젝트를 만들 수도 있고, 목 오브젝트로 대체도 가능.</p>

<p><strong>스프링은</strong> IoC컨테이너일 뿐만 아니라, 고전적인 싱글톤 패턴을 대신해서,<br />
싱글톤을 만들고 관리해주는 <strong>싱글톤 레지스트리라는</strong> 점을 기억!</p>

<h3 id="빈의-스코프">빈의 스코프</h3>

<p>빈의 기본 스코프 = 싱글톤</p>

<p>경우에 따라서는 프로토타입 스코프,<br />
→ 컨테이너에 빈을 요청할 때마다 매번 새로운 오브젝트를 만들어준다.</p>

<p>요청 스코프 = HTTP 요청이 생길 때마다 생성</p>

<p>세션 스코프 = 웹의 세션과 스코프가 유사한 스코프</p>

<h2 id="의존관계-검색과-주입">의존관계 검색과 주입</h2>

<p>검색 방식은 아래와 같다</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>this.connectionMaker = context.getBean("connectionMaker", ConnectionMaker.class); // 의존관계 검색 방식
</code></pre></div></div>

<p>의존관계 검색 방식은 기존 의존관계 주입의 거의 모든 장점을 갖고 있다!<br />
오브젝트 팩토리 클래스나 스프링 API를 이용하는 코드가 섞여 있는 건 어색해서 의존관계 주입 방식을 사용하는 게 낫다.</p>

<p>그런데, 의존관계 검색 방식을 사용해야 할 때가 있다.<br />
서블릿에서 스프링 컨테이너에 담긴 오브젝트를 사용하려면 의존관계 검색 방식을 사용해서 오브젝트를 가져와야 함.<br />
다행히 이런 서블릿은 스프링이 만들어서 제공하기 때문에 직접 구현할 필요 X</p>

<h2 id="xml을-이용한-설정">XML을 이용한 설정</h2>

<p>DaoFactory = DI 작업에 참고하는 일종의 참고 정보<br />
DI 구성이 바뀔 때마다 자바 코드를 수정하고 컴파일 하는 것도 귀찮은 작업</p>

<p>그 중에서 XML로 DI 의존관계 설정 정보를 만들 수 O<br />
컴파일과 같이 별도의 빌드 작업이 없다는 것도 장점<br />
오브젝트의 관계가 바뀌어도 바르게 변경사항 반영 가능.</p>

<h2 id="테스트">테스트</h2>

<h3 id="픽스처">픽스처</h3>

<p>테스트 수행하는 데 필요한 정보나 오브젝트
일반적으로 픽스처는 여러 테스트에서 반복적으로 사용되기 때문에 @Before 메소드 이용해 생성</p>

<p>테스트는 가능한 한 독립적으로 매번 새로운 오브젝트를 만들어서 사용하는 것이 원칙
하지만 생성에 많은 시간/자원이 소모되어서 테스트가 공유하는 오브젝트를 만들기도 함.</p>

<p>빈은 싱글톤으로 만들어서 상태를 갖지 않는다.
그래서 애플리케이션 컨텍스트는 한번만 만들고 공유해서 사용해도 된다.</p>

<h3 id="어노테이션">어노테이션</h3>

<ul>
  <li>@RunWith(SpringJUnit4ClassRunner.class) 
   -&gt; 스프링 테스트 컨텍스트 프레임워크의 JUnit 확장기능 지정</li>
  <li>@ContextConfiguration(locations=”/applicationContext.xml”) 
   -&gt; 테스트 컨텍스트가 자동으로 만들어줄 애플리케이션 컨텍스트 위치 지정</li>
  <li>@Autowired
   -&gt; <code class="language-plaintext highlighter-rouge">@Autowired</code>가 붙은 인스턴스 변수가 있으면,
      테스트 컨텍스트 프레임워크는 변수 타입과 일치하는 컨텍스트 내의 빈을 찾는다.
      빈을 자동으로 가져올 수 있는 방법을 타입에 의한 자동와이어링</li>
</ul>

<h3 id="junit-스프링-테스트-컨텍스트">JUnit, 스프링 테스트 컨텍스트</h3>

<p>JUnit은 테스트 메소드를 수행할 때마다 새로운 오브젝트를 만든다고 한다 → 이걸 테스트<br />
JUnit과 반대로, 스프링 테스트용 애플리케이션 컨텍스트는 테스트 개수에 상관 없이 한개만 생성.</p>

<h2 id="템플릿">템플릿</h2>

<h3 id="예시1">예시1</h3>

<p>이렇게 deleteAll이 있는데 어떻게 개선해야할까?</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteAll</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">SQLException</span><span class="o">{</span>
	<span class="nc">Connection</span> <span class="n">c</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
	<span class="nc">PreparedStatement</span> <span class="n">ps</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
	<span class="nc">ResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

	<span class="k">try</span><span class="o">{</span>
		<span class="n">c</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">.</span><span class="na">getConnection</span><span class="o">();</span>
		<span class="n">ps</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="s">"select count(*) from users"</span><span class="o">);</span>


		<span class="n">rs</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">();</span>
		<span class="n">rs</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
		<span class="k">return</span> <span class="n">rs</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
	<span class="o">}</span>
	<span class="k">catch</span><span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span> <span class="k">throw</span> <span class="n">e</span><span class="o">;</span> <span class="o">}</span>
	<span class="k">finally</span><span class="o">{</span>
		<span class="k">if</span><span class="o">(</span><span class="n">rs</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
			<span class="k">try</span><span class="o">{</span>
				<span class="n">rs</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
			<span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{}</span>
			<span class="o">...</span>
	<span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<p>전략패턴을 사용하면 아래와 같다.</p>

<ol>
  <li>jdbcContextWithStatementStrategy(StatementStrategy stmt) throws SQLException에 ps 쿼리문 빼고 다 넣는다.
 ps의 경우 ps = stmt.makePreparedStatmement(c)로 담는다.</li>
  <li>핵심 로직 deleteAll()에는 StatementStrategy st, 오브젝트를 만들어서 jdbcContext~ 파라미터로 넣어준다.</li>
  <li>AddStatement도 ps 쿼리를 세팅해주고, 파라미터를 세팅해준다. add()에서는 2번처럼 똑같이 해준다.
-&gt; 이렇게 DAO 메소드마다 새로운 StatementStrategy 구현 클래스를 만들어줄 수는 없다.</li>
</ol>

<h3 id="로컬-클래스">로컬 클래스</h3>

<p>로컬 클래스를 사용하면 아래와 같다.</p>

<ul>
  <li>
    <p>add()에 class AddStatement를 넣어준다. AddStatement에서 쿼리를 실행하고
  class가 끝나면 StatementStrategy st에 new AddStatement(user);을 한 후 jdbcContextWithStatementStrategy(st)를 해준다.</p>
  </li>
  <li>
    <p>addStatement에서 user를 추가해주기 위해 인스턴수 변수 user를 선언해주었는데, 이건 그냥 <strong>로컬 변수</strong>를 사용하면 된다.
  그래서 public void add(final User user) { class AddStatement {…}}로 사용되는데,
  이렇게 <strong>final</strong>을 사용하면 된다.</p>

    <p>그럼 StatementStrategy st = new AddStatement()에서 user를 전달하지 않아도 된다.</p>
  </li>
</ul>

<h3 id="익명-내부-클래스">익명 내부 클래스</h3>

<p>AddStatment 클래스는 add() 메소드에서만 사용할 용도로 만들어졌으니, 클래스 이름도 제거 가능</p>

<ul>
  <li>AddStatement를 익명 내부 클래스로 전환한다.
  StatementStrategy st= new StratementStrategy(){ public Prepared… }로 쿼리 내용을 여기에 넣어서 사용한다.</li>
  <li>그럼 add(final User user){ jdbcContextWithStatementStrategy(new StatementStrategy(){ 쿼리 내용 })} 이렇게 사용할 수 있다.</li>
  <li>deleteAll도 마찬가지로 바꾸면, public void deleteAll(){ jdbcContextWithStatementStrategy{ new StatementStrategy() {쿼리 내용} } }이 된다.</li>
</ul>

<h3 id="jdbccontext의-분리">JdbcContext의 분리</h3>

<p>jdbcContextWithStatementStrategy는 컨텍스트!</p>

<h3 id="클래스-분리">클래스 분리</h3>

<p>비즈니스 로직이 들어있는 클래스 이름은 <strong>JdbcContext</strong>로 설정.<br />
안에 DataSource 인스턴스가 있고 set으로 DI 받을 수 있게 한다.<br />
workWithStatementStrategy 함수에 지금까지 봤던 쿼리 실행 try, catch, finally 로직이 들어가있다.</p>

<p>UserDao 클래스는 아래처럼 사용한다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserDao</span><span class="o">{</span>
	<span class="o">...</span>
	<span class="kd">private</span> <span class="nc">JdbcContext</span> <span class="n">jdbcContext</span><span class="o">;</span>


	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setJdbcContext</span><span class="o">(</span><span class="nc">JdbcContext</span> <span class="n">jdbcContext</span><span class="o">){</span>
		<span class="k">this</span><span class="o">.</span><span class="na">jdbcContext</span> <span class="o">=</span> <span class="n">jdbcContext</span><span class="o">;</span>
	<span class="o">}</span>


	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="kd">final</span> <span class="nc">User</span> <span class="n">user</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">SQLException</span><span class="o">{</span>
		<span class="k">new</span> <span class="nf">StatementStrategy</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
		<span class="o">);</span>
	<span class="o">}</span>


	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteAll</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">SQLException</span><span class="o">{</span>
		<span class="k">new</span> <span class="nf">StatementStrategy</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
		<span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="di">DI</h3>

<p>의존관계 주입은 인터페이스를 사이에 둬서<br />
<strong>클래스 레벨에서는 의존관계가 고정되지 않게 하고</strong><br />
런타임 시에 <strong>의존할 오브젝트와의 관계를 다이내믹하게 주입해주는 것</strong>이 맞다.</p>

<p>UserDao와 JdbcContext는 클래스로 의존관계가 설정되어 있어서<br />
매우 긴밀한 관계로 강하게 결합되어 있다.<br />
JdbcContext를 스프링 빈으로 등록해서 DI 하는 대신 사용할 수 있는 방법을 알아보자</p>

<h3 id="di-의존관계-주입의-3가지-조건">DI 의존관계 주입의 3가지 조건</h3>

<p>DI! 구체적인 의존 오브젝트와 그것을 사용할 주체, 보통 클라이언트라고 부르는 오브젝트를 런타임 시에 연결해주는 작업</p>

<p>의존관계 주입의 3가지 조건 = ?</p>
<ol>
  <li><strong>인터페이스에만 의존</strong>하기 위해서, 런타임 시점 의존관계가 드러나지 않도록</li>
  <li>런타임 시점의 의존관계는 <strong>제3의 존재가 결정</strong>한다</li>
  <li>의존관계는 <strong>사용할 오브젝트에 대한 레퍼런스를 외부에서 제공(주입)</strong>해줌으로써 만들어진다!</li>
</ol>

<h3 id="코드를-이용하는-수동-di">코드를 이용하는 수동 DI</h3>

<p>UserDao 내부에서 직접 DI를 적용하는 방법
JdbcContext의 제어권을 UserDao가 갖는 것.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserDao</span><span class="o">{</span>
	<span class="o">...</span>
	<span class="kd">private</span> <span class="n">jdbcContext</span> <span class="n">jdbcContext</span><span class="o">;</span> <span class="c1">// 인스턴스 변수에 저장해두고</span>
	
	<span class="c1">// JdbcContext에 대한 생성. DI 작업을 동시에 수행</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setDataSource</span><span class="o">(</span><span class="nc">DataSource</span> <span class="n">dataSource</span><span class="o">){</span>
		<span class="k">this</span><span class="o">.</span><span class="na">jdbcContext</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JdbcContext</span><span class="o">();</span>

		<span class="c1">// 의존 오브젝트 주입(DI)!!</span>
		<span class="k">this</span><span class="o">.</span><span class="na">jdbcContext</span><span class="o">.</span><span class="na">setDataSource</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>

		<span class="c1">// 아직 JdbcContext를 적용하지 않은 메소드를 위해 저장</span>
		<span class="k">this</span><span class="o">.</span><span class="na">dataSource</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>]]></content><author><name>🐸 SW developer</name></author><category term="Spring" /><category term="토비의스프링" /><category term="java" /><category term="spring" /><summary type="html"><![CDATA[토비의 스프링 2차 정리]]></summary></entry><entry><title type="html">[스프링 인 액션5] Chapter4~6 내용 정리</title><link href="http://localhost:4000/spring/TIL-sia2/" rel="alternate" type="text/html" title="[스프링 인 액션5] Chapter4~6 내용 정리" /><published>2021-10-18T00:00:00+09:00</published><updated>2021-10-18T00:00:00+09:00</updated><id>http://localhost:4000/spring/TIL-sia2</id><content type="html" xml:base="http://localhost:4000/spring/TIL-sia2/"><![CDATA[<h2 id="chapter4-스프링-시큐리티">Chapter4 스프링 시큐리티</h2>

<p>사용 예시로 알아보기</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@EnableWebSecurity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfig</span> <span class="kd">extends</span> <span class="nc">WebSecurityConfigurerAdapter</span> <span class="o">{</span>


	<span class="c1">//HTTP 보안 구성</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="nc">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">{</span> 
        <span class="n">http</span>
                <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>										<span class="c1">// ExpressionInterceptUrlRegistry 객체 반환</span>
                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/design"</span><span class="o">,</span> <span class="s">"/orders"</span><span class="o">)</span> 					<span class="c1">// 이 부분은</span>
                <span class="o">.</span><span class="na">access</span><span class="o">(</span><span class="s">"hasRole('ROLE_USER')"</span><span class="o">)</span> 					<span class="c1">// 인가 과정</span>
                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="s">"/**"</span><span class="o">).</span><span class="na">access</span><span class="o">(</span><span class="s">"permitAll"</span><span class="o">)</span> 		<span class="c1">// 이 부분은 누구나 접속 가능</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
                <span class="o">.</span><span class="na">httpBasic</span><span class="o">();</span>
    <span class="o">}</span>

	<span class="c1">//사용자 인증 정보 구성</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="nc">AuthenticationManager</span> <span class="n">auth</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">{</span>
        <span class="n">auth</span><span class="o">.</span><span class="na">inMemoryAuthentication</span><span class="o">()</span>
				<span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>

<p>여러가지 사용자 스토어 구성 방법 4가지</p>

<ul>
  <li>인메모리 사용자 스토어</li>
  <li>JDBC 기반 사용자 스토어</li>
  <li>LDAP 기반 사용자 스토어</li>
  <li>커스텀 사용자 명세 서비스</li>
</ul>

<h3 id="421인메모리-사용자-스토어">4.2.1인메모리 사용자 스토어</h3>

<p>메모리 = 사용자 정보를 유지, 관리할 수 있는 곳 중 하나</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@EnableWebSecurity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfig</span> <span class="kd">extends</span> <span class="nc">WebSecurityConfigurerAdapter</span> <span class="o">{</span>


	<span class="o">...</span>


    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="nc">AuthenticationManager</span> <span class="n">auth</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">{</span>
        <span class="n">auth</span><span class="o">.</span><span class="na">inMemoryAuthentication</span><span class="o">()</span>
                <span class="o">.</span><span class="na">withUser</span><span class="o">(</span><span class="s">"user1"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">password</span><span class="o">(</span><span class="s">"{noop}password1"</span><span class="o">)</span> 		<span class="c1">//{noop} 비밀번호 암호화X</span>
                <span class="o">.</span><span class="na">authorities</span><span class="o">(</span><span class="s">"ROLE_USER"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
                <span class="o">.</span><span class="na">withUser</span><span class="o">(</span><span class="s">"user2"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">password</span><span class="o">(</span><span class="s">"{noop}password2"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">authorities</span><span class="o">(</span><span class="s">"ROLE_USER"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>withUser로 사용자 구성 시작 -&gt; 이름, 비밀번호, 권한을 인자로 전달한다.
ex) withUser(“name).password(“pw”).authorities(“ROLE_USER”)</p>
<ul>
  <li>authorities(“ROLE_USER”) 대신 .roles(“USER”)를 사용해도 O</li>
  <li>password() 메서드 호출하여 암호화 하지 않으면 HTTP 403/500 에러(접근 거부/Internal Server Error)</li>
</ul>

<h3 id="422-jdbc-기반의-사용자-스토어">4.2.2 JDBC 기반의 사용자 스토어</h3>
<p>사용자 정보는 관계형 데이터베이스로 유지, 관리되는 경우가 많아 JDBC 기반 사용자 스토어가 적합</p>

<p>이 부분도 마찬가지로 PasswordEncoder를 사용해서 비밀번호 암호화 필요</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@EnableWebSecurity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfig</span> <span class="kd">extends</span> <span class="nc">WebSecurityConfigurerAdapter</span> <span class="o">{</span>


	<span class="o">...</span>


    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="nc">AuthenticationManager</span> <span class="n">auth</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">{</span>
         <span class="n">auth</span>
            <span class="o">.</span><span class="na">jdbcAuthentication</span><span class="o">()</span>
            <span class="o">.</span><span class="na">dataSource</span><span class="o">(</span><span class="n">dataSource</span><span class="o">)</span>
            <span class="c1">// 스프링 시큐리티와 다른 데이터베이스(테이블이나 열의 이름이 다를 때)를 사용할 경우</span>
            <span class="o">.</span><span class="na">usersByUsernameQuery</span><span class="o">(</span><span class="s">"select username, password, enabled, from users where username=?"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">authoritiesByUsernameQuery</span><span class="o">(</span><span class="s">"select username, authority from authorities where username=?"</span><span class="o">)</span>
			<span class="o">.</span><span class="na">passwordEncoder</span><span class="o">(</span><span class="k">new</span> <span class="nc">BCryptPasswordEncoder</span><span class="o">());</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>스프링 시큐리티의 내부 코드에서는</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DEF_USERS_BY_USERNAME_QUERY = "select username ,password, enabled from users where username = ?"
DEF_AUTHORITIES_BY_USERNAME_QUERY = "select username, authority from authorities where username = ?"
DEF_GROUP_AUTHORITIES_BY_USERNAME_QUERY = "select g.id, g.group_name, ga.authority from authorities g, group_members gm, group_authorities ga where gm.username = ? and g.id = ga.group_id and g.id = gm.group_id";
</code></pre></div></div>

<p>를 사용하고 위에 코드처럼 custom SQL 쿼리로 대체할 수 있다.</p>

<p>→ 조건의 경우, where절에 사용되는 매개변수는 하나이며, username이어야 한다. 사용자 정보 인증 쿼리에서 username, password, enabled 열 값을 반환해야 한다.</p>

<h3 id="423-ldap-기반-사용자-스토어">4.2.3 LDAP 기반 사용자 스토어</h3>

<p>LDAP(Lightweight Directory Access Protocol) 기반 인증은 <code class="language-plaintext highlighter-rouge">ldapAuthentication()</code> 메서드를 사용할 수 있다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@EnableWebSecurity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfig</span> <span class="kd">extends</span> <span class="nc">WebSecurityConfigurerAdapter</span> <span class="o">{</span>


	<span class="o">...</span>


    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="nc">AuthenticationManager</span> <span class="n">auth</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">{</span>
			<span class="n">auth</span><span class="o">.</span><span class="na">ldapAuthentication</span><span class="o">()</span>
				<span class="c1">// .userSearchBase("ou=people") 					&lt;- 이렇게 기준점 쿼리를 지정 가능(구성 단위)</span>
    	   	 	<span class="o">.</span><span class="na">userSearchFilter</span><span class="o">(</span><span class="s">"(uid={0})"</span><span class="o">)</span>
        		<span class="o">.</span><span class="na">groupSearchFilter</span><span class="o">(</span><span class="s">"member={0}"</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>LDAP의 기본 인증 전략은 사용자가 직접 LDAP 서버에서 인증받도록 하는 것.
외에도 비밀번호를 비교하는 방법도 O
입력된 비밀번호를 LDAP 디렉토리에 전송한 후, 비밀번호를 비밀번호 속성 값과 비교하도록 LDAP 서버에 요청한다.(이 비교는 LDAP 서버에서 수행)</p>

<p>→ 비교 시 passwordCompare() 메서드 호출하면 된다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@EnableWebSecurity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfig</span> <span class="kd">extends</span> <span class="nc">WebSecurityConfigurerAdapter</span> <span class="o">{</span>


	<span class="o">...</span>


    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="nc">AuthenticationManager</span> <span class="n">auth</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">{</span>
			<span class="n">auth</span><span class="o">.</span><span class="na">ldapAuthentication</span><span class="o">()</span>
    	   	 	<span class="o">.</span><span class="na">userSearchFilter</span><span class="o">(</span><span class="s">"(uid={0})"</span><span class="o">)</span>
        		<span class="o">.</span><span class="na">groupSearchFilter</span><span class="o">(</span><span class="s">"member={0}"</span><span class="o">);</span>
				<span class="o">.</span><span class="na">passwordCompare</span><span class="o">()</span> 													<span class="c1">// 비교하고</span>
				<span class="o">.</span><span class="na">passwordEncoder</span><span class="o">(</span><span class="k">new</span> <span class="nc">BCryptPasswordEncoder</span><span class="o">())</span> 		<span class="c1">//암호화하고</span>
				<span class="o">.</span><span class="na">passwordAttribute</span><span class="o">(</span><span class="s">"userPassword"</span><span class="o">);</span> 							<span class="c1">// password 대신 userPassword로 지정해놔서 그걸로 진행</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>LDAP 서버?</p>

<p>기본적으로 localhost:33389.
contextSource메서드로 서버 위치 구성 가능 → ContextSourceBuilder 반환</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@EnableWebSecurity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfig</span> <span class="kd">extends</span> <span class="nc">WebSecurityConfigurerAdapter</span> <span class="o">{</span>


	<span class="o">...</span>


    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="nc">AuthenticationManager</span> <span class="n">auth</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">{</span>
		<span class="o">...</span>
        <span class="o">.</span><span class="na">passwordCompare</span><span class="o">()</span>
        <span class="o">.</span><span class="na">passwordEncoder</span><span class="o">(</span><span class="k">new</span> <span class="nc">BCryptPasswordEncoder</span><span class="o">())</span>
        <span class="o">.</span><span class="na">passwordAttribute</span><span class="o">(</span><span class="s">"userPassword"</span><span class="o">);</span>
        <span class="o">.</span><span class="na">contextSource</span><span class="o">()</span>
        <span class="o">.</span><span class="na">root</span><span class="o">(</span><span class="s">"dc=tacocloud,dc=com"</span><span class="o">)</span>			<span class="c1">//url도 가능</span>
        <span class="o">.</span><span class="na">ldif</span><span class="o">(</span><span class="s">"classpath:users.ldif"</span><span class="o">)</span>        			<span class="c1">//LDAP 데이터를 나타내는 표준화된 방법. 자동으로 users.ldif 로드</span>


	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>로그인이 되게 하려면 미리 정해둔 비밀번호를 암호화한 결과값을 알아낸 후</p>

<p>LDIF 파일 사용자의 passCode 값으로 교체하고 application 다시 시작</p>

<h3 id="424-사용자-인증의-커스터마이징">4.2.4 사용자 인증의 커스터마이징</h3>
<p>(이건 코드로 보기)</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="kd">implements</span> <span class="nc">UserDetails</span> <span class="o">{</span>
	<span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>

<p>스프링 시큐리티의 UserDetails를 구현하면</p>

<p>getAuthorities() → 부여된 권한 저장한 컬렉션 반환</p>

<p>외에도 is → AccountNonExpired()/NonLocked()/CredentialsNonExpired()/isEnabled() 존재</p>

<ul>
  <li>내장된 UserDetailsService.</li>
</ul>

<p>→ User에서는 UserDetails를 구현. UserRepository에서는 findByUsername()을 제공하므로 UserDetailsService 구현 클래스에서 사용해야 하는 모든 것이 준비된 상태</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserDetailsService</span><span class="o">{</span>
	<span class="nc">UserDetails</span> <span class="nf">loadUserByUsername</span><span class="o">(</span><span class="nc">String</span> <span class="n">username</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">UsernameNotFoundException</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>그럼 UserDetailsService를 구현하는 클래스!</p>

<h3 id="432-커스텀-로그인-페이지">4.3.2 커스텀 로그인 페이지</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">http</span>
            <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
            <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/design"</span><span class="o">,</span> <span class="s">"/orders"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">access</span><span class="o">(</span><span class="s">"hasRole('ROLE_USER')"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="s">"/**"</span><span class="o">).</span><span class="na">access</span><span class="o">(</span><span class="s">"permitAll"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">and</span><span class="o">()</span>
            <span class="o">.</span><span class="na">formLogin</span><span class="o">()</span>      								<span class="c1">//이 부분 추가</span>
            <span class="o">.</span><span class="na">loginPage</span><span class="o">(</span><span class="s">"/login"</span><span class="o">);</span>
			<span class="o">.</span><span class="na">dafaultSuccessUrl</span><span class="o">(</span><span class="s">"/design"</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>		<span class="c1">// 로그인 후 이동할 페이지</span>
			<span class="o">.</span><span class="na">loginProcessingUrl</span><span class="o">(</span><span class="s">"/authenticate"</span><span class="o">)</span>		<span class="c1">//해당 요청으로 로그인 처리	</span>
			<span class="o">.</span><span class="na">usernameParameter</span><span class="o">(</span><span class="s">"user"</span><span class="o">)</span> 				<span class="c1">//필요할 경우 이렇게 필드 이름도 설정 가능</span>
</code></pre></div></div>

<p>→ WebConfig에도 뷰만 뿌려주면 되기 때문에 /login 페이지 추가</p>

<p>로그아웃하기</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">http</span><span class="o">.</span>
			<span class="o">...</span>
			<span class="o">.</span><span class="na">and</span><span class="o">()</span>
			<span class="o">.</span><span class="na">logout</span><span class="o">()</span>
			<span class="o">.</span><span class="na">logoutSuccessUrl</span><span class="o">(</span><span class="s">"/"</span><span class="o">);</span>	
</code></pre></div></div>

<h3 id="44-사용자-인지하기">4.4 사용자 인지하기</h3>

<p>사용자 인지하는 방법 중 많이 사용되는 방법은 아래와 같다</p>

<p>Principal 객체를 컨트롤러 메서드에 주입
Authentication 객체를 컨트롤러 메서드에 주입
SecurityContextHolder를 사용해서 보안 컨텍스트를 얻기
@AuthenticationPrincipal 애노테이션을 메서드에 저장</p>

<p>@AuthenticationPrincipal로 사용자 인지</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@PostMapping</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">processOrder</span><span class="o">(</span><span class="nd">@Valid</span> <span class="nc">Order</span> <span class="n">order</span><span class="o">,</span> <span class="o">...</span>
        <span class="o">,</span> <span class="nd">@AuthenticationPrincipal</span> <span class="nc">User</span> <span class="n">user</span> 
<span class="o">)</span> <span class="o">{</span>
    <span class="n">order</span><span class="o">.</span><span class="na">setUser</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>

	<span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>
<p>장점: 타입 변환이 필요없고 Authentication과 동일하게 보안 특정 코드만 가진다.</p>

<p>SecurityContextHolder로 할 경우</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Authentication</span> <span class="n">authentication</span> <span class="o">=</span> <span class="nc">SecurityContextHolder</span><span class="o">.</span><span class="na">getContext</span><span class="o">().</span><span class="na">getAuthentication</span><span class="o">();</span>
<span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="o">(</span><span class="nc">User</span><span class="o">)</span> <span class="n">authentication</span><span class="o">.</span><span class="na">getPrincipal</span><span class="o">();</span>
</code></pre></div></div>
<p>SecurityContextHolder는 Context를 get하고 Authentication을 get한 후 Principal을 get해서 User에 담는다.</p>

<h2 id="chapter5-구성-속성-사용하기">Chapter5 구성 속성 사용하기</h2>

<ul>
  <li>빈 연결: 스프링 애플리케이션 컨텍스트에서 빈으로 생성되는 애플리케이션 컴포넌트 및 상호 간에 주입되는 방법을 선언하는 구성</li>
  <li>속성 주입: 스프링 애플리케이션 컨텍스트에서 빈의 속성값을 설정하는구성
ex) @Bean 애노테이션이 지정된 메서드는 사용하는 빈의 인스턴스를 생성하고 속성값도 설정한다.</li>
</ul>

<p>DataSource 메서드로 사용할 경우 <code class="language-plaintext highlighter-rouge">EmbeddedDatabaseType</code>으로 Type(h2)을 정한 후 SQL이 실행되어 DB에 적용해도 된다.</p>

<p>그러나 스프링부트를 사용중일 때는 자동-구성이 DataSource 빈을 구성해주므로 dataSource()메서드가 필요없다.</p>

<p>H2 의존성 라이브러리를 classpath에서 찾아 사용할 수 있다면 빈을 자동으로 찾아 애플리케이션 컨텍스트에 생성하고
schema.sql, data.sql을 실행하여 DB에 적용시킨다.
어쩔 때(이름을 다르게 지정하고 싶거나 3개 이상을 지정해야 할 때)에는 구성 속성을 사용할 수 있다.</p>

<h3 id="51-자동-구성-세부-조정추상화의-개념과-yml">5.1 자동 구성 세부 조정(추상화의 개념과 yml)</h3>

<p>추상화는 구성 가능한 모든 속성을 한 곳에서 관리하는 개념.
추상화함으로써 빈이 스프링 자체에서 해당 속성을 사용할 수 있게 해준다.</p>

<p>아래 속성 근원으로부터 원천 속성을 가져온다.</p>

<ul>
  <li>JVM 시스템 속성</li>
  <li>운영체제의 환경 변수</li>
  <li>명령행 인자</li>
  <li>애플리케이션의 속성 구성 파일</li>
</ul>

<p>또, YML 파일에서 아래처럼 진행해놓으면,
톰캣의 JDBC 커넥션 풀을 classpath에서 자동으로 찾을 수 있다면 DataSource 빈이 그걸 사용한다.
그렇지 않다면 다른 커넥션 풀을 classpath에서 찾아 사용한다</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>spring:
  datasource:
    url: jdbc:mysql://localhost/tacocloud
    username: tacodb
    password: tacopassword


	schema:
		- 내가 원하는 스키마 이름.sql
	data:
		- ingredients.sql
</code></pre></div></div>

<p>원하는 경우 이렇게 schema, data도 사용 가능하다.
이런 명시적인 데이터 소스 구성 대신 JNDI(Java Naming and Directory Interface)에 구성하는 것을 원할 수도 있다.
→ 이걸 하면 다른 데이터 소스 구성 속성은 무시된다.</p>

<p>해당 yml 파일에서 HTTPS를 활성화하기 위해 server: ssl: key-store/key-store-password/key-password 도 사용 가능하다.</p>

<p>로깅하는 방법의 경우, logback.xml 파일을 사용할 수도 있지만,
application.yml에 logging 항목을 지정할 수 있다.
(기본 로그 파일 10MB)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>logging:
	path: /var/logs/
	file: TacoLogs.log
	level:
		root: WARN
		org.springframework.security: DEBUG
</code></pre></div></div>

<p>yml파일에서 다른 속성의 값도 가져올 수 있다.</p>

<p>ex) greeting.welcome: ${spring.application.name}</p>

<h3 id="52-페이징--구성-속성-생성하기">5.2 페이징 &amp; 구성 속성 생성하기</h3>

<p>페이징</p>

<p>Paging이 어떻게 되는지 볼 수 있다.</p>

<p>스프링 데이터의 Pageable 인터페이스를 사용하면 페이지 번호와 크기로 결과의 일부분을 선택할 수 있다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@GetMapping</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">ordersForUser</span><span class="o">(</span><span class="nd">@AuthenticationPrincipal</span> <span class="nc">User</span> <span class="n">user</span><span class="o">,</span> <span class="nc">Model</span> <span class="n">model</span><span class="o">){</span>
    <span class="nc">Pageable</span> <span class="n">pageable</span> <span class="o">=</span> <span class="nc">PageRequest</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">20</span><span class="o">);</span>
    <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"orders"</span><span class="o">,</span> <span class="n">orderRepo</span><span class="o">.</span><span class="na">findByUserOrderByPlacedAtDesc</span><span class="o">(</span><span class="n">user</span><span class="o">,</span> <span class="n">pageable</span><span class="o">));</span>
    <span class="k">return</span> <span class="s">"orderList"</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>근데 이렇게 20으로 하드코딩하면 좋지 않아서
아래처럼 코드가 변경된다. (기본값 = 20)</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@ConfigurationProperties</span><span class="o">(</span><span class="n">prefix</span> <span class="o">=</span> <span class="s">"taco.orders"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderController</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">pageSize</span> <span class="o">=</span> <span class="mi">20</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPageSize</span><span class="o">(</span><span class="kt">int</span> <span class="n">pageSize</span><span class="o">){</span><span class="k">this</span><span class="o">.</span><span class="na">pageSize</span> <span class="o">=</span> <span class="n">pageSize</span><span class="o">;}</span>
	<span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>

<p>변경하고 싶을 때엔 아래처럼 yml에서 변경하면 된다.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>taco:
  orders:
    pageSize:10
</code></pre></div></div>

<p>@ConfigurationProperties</p>

<p>구성 속성의 올바른 주입을 지원하기 위해 @ConfigurationProperties 어노테이션을 지원한다.
이 어노테이션은 구성 데이터의 홀더로 사용되는 빈에 지정되는 경우가 많고, 이렇게 사용하면
컨트롤러와 그 외 클래스 외부에 구성 관련 정보를 따로 유지할 수 있다.
여러 빈에 공통적인 구성 속성을 쉽게 공유할 수 있다.</p>

<p>그 예제를 한번 봐보자!</p>

<p>먼저 속성을 정의한 클래스를 만든다.
추가적으로 Validated 어노테이션을 사용해서 검증도 한번에 가능하다!</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Component</span>
<span class="nd">@ConfigurationProperties</span><span class="o">(</span><span class="n">prefix</span> <span class="o">=</span> <span class="s">"taco.orders"</span><span class="o">)</span>
<span class="nd">@Data</span>
<span class="nd">@Validated</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderProps</span> <span class="o">{</span>
    
    <span class="nd">@Min</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="mi">5</span><span class="o">,</span> <span class="n">message</span><span class="o">=</span><span class="s">"must be between 5 and 25"</span><span class="o">)</span>
    <span class="nd">@Max</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="mi">25</span><span class="o">,</span> <span class="n">message</span><span class="o">=</span><span class="s">"must be between 5 and 25"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">pageSize</span> <span class="o">=</span> <span class="mi">20</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>이 빈을 Controller에 주입한다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/orders"</span><span class="o">)</span>
<span class="nd">@SessionAttributes</span><span class="o">(</span><span class="s">"order"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderController</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">OrderRepository</span> <span class="n">orderRepo</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">OrderProps</span> <span class="n">props</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">OrderController</span><span class="o">(</span><span class="nc">OrderRepository</span> <span class="n">orderRepo</span><span class="o">,</span> <span class="nc">OrderProps</span> <span class="n">props</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">orderRepo</span> <span class="o">=</span> <span class="n">orderRepo</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">props</span> <span class="o">=</span> <span class="n">props</span><span class="o">;</span>
    <span class="o">}</span>
	<span class="o">...</span>
	<span class="nd">@GetMapping</span>
	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">ordersForUser</span><span class="o">(</span><span class="nd">@AuthenticationPrincipal</span> <span class="nc">User</span> <span class="n">user</span><span class="o">,</span> <span class="nc">Model</span> <span class="n">model</span><span class="o">){</span>
    	<span class="nc">Pageable</span> <span class="n">pageable</span> <span class="o">=</span> <span class="nc">PageRequest</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">props</span><span class="o">.</span><span class="na">getPageSize</span><span class="o">());</span>			<span class="c1">// 하드코딩 X</span>
		<span class="o">...</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>그래서 저렇게 Props 부분에 공통 속성들을 다 넣을 수 있다!!</p>

<p>(신기!)</p>

<p>구성 속성 메타데이터 선언</p>

<p>yml 파일의 taco: 부분에서 taco를 인식하지 못하면</p>

<p>해당 속성에 관한 메타데이터를 생성하는 것이 좋다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">boot</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">spring</span><span class="o">-</span><span class="n">boot</span><span class="o">-</span><span class="n">configuration</span><span class="o">-</span><span class="n">processor</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span>
</code></pre></div></div>
<p>해당 의존성을 우선 추가해준다.</p>

<p>spring-boot-configuration-processor는 @ConfigurationProperties 어노테이션이 지정된 애플리케이션 클래스에 관한 메타데이터를 생성하는 어노테이션 처리기이다.</p>

<p>생성된 메타데이터는 yml 파일에서 자동완성 기능을 제공하고 속성의 문서를 보여주기 위해 사용된다.</p>

<p>커스텀 구성 속성에 관한 메타데이터를 생성하려면 json 파일을 생성하도록 한다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// additional-spring-configuration-metadata.json</span>
<span class="o">{</span>
  <span class="s">"properties"</span><span class="o">:</span> <span class="o">[{</span>
    <span class="s">"name"</span><span class="o">:</span> <span class="s">"taco.orders.page-size"</span><span class="o">,</span>
    <span class="s">"type"</span><span class="o">:</span> <span class="s">"int"</span><span class="o">,</span>
    <span class="s">"description"</span><span class="o">:</span> <span class="s">"Sets the maximum number of orders to display in a list"</span>
  <span class="o">}]</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>yml Profile</li>
</ul>

<p>빈에 따른 활성화가 필요할 때는 @Profile을 사용한다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Bean</span>
<span class="nd">@Profile</span><span class="o">({</span><span class="s">"dev"</span><span class="o">,</span> <span class="err">"</span><span class="n">qa</span><span class="o">})</span>
<span class="kd">public</span> <span class="nc">CommandLineRunner</span> <span class="nf">dataLoader</span><span class="o">(){</span> <span class="o">...</span> <span class="o">}</span>
</code></pre></div></div>

<p>Chapter6 REST 서비스</p>

<p>지금까지 한 부분은 스프링 MVC를 활용해서 MPA(Multi Page Application)을 사용했다.</p>

<p>이제는 SPA(Single Page Application)로 프론트엔드를 구축할 것이라고 한다.</p>]]></content><author><name>🐸 SW developer</name></author><category term="Spring" /><category term="스프링인액션" /><category term="java" /><category term="spring" /><summary type="html"><![CDATA[Chapter4 스프링 시큐리티]]></summary></entry><entry><title type="html">[스프링 인 액션5] Chapter1~3 내용 정리</title><link href="http://localhost:4000/spring/TIL-sia1/" rel="alternate" type="text/html" title="[스프링 인 액션5] Chapter1~3 내용 정리" /><published>2021-10-14T00:00:00+09:00</published><updated>2021-10-14T00:00:00+09:00</updated><id>http://localhost:4000/spring/TIL-sia1</id><content type="html" xml:base="http://localhost:4000/spring/TIL-sia1/"><![CDATA[<h1 id="스프링-인-액션5-chapter13-내용-정리">[스프링 인 액션5] Chapter1~3 내용 정리</h1>

<p>스프링 인 액션에 대한 내용을 읽으면서<br />
중요 내용, 한번 더 짚고 넘어가면 좋을 내용에 대해서 써보려고 한다.</p>

<h1 id="chapter1">Chapter1</h1>

<h2 id="springbootapplication">SpringBootApplication</h2>

<p>애플리케이션의 부트스트랩 클래스에,<br />
SpringBootApplication이 있다는 건 다들 봤을 것이다.</p>

<p>이 SpringBootApplication이 어떤 어노테이션이 결합한 것인지 보자</p>

<ul>
  <li>
    <p>SpringBootConfiguration
  현재 클래스를 구성 클래스로 지정한다.(@Configuration)의 특화된 형태</p>
  </li>
  <li>
    <p>EnableAutoConfiguration
   스프링 부트 자동-구성을 활성화한다</p>
  </li>
  <li>
    <p>ComponentScan
  컴포넌트 검색을 활성화한다.
  @Component, @Controller, @Service 등의 애노테이션과 함께 클래스를 선언할 수 있게 한다.</p>
  </li>
  <li>
    <p>여기서 잠깐!
  @Repository, @Controller 같은 어노테이션을 <code class="language-plaintext highlighter-rouge">스테레오타입 애놑테이션</code>이라고 한다.
  스프링에서 주로 사용하는 역할 그룹을 나타낸다.</p>
  </li>
</ul>

<p>그럼 해당 어노테이션이 붙은 클래스에,<br />
main 메서드가 있는데, 이 메서드는<br />
<code class="language-plaintext highlighter-rouge">Jar 파일이 실행될 때 호출되어 실행되는 메서드</code>이다.</p>

<p>main 메서드 안에는 SpringApplication.run(ProjectApplication.class, args)가 있는데,<br />
run 메서드에는 구성 클래스와, 명령행 인자가 들어간다.</p>

<p>애플리케이션을 실행하면 우리가 작성한 코드가 돌아감을 알 수 있다.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2021-10-14 11:08:02.834  INFO 9586 --- [  restartedMain] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path ''
2021-10-14 11:08:02.847  INFO 9586 --- [  restartedMain] com.sia.tacos.TacosApplication           : Started TacosApplication in 22.183 seconds (JVM running for 28.003)
2021-10-14 11:08:38.870  INFO 9586 --- [nio-8080-exec-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2021-10-14 11:08:38.870  INFO 9586 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
</code></pre></div></div>

<p>실행 후 로그를 보면 Tomcat이 실행된다.<br />
tomcat을 설치하지 않았음에도 실행이 가능한 이유는 뭘까?<br />
<code class="language-plaintext highlighter-rouge">SpringBootApplication</code>이 실행에 필요한 모든 것을 포함하고 있기 때문이다.</p>

<h2 id="컨트롤러-테스트">컨트롤러 테스트</h2>

<p>테스트 파일에서 붙은 어노테이션의 경우 <code class="language-plaintext highlighter-rouge">SpringBootTest</code>가 있다.<br />
<code class="language-plaintext highlighter-rouge">@WebMvcTest</code>어노테이션도 있는데,<br />
이건 스프링 부트에서 제공하는 특별한 테스트 어노테이션이다.</p>

<p>스프링 MVC 애플리케이션 형태로 테스트가 실행되도록 하는데,<br />
실제 서버를 시작하는 대신, 스프링 MVC의 모의 메커니즘을 사용해도 충분할 때가 있다.<br />
그럴 때 테스트 클래스에 MockMvc 객체를 주입한다.</p>

<h2 id="devtools">DevTools</h2>

<p>스프링부트에서 DevTools는 그냥 개발자를 위한 도구인 줄 알았다.<br />
근데, DevTools는 유용한 기능이란 걸 알았다.</p>

<ul>
  <li>코드 변경 시 Application 재시작</li>
  <li>리소스 변경 시 브라우저 새로고침</li>
  <li>템플릿 캐시 자동으로 비활성화</li>
  <li>H2 DB 사용 시 H2 콘솔 활성화</li>
</ul>

<h2 id="스프링-살펴보기">스프링 살펴보기</h2>

<ul>
  <li>
    <p>스프링 데이터
  스프링 데이터는 간단한 인터페이스로 애플리케이션의 데이터 리퍼지토리를 정의할 수 있다. 데이터를 저장하고 읽는 메서드를 작명 규칙을 사용해서 정의한다.
  게다가, 서로 다른 종류의 데이터베이스와 함께 사용될 수 있다.(JPA, Mongo, Neo4j 등)</p>
  </li>
  <li>
    <p>스프링 시큐리티
  인증, 허가, API 보안을 포함하는 보안 요구를 다룬다.</p>
  </li>
  <li>
    <p>스프링 통합과 배치
  서로 다른 컴포넌트를 통합할 필요가 생길 때, 이러한 요구사항을 해결하기 위한 패턴이 있다. 스프링 통합과 스프링 배치는 이런 패턴 구현을 제공한다.
  <code class="language-plaintext highlighter-rouge">스프링 통합</code>은 데이터가 사용 가능한 즉시 처리되는 실시간 통합을 한다.
  <code class="language-plaintext highlighter-rouge">스프링 배치</code>에서는 다량의 데이터가 처리되는 시점을 트리거가 알려줄 때 배치 통합을 처리해준다.</p>
  </li>
  <li>
    <p>스프링 클라우드</p>
  </li>
</ul>

<h1 id="chapter2">Chapter2</h1>

<h2 id="유효성-검사-규칙">유효성 검사 규칙</h2>

<p>Order 등 엔티티 같은 클래스에 이렇게 유효성 검사가 가능하다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nd">@NotBlank</span><span class="o">(</span><span class="n">message</span> <span class="o">=</span> <span class="s">"Zip code is required"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">deliveryZip</span><span class="o">;</span>

    <span class="nd">@CreditCardNumber</span><span class="o">(</span><span class="n">message</span> <span class="o">=</span> <span class="s">"Not a valid credit card number"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">ccNumber</span><span class="o">;</span>

    <span class="nd">@Pattern</span><span class="o">(</span><span class="n">regexp</span> <span class="o">=</span> <span class="s">"^(0[1-9]|1[0-2]|)([\\/])([1-9][0-9])$"</span><span class="o">,</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s">"Must be formatted MM/YY"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">ccExpiration</span><span class="o">;</span>

    <span class="nd">@Digits</span><span class="o">(</span><span class="n">integer</span> <span class="o">=</span> <span class="mi">3</span><span class="o">,</span> <span class="n">fraction</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="n">message</span> <span class="o">=</span> <span class="s">"Invalid CVV"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">ccCVV</span><span class="o">;</span>
</code></pre></div></div>

<p>NotNull 외에도 NotBlack, CreditCardNumber, Pattern, Digits도<br />
가능하다는 걸 알 수 있었다.</p>

<h2 id="자바-빈-유효성-검사">자바 빈 유효성 검사</h2>

<p>위처럼 잘 진행했다면 아래처럼<br />
<code class="language-plaintext highlighter-rouge">@Valid</code>를 넣어서 유효성 검사를 수행한다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nd">@PostMapping</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">processDesign</span><span class="o">(</span><span class="nd">@Valid</span> <span class="nc">Taco</span> <span class="n">design</span><span class="o">,</span> <span class="nc">Errors</span> <span class="n">errors</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">errors</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">()){</span>
            <span class="k">return</span> <span class="s">"design"</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Processing design: "</span> <span class="o">+</span> <span class="n">design</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"redirect:/orders/current"</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre></div></div>

<h2 id="뷰-컨트롤러">뷰 컨트롤러</h2>

<p>HomeController와 같이 모델 데이터나 사용자 입력을 처리하지 않는 간단한 컨트롤러의 경우,<br />
다른 방법으로 컨트롤러를 정의할 수 있다.</p>

<p>뷰에 요청을 전달하는 일만 하는 컨트롤러를 <code class="language-plaintext highlighter-rouge">뷰 컨트롤러</code>라고 한다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebConfig</span> <span class="kd">implements</span> <span class="nc">WebMvcConfigurer</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addViewControllers</span><span class="o">(</span><span class="nc">ViewControllerRegistry</span> <span class="n">registry</span><span class="o">){</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">addViewController</span><span class="o">(</span><span class="s">"/"</span><span class="o">).</span><span class="na">setViewName</span><span class="o">(</span><span class="s">"home"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>그럼 위의 코드를 살펴볼 수 있다.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">WebConfig</code>: 뷰 컨트롤러 역할을 수행하는 구성 클래스! 여기서 중요한 것은 <code class="language-plaintext highlighter-rouge">WebMvcConfigurer</code>을 구현한다는 것</li>
  <li><code class="language-plaintext highlighter-rouge">WebMvcConfigurere</code>: 
      스프링 MVC를 구성하는 메서드를 정의한다. 정의된 모든 메서드의 기본적인 구현을 제공한다. 그렇기 때문에 필요한 메서드만 오버라이딩만 하면 된다.
      그래서 위 코드에선 필요한 addViewControllers()만 오버라이딩한다.
      <code class="language-plaintext highlighter-rouge">addViewControllers</code> 메서드는 하나 이상의 뷰 컨트롤러를 등록하기 위해 사용할 수 있는 <code class="language-plaintext highlighter-rouge">ViewControllerRegistry</code>를 인자로 받는다.</li>
  <li>registry.addViewController(“/”).setViewName(“home”);
      위 코드에서의 이 부분을 봐보자.
      “/”를 인자로 전달하여 addViewController()를 호출한다.
      “/” 경로의 요청이 전달되어야 하는 뷰로 home을 지정하기 위해서,
      ViewControllerRegistry 객체를 반환하고 그 부분의 setViewName()을 호출한다.
      그럼 이제 homeController를 삭제해도 똑같이 잘 보인다.</li>
</ul>

<h2 id="템플릿-캐싱">템플릿 캐싱</h2>

<p>템플릿은 최초 사용될 대 한번만 파싱된다.<br />
파싱된 결과는 사용을 위해 캐시에 저장된다.<br />
매번 요청 처리시마다 불필요하게 템플릿 파싱 하지 않아 성능 향상에 좋다.</p>

<p>하지만 개발 시 바꾼 걸 보려면 애플리케이션을 새로 설치해야 한다.<br />
그래서 캐싱 속성만 잠시 spring.thymeleaf.cache=false로 한다.</p>

<h1 id="chapter3-jdbc">Chapter3 (JDBC)</h1>

<p>JDBC를 잠시 살펴보자.<br />
<code class="language-plaintext highlighter-rouge">queryForObject</code> 메서드는 쿼리를 수행하고,<br />
그 결과를 <code class="language-plaintext highlighter-rouge">mapRowToIngredient</code> 메서드 사용하여 Ingredient 객체로 생성하는 것에 초점을 둔다.</p>

<h2 id="jdbc-사용-예제">JDBC 사용 예제</h2>

<p>그럼 사용 예제를 보고 대충 이해해보자</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JdbcUserRepository</span> <span class="kd">implements</span> <span class="nc">UserRepository</span><span class="o">{</span>

    <span class="kd">private</span> <span class="nc">JdbcTemplate</span> <span class="n">jdbc</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">JdbcUserRepository</span><span class="o">(</span><span class="nc">JdbcTemplate</span> <span class="n">jdbc</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">jdbc</span> <span class="o">=</span> <span class="n">jdbc</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">Iterable</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">jdbc</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="s">"select id, name from User"</span><span class="o">,</span> <span class="k">this</span><span class="o">::</span><span class="n">mapRowToUser</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">User</span> <span class="nf">findById</span><span class="o">(</span><span class="nc">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">jdbc</span><span class="o">.</span><span class="na">queryForObject</span><span class="o">(</span><span class="s">"select id, name from User where id=?"</span><span class="o">,</span> <span class="k">this</span><span class="o">::</span><span class="n">mapRowToUser</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">User</span> <span class="nf">save</span><span class="o">(</span><span class="nc">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">jdbc</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="s">"insert into User (id, name) values (?, ?)"</span><span class="o">,</span>
                <span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">user</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">User</span> <span class="nf">mapRowToUser</span><span class="o">(</span><span class="nc">ResultSet</span> <span class="n">rs</span><span class="o">,</span> <span class="kt">int</span> <span class="n">rowNum</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">SQLException</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">User</span><span class="o">(</span>
                <span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"id"</span><span class="o">),</span>
                <span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"name"</span><span class="o">),</span>
        <span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>보면 알겠지만,<br />
select문의 경우, 다수일 땐 <code class="language-plaintext highlighter-rouge">jdbc.query</code>,<br />
하나일 땐, <code class="language-plaintext highlighter-rouge">jdbc.queryForObject</code>를 사용함을 알 수 있다.<br />
매개변수로는 <code class="language-plaintext highlighter-rouge">"쿼리", (출력 내용), (? 안에 들어갈 내용)</code>임을 알 수 있다.<br />
update일 때에는 <code class="language-plaintext highlighter-rouge">jdbc.update(쿼리, 인자)</code>가 들어간다.</p>

<h2 id="작성한-sql-문">작성한 sql 문</h2>

<p>우리가 미리 이 정보는 만들어질 때 있었으면 좋겠다 하는 경우, <br />
insert문이나, ddl에 대한 sql문을 미리 작성해놓을 수 있다.</p>

<p>작성하는 것은 알고 있었는데,<br />
어디에 어떻게 저장되어서 작동하는지를 한번 알아보려고 한다.</p>

<p>.sql 파일 같은 경우, <code class="language-plaintext highlighter-rouge">resources</code> 폴더에 저장한다.<br />
그러면 애플리케이션이 시작될 때 데이터베이스에서 자동 실행된다.</p>

<h2 id="이해-안-됐던-부분preparedstatementcreator-keyholder">이해 안 됐던 부분(PreparedStatementCreator, keyholder)</h2>

<p>jdbc 코드를 구현하면서, 아래 부분이 정말 이해되지 않았다.<br />
그래서 이 부분을 살펴보려고 한다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">private</span> <span class="kt">long</span> <span class="nf">saveTacoInfo</span><span class="o">(</span><span class="nc">Taco</span> <span class="n">taco</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">taco</span><span class="o">.</span><span class="na">setCreatedAt</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">());</span>
        <span class="nc">PreparedStatementCreator</span> <span class="n">psc</span> <span class="o">=</span>
                <span class="k">new</span> <span class="nf">PreparedStatementCreatorFactory</span><span class="o">(</span><span class="s">"insert into Taco (name, createdAt) values (?, ?)"</span><span class="o">,</span>
                        <span class="nc">Types</span><span class="o">.</span><span class="na">VARCHAR</span><span class="o">,</span> <span class="nc">Types</span><span class="o">.</span><span class="na">TIMESTAMP</span>
                <span class="o">).</span><span class="na">newPreparedStatementCreator</span><span class="o">(</span>
                        <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
                                <span class="n">taco</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span>
                                <span class="k">new</span> <span class="nf">Timestamp</span><span class="o">(</span><span class="n">taco</span><span class="o">.</span><span class="na">getCreatedAt</span><span class="o">().</span><span class="na">getTime</span><span class="o">())));</span>

        <span class="nc">KeyHolder</span> <span class="n">keyHolder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">GeneratedKeyHolder</span><span class="o">();</span>
        <span class="n">jdbc</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">psc</span><span class="o">,</span> <span class="n">keyHolder</span><span class="o">);</span> <span class="c1">// 요기</span>
        <span class="k">return</span> <span class="n">keyHolder</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">longValue</span><span class="o">();</span>
    <span class="o">}</span>
</code></pre></div></div>

<p>이 메서드 같은 경우는 타코 ID가 필요한데,<br />
그 부분을 알 수 없어 update() 메서드가 사용된다.</p>

<p>update()메서드는 <code class="language-plaintext highlighter-rouge">PreparedStatementCreator</code> 객체와<br />
<code class="language-plaintext highlighter-rouge">KeyHolder</code> 객체를 인자로 받는다.</p>

<p>이 <code class="language-plaintext highlighter-rouge">KeyHolder</code>가 생성된 타코 ID를 제공한다.<br />
keyholder를 사용하기 위해서는 <code class="language-plaintext highlighter-rouge">PreparedStatementCreator</code>도 생성해야 한다.</p>

<ul>
  <li>
    <p>PreparedStatementCreator 생성과정
      생성 과정이 너무 길어서 따로 한번 살펴보자.<br />
      위에 보면, <code class="language-plaintext highlighter-rouge">PreparedStatementCreatorFactory</code> 객체를 생성한다.<br />
      매개변수로는 쿼리, Type이 들어가고,<br />
      그 다음, <code class="language-plaintext highlighter-rouge">newPreparedStatementCreator</code>를 생성한다.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  keyHolder를 생성하고나서야 update문을 호출할 수 있다.
</code></pre></div>    </div>
  </li>
</ul>

<p>이 부분은 더 보면서 이해해야 할 것 같다.</p>

<h2 id="sessionattribute">SessionAttribute</h2>

<p>기존 컨트롤러에서 관련 작업을 해준다.<br />
코드를 봐보자</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/design"</span><span class="o">)</span>
<span class="nd">@SessionAttributes</span><span class="o">(</span><span class="s">"order"</span><span class="o">)</span> <span class="c1">// 이 부분 추가</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DesignTacoController</span> <span class="o">{</span>

    <span class="o">...</span>

    <span class="nd">@ModelAttribute</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"order"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">Order</span> <span class="nf">order</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Order</span><span class="o">();</span>
    <span class="o">}</span>
    
    <span class="nd">@ModelAttribute</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"taco"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">Taco</span> <span class="nf">taco</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Taco</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="o">...</span>

    <span class="nd">@PostMapping</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">processDesign</span><span class="o">(</span><span class="nd">@Valid</span> <span class="nc">Taco</span> <span class="n">design</span><span class="o">,</span> <span class="nc">Errors</span> <span class="n">errors</span><span class="o">,</span> <span class="nd">@ModelAttribute</span> <span class="nc">Order</span> <span class="n">order</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">errors</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">()){</span>
            <span class="k">return</span> <span class="s">"design"</span><span class="o">;</span>
        <span class="o">}</span>
        
        <span class="nc">Taco</span> <span class="n">saved</span> <span class="o">=</span> <span class="n">tacoRepo</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">design</span><span class="o">);</span>
        <span class="n">order</span><span class="o">.</span><span class="na">addDesign</span><span class="o">(</span><span class="n">saved</span><span class="o">);</span>

        <span class="k">return</span> <span class="s">"redirect:/orders/current"</span><span class="o">;</span>
    <span class="o">}</span>

</code></pre></div></div>

<p>기존 코드와 다르게, SessionAttributes/ModelAttribute 어노테이션이 추가되었다.<br />
SessionAttributes의 경우,<br />
<code class="language-plaintext highlighter-rouge">다수의 타코를 생성하고 그걸 하나의 주문으로 추가할 수 있게 하기 위해서</code>라고 한다<br />
하나의 세션에서 생성되는 Taco 객체와 주문은 다수의 http 요청에 걸쳐 존재해야 된다.<br />
(이 부분 한번 더)</p>

<p>@ModelAttribute는 이 매개변수의 값이 모델로부터 전달되어야 한다.<br />
위 코드 processDesign 부분을 보면,<br />
세션에 보존된 Order에 Taco 객체를 추가한다.</p>

<h2 id="simplejdbc-preparedstatementcreator-대신">SimpleJdbc (PreparedStatementCreator 대신)</h2>

<p>관련 id를 알 수 없다보니까,<br />
Keyholder와 PreparedStatementCreator를 사용했었다.<br />
이거 대신 SimpleJdbcInsert를 사용해보자.</p>

<p>예시 코드는 아래와 같다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Repository</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JdbcOrderRepository</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">SimpleJdbcInsert</span> <span class="n">orderInserter</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">SimpleJdbcInsert</span> <span class="n">orderTacoInserter</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">ObjectMapper</span> <span class="n">objectMapper</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">JdbcOrderRepository</span><span class="o">(</span><span class="nc">JdbcTemplate</span> <span class="n">jdbc</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">orderInserter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleJdbcInsert</span><span class="o">(</span><span class="n">jdbc</span><span class="o">)</span>
                <span class="o">.</span><span class="na">withTableName</span><span class="o">(</span><span class="s">"Taco_Order"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">usingGeneratedKeyColumns</span><span class="o">(</span><span class="s">"id"</span><span class="o">);</span>
        
        <span class="k">this</span><span class="o">.</span><span class="na">orderTacoInserter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleJdbcInsert</span><span class="o">(</span><span class="n">jdbc</span><span class="o">)</span>
                <span class="o">.</span><span class="na">withTableName</span><span class="o">(</span><span class="s">"Taco_Order_Tacos"</span><span class="o">);</span>
        
        <span class="k">this</span><span class="o">.</span><span class="na">objectMapper</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectMapper</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>JdbcTemplate을 사용해서 2개의 SimpleJdbcInsert 인스턴스를 생성함을 알 수 있다.<br />
orderInserter에는 주문 데이터를 추가,<br />
orderTacoInserter에는 해당 주문 id 및 관련 id를 추가하기 위해 구성된다.<br />
근데 위에꺼와 다르게 어떤 id값을 해당 테이블에 생성할지는 지정하지 않는다.<br />
(우리가 지정하기 때문)</p>

<p>SimpleJdbcInsert는 <code class="language-plaintext highlighter-rouge">execute()</code>, <code class="language-plaintext highlighter-rouge">executeAndReturnKey()</code>를 가진다.<br />
두 메서드는 모두 <code class="language-plaintext highlighter-rouge">Map&lt;String, Object&gt;</code> 를 인자로 받는다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="kd">private</span> <span class="kt">long</span> <span class="nf">saveOrderDetails</span><span class="o">(</span><span class="nc">Order</span> <span class="n">order</span><span class="o">)</span> <span class="o">{</span>
		<span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
		<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">values</span> <span class="o">=</span>
		<span class="n">objectMapper</span><span class="o">.</span><span class="na">convertValue</span><span class="o">(</span><span class="n">order</span><span class="o">,</span> <span class="nc">Map</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		<span class="n">values</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"placedAt"</span><span class="o">,</span> <span class="n">order</span><span class="o">.</span><span class="na">getPlacedAt</span><span class="o">());</span>
		<span class="kt">long</span> <span class="n">orderId</span> <span class="o">=</span>
				<span class="n">orderInserter</span>
				<span class="o">.</span><span class="na">executeAndReturnKey</span><span class="o">(</span><span class="n">values</span><span class="o">)</span>
				<span class="o">.</span><span class="na">longValue</span><span class="o">();</span>
		<span class="k">return</span> <span class="n">orderId</span><span class="o">;</span>
	<span class="o">}</span>
</code></pre></div></div>

<p>사용 예시를 보자.
위의 메서드를 바탕으로 orderId를 도출해낼 수 있다.</p>

<h2 id="jpa">JPA</h2>

<p><code class="language-plaintext highlighter-rouge">NoArgsConstructor</code>를 보자.<br />
의미는 다들 알고 있을 거라고 가정하고 보면,<br />
간혹가다 아래처럼 되어 있는 걸 볼 수 있다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@NoArgsConstructor</span><span class="o">(</span><span class="n">access</span> <span class="o">=</span> <span class="nc">AccessLevel</span><span class="o">.</span><span class="na">PRIVATE</span><span class="o">,</span> <span class="n">force</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
    
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span><span class="o">=</span><span class="nc">GenerationType</span><span class="o">.</span><span class="na">AUTO</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">Date</span> <span class="n">createdAt</span><span class="o">;</span>

    <span class="nd">@PrePersist</span>
    <span class="kt">void</span> <span class="nf">createdAt</span><span class="o">(){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">createdAt</span> <span class="o">=</span> <span class="n">createdAt</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>이 부분의 경우, 인자 없는 생성자의 사용을 원치 않으므로,<br />
access 속성을 <code class="language-plaintext highlighter-rouge">AccessLevel.PRIVATE</code>로 설정해놓았음을 알 수 있다.<br />
또 초기화가 필요한 final 속성이 있으므로 force 속성을 true로 설정함을 알 수 있다.<br />
그래서 Lombok이 그 속성들을 null로 설정한다.</p>

<p><code class="language-plaintext highlighter-rouge">@PrePersist</code>의 경우, 해당 Test 객체가 저장되기 전에<br />
createdAt을 현재 일자,시간으로 설정한다.</p>

<h2 id="serializable">Serializable</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Data</span>
<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"Taco_Order"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Order</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">Date</span> <span class="n">placedAt</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>위의 예시를 보면 implements Serializable을 하는 것을 알 수 있다.<br />
이 부분이 궁금해서 검색한 부분을 따라 써본다!</p>

<p>자바는 내부적으로 오브젝트(또는 Reference) 형식의 데이터를 많이 사용하고,<br />
오브젝트 안에 내부적으로 다른 오브젝트를 참조할 수 있는 주소값이 담길 수 있다.</p>

<p>주소값의 실체를 다 끌어와서 Primitive 한 값 형식 데이터로 전부 변조하는 작업을 바로 직렬화(Serialization)라고 한다.
직렬화 된 데이터 형식은 언어에 따라 텍스트로 된 데이터 또는 바이너리 등의 모양을 띄게 되고, 오브젝트 타입이 없다.<br />
모든것이 Primitive 한 값 형식의 데이터 묶음이며, 이것은 파일 저장이나 네트워크 전송시 파싱 할 수 있는 유의미한 데이터가 되는 것이라고 한다.</p>

<p>(출처: https://okky.kr/article/224715)</p>

<blockquote>
  <p>JDBC와 다른 것 중 하나 알아보기</p>
</blockquote>

<p>Jdbc를 사용했을 때는 resources 디렉토리 안에 sql 파일을 넣었다.<br />
그러면 자동으로 추가되었었는데,<br />
JPA를 사용하면 그렇지 않기 때문에,<br />
<code class="language-plaintext highlighter-rouge">CommandLineRunner</code>를 사용해서 추가해준다.(상황에 따라 다름)</p>

<h2 id="dsldomain-specific-language">DSL(Domain Specific Language)</h2>

<p>JPA를 사용하면 레퍼지토리에<br />
findByEmail 이런 게 사용 가능하다.</p>

<p>본질적으로 스프링 데이터는 일종의 DSL(Domain Specific Language)을<br />
정의하고 있어서 persistence에 대한 내용이 repository 메서드 시그니처에 표현된다.</p>]]></content><author><name>🐸 SW developer</name></author><category term="Spring" /><category term="스프링인액션" /><category term="java" /><category term="spring" /><summary type="html"><![CDATA[[스프링 인 액션5] Chapter1~3 내용 정리]]></summary></entry><entry><title type="html">[스프링 핵심 원리 - 기본편] 복습일지3 (컴포넌트 스캔)</title><link href="http://localhost:4000/spring/TIL-core3/" rel="alternate" type="text/html" title="[스프링 핵심 원리 - 기본편] 복습일지3 (컴포넌트 스캔)" /><published>2021-10-13T00:00:00+09:00</published><updated>2021-10-13T00:00:00+09:00</updated><id>http://localhost:4000/spring/TIL-core3</id><content type="html" xml:base="http://localhost:4000/spring/TIL-core3/"><![CDATA[<h1 id="스프링-핵심-원리---기본편-복습일지3-컴포넌트-스캔">[스프링 핵심 원리 - 기본편] 복습일지3 (컴포넌트 스캔)</h1>

<h2 id="컴포넌트-스캔">컴포넌트 스캔?</h2>

<p>컴포넌트 스캔은 스프링이 설정 정보가 없어도<br />
<code class="language-plaintext highlighter-rouge">자동으로 스프링 빈을 등록</code>하는 기능이다</p>

<p>컴포넌트 스캔을 사용하려면 아래처럼<br />
<code class="language-plaintext highlighter-rouge">@ComponentScan</code>을 설정 정보에 붙여준다.<br />
아래처럼 제외도 가능하다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="nd">@ComponentScan</span><span class="o">(</span>
        <span class="n">excludeFilters</span> <span class="o">=</span> <span class="nd">@ComponentScan</span><span class="o">.</span><span class="na">Filter</span><span class="o">(</span><span class="n">type</span> <span class="o">=</span> <span class="nc">FilterType</span><span class="o">.</span><span class="na">ANNOTATION</span><span class="o">,</span> <span class="n">classes</span> <span class="o">=</span> <span class="nc">Configuration</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AutoAppConfig</span> <span class="o">{</span>
<span class="o">}</span>
</code></pre></div></div>

<p>컴포넌트 스캔은 <code class="language-plaintext highlighter-rouge">@Component</code> 애노테이션이 붙은 클래스를 스캔 후<br />
스프링 빈으로 등록한다.</p>

<p>예시를 한번 봐보자.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 1. DetailPolicy.class</span>
<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DetailPolicyRepository</span> <span class="kd">implements</span> <span class="nc">PolicyRepository</span><span class="o">{}</span>

<span class="c1">// 2. PolicyServiceImpl.class</span>
<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PolicyServiceImpl</span> <span class="kd">implements</span> <span class="nc">PolicyService</span><span class="o">{</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">PolicyRepository</span> <span class="n">policyRepository</span><span class="o">;</span>

  <span class="nd">@Autowired</span>
  <span class="kd">public</span> <span class="nf">PolicyServiceImpl</span><span class="o">(</span><span class="nc">PolicyRepository</span> <span class="n">policyRepository</span><span class="o">){</span>
    <span class="k">this</span><span class="o">.</span><span class="na">policyRepository</span> <span class="o">=</span> <span class="n">policyRepository</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">Bean</code>으로 설정 정보 작성, 의존 관계도 명시했었는데,<br />
이런 설정 정보가 없어서 이 클래스 안에서 DI를 해결해야 한다.<br />
<code class="language-plaintext highlighter-rouge">@Autowired</code>로 의존관계를 자동 주입해준다.</p>

<p>이 부분을 사용할 때엔,<br />
Bean을 사용했을 때처럼 ApplicationContext, getBean을 사용하면 된다.</p>

<h2 id="컴포넌트-스캔의-동작">컴포넌트 스캔의 동작</h2>

<p><code class="language-plaintext highlighter-rouge">ComponentScan</code>은 <code class="language-plaintext highlighter-rouge">Component</code>가 붙은 모든 클래스를 스프링 빈으로 등록한다.<br />
빈 이름은 클래스 맨앞글자가 소문자로 바뀐 걸로 지정된다.<br />
만약 직접 지정하고 싶으면 @Component(“원하는 이름”)으로 진행하면 된다.</p>

<p>그렇다면 <code class="language-plaintext highlighter-rouge">Autowired</code>는 어떤 동작을 할까?<br />
생성자에 Autowired를 지정하면,
스프링 컨테이너가 자동으로 <code class="language-plaintext highlighter-rouge">스프링 빈을 찾아서 주입</code>한다.</p>

<h2 id="컴포넌트-스캔-탐색-위치">컴포넌트 스캔 탐색 위치</h2>

<p>컴포넌트 스캔은 컴포넌트가 붙은 모든 클래스를 스프링 빈으로 등록한다고 했는데,<br />
다 스캔하면 시간이 오래 걸려서, 꼭 필요한 위치부터 탐색한다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@ComponentScan</span><span class="o">(</span>
          <span class="n">basePackages</span> <span class="o">=</span> <span class="s">"패키지명.원하는_위치"</span><span class="o">,</span>
<span class="o">}</span>
</code></pre></div></div>

<p>이렇게 원하는 탐색 시작 위치를 지정할 수 있다.</p>

<h2 id="컴포넌트-스캔-기본-대상">컴포넌트 스캔 기본 대상</h2>

<p>컴포넌트를 찾아서 등록하기도 하지만,<br />
<code class="language-plaintext highlighter-rouge">@Controller</code>, <code class="language-plaintext highlighter-rouge">@Service</code>, <code class="language-plaintext highlighter-rouge">@Repository</code>, <code class="language-plaintext highlighter-rouge">@Configurtation</code>도<br />
대상에 포함된다.</p>

<p>스캔 대상을 추가/제외도 가능하다.<br />
그럴 땐 ComponentScan어노테이션에<br />
<code class="language-plaintext highlighter-rouge">includeFilters</code>, <code class="language-plaintext highlighter-rouge">excludeFilters</code>를 사용하면 된다.</p>

<h2 id="나만의-컴포넌트-대상-어노테이션-만들기">나만의 컴포넌트 대상 어노테이션 만들기</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Target</span><span class="o">(</span><span class="nc">ElementType</span><span class="o">.</span><span class="na">TYPE</span><span class="o">)</span> <span class="c1">// class</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="nc">RetentionPolicy</span><span class="o">.</span><span class="na">RUNTIME</span><span class="o">)</span>
<span class="nd">@Documented</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">MyExcludeComponent</span> <span class="o">{</span>
<span class="o">}</span>

<span class="c1">// 사용할 때 다른 클래스에서의 ComponentScan</span>
<span class="nd">@ComponentScan</span><span class="o">(</span>
    <span class="n">excludeFilters</span> <span class="o">=</span> <span class="nd">@ComponentScan</span><span class="o">.</span><span class="na">Filter</span><span class="o">(</span><span class="n">type</span> <span class="o">=</span> <span class="nc">FilterType</span><span class="o">.</span><span class="na">ANNOTATION</span><span class="o">,</span> <span class="n">classes</span> <span class="o">=</span> <span class="nc">MyExcludeComponent</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="o">)</span>
</code></pre></div></div>

<p>필터 타입의 경우,<br />
어노테이션 외에도 정규표현식, CUSTOM 등이 있다.</p>]]></content><author><name>🐸 SW developer</name></author><category term="Spring" /><category term="spring" /><category term="java" /><summary type="html"><![CDATA[[스프링 핵심 원리 - 기본편] 복습일지3 (컴포넌트 스캔)]]></summary></entry><entry><title type="html">[스프링 핵심 원리 - 기본편] 복습 일지2 (싱글톤)</title><link href="http://localhost:4000/spring/TIL-core2/" rel="alternate" type="text/html" title="[스프링 핵심 원리 - 기본편] 복습 일지2 (싱글톤)" /><published>2021-10-13T00:00:00+09:00</published><updated>2021-10-13T00:00:00+09:00</updated><id>http://localhost:4000/spring/TIL-core2</id><content type="html" xml:base="http://localhost:4000/spring/TIL-core2/"><![CDATA[<h2 id="스프링-핵심-원리---기본편-복습일지2-싱글톤">[스프링 핵심 원리 - 기본편] 복습일지2 (싱글톤)</h2>

<h3 id="싱글톤-패턴">싱글톤 패턴</h3>

<p>클래스의 인스턴스가 딱 1개만 생성되는 것을 보장하는 디자인패턴!</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SingleService</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">SingleService</span> <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SingleService</span><span class="o">();</span>
  <span class="kd">private</span> <span class="nf">SingleService</span><span class="o">()</span> <span class="o">{}</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="nc">SingleService</span> <span class="nf">getInstance</span><span class="o">(){</span> <span class="k">return</span> <span class="n">instance</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>이 상태로 single.getInstance를 2번 사용했을 때<br />
같은 객체가 나옴을 알 수 있다.</p>

<p>근데 싱글톤 패턴의 문제점도 꽤 많다는 걸 알게 되어서<br />
나중에 한번 더 복습할 때 정리해야겠다.</p>

<h3 id="싱글톤-컨테이너">싱글톤 컨테이너</h3>

<p>스프링 컨테이너 하면 ApplicationContext, 빈팩토리가 생각난다.<br />
근데 싱글톤 컨테이너도 있다고 한다.</p>

<p>스프링 컨테이너는 알아서 객체 인스턴스를 <code class="language-plaintext highlighter-rouge">싱글톤으로 관리</code>한다.<br />
스프링 컨테이너는 싱글톤 컨테이너 역할을 하고,<br />
싱글톤 객체를 생성하고 관리하는 기능 = <code class="language-plaintext highlighter-rouge">싱글톤 레지스트리</code>라고 한다.</p>

<p>스프링 컨테이너가 이래서 <code class="language-plaintext highlighter-rouge">싱글턴 패턴의 모든 단점 해결</code>한다고 한다.<br />
싱글톤의 경우 <code class="language-plaintext highlighter-rouge">무상태</code>로 설계함을 중요시 여기자<br />
(자세한 내용은 나중에 필요하면 또 정리!)</p>

<p>###z Configuration과 싱글톤?</p>

<p>Config class에 @Configuration을 넣었었다.<br />
그럼 스프링이 <code class="language-plaintext highlighter-rouge">CGLIB</code>이라는 바이트코드 조작 라이브러리로 <br />
다른 클래스를 만들고 그걸 스프링 빈으로 등록한다.<br />
그래서 싱글톤을 보장한다.</p>]]></content><author><name>🐸 SW developer</name></author><category term="Spring" /><category term="spring" /><category term="java" /><summary type="html"><![CDATA[[스프링 핵심 원리 - 기본편] 복습일지2 (싱글톤)]]></summary></entry><entry><title type="html">[스프링 핵심 원리 - 기본편] 복습 일지1 (빈)</title><link href="http://localhost:4000/spring/TIL-core1/" rel="alternate" type="text/html" title="[스프링 핵심 원리 - 기본편] 복습 일지1 (빈)" /><published>2021-10-13T00:00:00+09:00</published><updated>2021-10-13T00:00:00+09:00</updated><id>http://localhost:4000/spring/TIL-core1</id><content type="html" xml:base="http://localhost:4000/spring/TIL-core1/"><![CDATA[<h2 id="스프링-핵심-원리---기본편-복습일지1-빈">[스프링 핵심 원리 - 기본편] 복습일지1 (빈)</h2>

<p>원래 설정 파일 즉, AppConfig에서 <br />
memberService -&gt; memberRepository -&gt; MemoryMemberRepository <br />
이런 식으로 사용했었다.</p>

<p>근데 AppConfig를 @Configuration으로 해주고,<br />
각각 memberService, memberRepository, MemoryMemberRepository에<br />
@Bean으로 등록해주면 어떻게 되는지 보자.</p>

<h3 id="configuration-bean으로-등록했을-때">@Configuration, @Bean으로 등록했을 때</h3>

<p>원래 기존 방식은 아래와 같다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">AppConfig</span> <span class="n">appConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AppConfig</span><span class="o">();</span>
<span class="nc">MemberService</span> <span class="n">memberService</span> <span class="o">=</span> <span class="n">appConfig</span><span class="o">.</span><span class="na">memberService</span><span class="o">();</span>
</code></pre></div></div>

<p>@Configuration, @Bean으로 등록해주면<br />
위의 부분이 어떻게 바뀌는지 보자.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">ApplicationContext</span> <span class="n">ac</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AnnotationConfigApplicationContext</span><span class="o">(</span><span class="nc">AppConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="nc">MemberService</span> <span class="n">memberService</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">"memberService"</span><span class="o">,</span> <span class="nc">MemberService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</code></pre></div></div>

<p>이렇게 ApplicationContext = <code class="language-plaintext highlighter-rouge">스프링 컨테이너</code> 임을 알 수 있다.<br />
AppConfig에서 직접 객체를 생성하고 DI 하는 방식에서<br />
@Bean으로 등록된 메서드를 모두 호출해서 반환된 객체<code class="language-plaintext highlighter-rouge">스프링빈</code>를<br />
<code class="language-plaintext highlighter-rouge">스프링 컨테이너</code>에 등록함을 알 수 있다.</p>

<p>등록된 부분을 getBean으로 사용함을 알 수 있다.<br />
어노테이션 기반이기 때문에 AnnotationConfigApplicationContext를 썼지만,<br />
XML 기반이면 GenericXmlApplicationContext을 써도 된다.</p>

<h3 id="bean-출력">Bean 출력</h3>

<p>등록된 bean을 출력하는 메서드들에 대해서 알아보자.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// 모든 빈 배열
String[] beanDefinitionNames = ac.getBeanDefinitionNames();

// 직접 등록한 빈 출력
BeanDefinition beanDefinition = ac.getBeanDefinition(beanDefinitionName);

// ROLE_APPLICATION / ROLE_INFRASTRUCTURE?
// : 직접 등록 / 스프링이 사용
BeanDefinition.ROLE_APPLICATION

// 빈 이름 / 타입 / 구체 타입으로 조회 메서드
ac.getBean();

// 해당 타입의 모든 빈 조회
Map&lt;String, Policy&gt; beansOfType = ac.getBeansOfType(Policy.class);
</code></pre></div></div>

<p>스프링 빈에 대해서 타입으로 조회할 때,<br />
중복일 경우 에러가 난다.<br />
그러면 이름으로 조회하면 된다.<br />
(getBean의 사용 예시는 검색하면 많이 나올 것 같아서 패스~!)</p>

<p>부모 타입으로 조회시 자식이 둘 이상 있어도 에러가 난다.<br />
유사하게 자식이 둘 이상 있으면, 빈 이름을 지정하면 된다.</p>

<h3 id="빈팩토리와-applicationcontext">빈팩토리와 ApplicationContext</h3>

<p>BeanFactory가 최상위에 있고, 빈을 관리/조회 역할을 담당함에도 <br />
ApplicationContext를 사용해왔다.<br />
ApplicationContext가 빈팩토리 기능을 모두 상속 받아서 제공하고,<br />
수많은 부가기능을 제공하기 때문이다.<br />
(그 부가 기능은 나중에 중요성을 한번 더 느꼈을 때 정리할 것 같다!)<br />
+빈팩토리 또는 ApplicationContext = 스프링 컨테이너</p>

<h3 id="beandefinition">BeanDefinition</h3>

<p>Annotation, XML 기반 ApplicationContext를 다룰 때,<br />
각각 자바 코드/XML을 읽어서 BeanDefinition을 만든다.<br />
이 설정 메타정보<code class="language-plaintext highlighter-rouge">BeanDefinition</code>을 기반으로 스프링 빈을 생성한다.<br />
BeanDefinition에 대해서도 더 중요성을 느끼면 한번 더 정리해야겠다!<br />
(아직 나에겐 너무 어렵다ㅎㅎ)</p>

<h3 id="핵심-요약">핵심 요약</h3>

<ol>
  <li>역할과 구현을 분리하자</li>
  <li>ApplicationContext -&gt; 스프링 컨테이너</li>
  <li>객체 지향의 원리</li>
  <li>Bean!</li>
</ol>]]></content><author><name>🐸 SW developer</name></author><category term="Spring" /><category term="spring" /><category term="java" /><summary type="html"><![CDATA[[스프링 핵심 원리 - 기본편] 복습일지1 (빈)]]></summary></entry><entry><title type="html">[TIL]인텔리제이 단축키 정리해보기</title><link href="http://localhost:4000/intellij/TIL-intellij/" rel="alternate" type="text/html" title="[TIL]인텔리제이 단축키 정리해보기" /><published>2021-10-04T00:00:00+09:00</published><updated>2021-10-04T00:00:00+09:00</updated><id>http://localhost:4000/intellij/TIL-intellij</id><content type="html" xml:base="http://localhost:4000/intellij/TIL-intellij/"><![CDATA[<h3 id="til-인텔리제이-단축키-정리해보기">[TIL] 인텔리제이 단축키 정리해보기</h3>

<p>(해오기)
인텔리제이 디렉토리 펼치기 알아오기 
커맨드 + E
커맨드 + 옵션 + M: 중복 처리</p>

<p><img src="https://user-images.githubusercontent.com/46602874/136080951-84911a35-2f2e-42d5-8238-9294b5f48e4e.png" /></p>]]></content><author><name>🐸 SW developer</name></author><category term="Intellij" /><category term="Intellij" /><summary type="html"><![CDATA[[TIL] 인텔리제이 단축키 정리해보기]]></summary></entry></feed>